<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.536">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Matthew Ho">
<meta name="dcterms.date" content="2024-01-19">
<meta name="description" content="Take-Home Exercise 1">

<title>Matt’s IS415 Experience - Take-Home Exercise 1</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Matt’s IS415 Experience</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-hands-on-exercises" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Hands-on Exercises</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-hands-on-exercises">    
        <li>
    <a class="dropdown-item" href="../../HandsOnEx/HE1/HE1.html">
 <span class="dropdown-text">Hands-on Exercise 1</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../HandsOnEx/HE2/HE2.html">
 <span class="dropdown-text">Hands-on Exercise 2</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../HandsOnEx/HE3/HE3.html">
 <span class="dropdown-text">Hands-on Exercise 3</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../HandsOnEx/HE4/HE4.html">
 <span class="dropdown-text">Hands-on Exercise 4</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../HandsOnEx/HE5/HE5.html">
 <span class="dropdown-text">Hands-on Exercise 5</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-take-home-exercises" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Take-home Exercises</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-take-home-exercises">    
        <li>
    <a class="dropdown-item" href="../../TakeHomeEx/TakeHomeEx1/THE1.html">
 <span class="dropdown-text">Take-home Exercise 1</span></a>
  </li>  
        <li class="dropdown-header">Take-home Exercise 2</li>
        <li class="dropdown-header">Take-home Exercise 3</li>
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-in-class-exercises" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">In-class Exercises</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-in-class-exercises">    
        <li>
    <a class="dropdown-item" href="../../InclassEx/ICE2/ICE2.html">
 <span class="dropdown-text">In-class Exercises 2</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../InClassEx/ICE3/ICE3.html">
 <span class="dropdown-text">In-class Exercises 3</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../InClassEx/ICE3/ICE3_1.html">
 <span class="dropdown-text">In-class Exercises 3.1</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../InClassEx/ICE4/ICE4.html">
 <span class="dropdown-text">In-class Exercises 4</span></a>
  </li>  
    </ul>
  </li>
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#overview" id="toc-overview" class="nav-link active" data-scroll-target="#overview">1.0 Overview</a>
  <ul class="collapse">
  <li><a href="#objectives" id="toc-objectives" class="nav-link" data-scroll-target="#objectives">1.1 Objectives</a></li>
  <li><a href="#approach" id="toc-approach" class="nav-link" data-scroll-target="#approach">1.2 Approach</a></li>
  </ul></li>
  <li><a href="#setup" id="toc-setup" class="nav-link" data-scroll-target="#setup">2.0 Setup</a>
  <ul class="collapse">
  <li><a href="#dependencies" id="toc-dependencies" class="nav-link" data-scroll-target="#dependencies">2.1 Dependencies</a></li>
  <li><a href="#datasets" id="toc-datasets" class="nav-link" data-scroll-target="#datasets">2.2 Datasets</a></li>
  </ul></li>
  <li><a href="#data-wrangling" id="toc-data-wrangling" class="nav-link" data-scroll-target="#data-wrangling">3.0 Data Wrangling</a>
  <ul class="collapse">
  <li><a href="#importing-aspatial-data" id="toc-importing-aspatial-data" class="nav-link" data-scroll-target="#importing-aspatial-data">3.1 Importing Aspatial Data</a></li>
  <li><a href="#importing-spatial-data" id="toc-importing-spatial-data" class="nav-link" data-scroll-target="#importing-spatial-data">3.2 Importing Spatial Data</a></li>
  <li><a href="#wrangling" id="toc-wrangling" class="nav-link" data-scroll-target="#wrangling">3.2 Wrangling</a></li>
  <li><a href="#crs-adjustments-and-verification" id="toc-crs-adjustments-and-verification" class="nav-link" data-scroll-target="#crs-adjustments-and-verification">3.3 CRS Adjustments and Verification</a></li>
  <li><a href="#singapore-boundaries" id="toc-singapore-boundaries" class="nav-link" data-scroll-target="#singapore-boundaries">3.4 Singapore Boundaries</a></li>
  <li><a href="#simple-visualisations" id="toc-simple-visualisations" class="nav-link" data-scroll-target="#simple-visualisations">3.5 Simple Visualisations</a></li>
  </ul></li>
  <li><a href="#kde" id="toc-kde" class="nav-link" data-scroll-target="#kde">4.0 KDE</a></li>
  <li><a href="#nkde" id="toc-nkde" class="nav-link" data-scroll-target="#nkde">5.0 NKDE</a>
  <ul class="collapse">
  <li><a href="#study-areas" id="toc-study-areas" class="nav-link" data-scroll-target="#study-areas">Study Areas</a></li>
  <li><a href="#changi-airport" id="toc-changi-airport" class="nav-link" data-scroll-target="#changi-airport">5.1 Changi Airport</a></li>
  <li><a href="#woodlands-and-woodlands-checkpoint" id="toc-woodlands-and-woodlands-checkpoint" class="nav-link" data-scroll-target="#woodlands-and-woodlands-checkpoint">5.2 Woodlands and Woodlands Checkpoint</a></li>
  <li><a href="#downtown" id="toc-downtown" class="nav-link" data-scroll-target="#downtown">5.3 Downtown</a></li>
  <li><a href="#nkde-general-insights" id="toc-nkde-general-insights" class="nav-link" data-scroll-target="#nkde-general-insights">5.4 NKDE General Insights</a></li>
  </ul></li>
  <li><a href="#tnkde" id="toc-tnkde" class="nav-link" data-scroll-target="#tnkde">6.0 TNKDE</a>
  <ul class="collapse">
  <li><a href="#changi-airport-1" id="toc-changi-airport-1" class="nav-link" data-scroll-target="#changi-airport-1">6.1 Changi Airport</a></li>
  <li><a href="#woodlands" id="toc-woodlands" class="nav-link" data-scroll-target="#woodlands">6.2 Woodlands</a></li>
  <li><a href="#downtown-core" id="toc-downtown-core" class="nav-link" data-scroll-target="#downtown-core">6.3 Downtown Core</a></li>
  </ul></li>
  <li><a href="#conclusions" id="toc-conclusions" class="nav-link" data-scroll-target="#conclusions">7.0 Conclusions</a></li>
  <li><a href="#personal-learnings" id="toc-personal-learnings" class="nav-link" data-scroll-target="#personal-learnings">8.0 Personal Learnings</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Take-Home Exercise 1</h1>
  <div class="quarto-categories">
    <div class="quarto-category">Take-Home Exercise</div>
  </div>
  </div>

<div>
  <div class="description">
    <p>Take-Home Exercise 1</p>
  </div>
</div>


<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p><a href="https://www.linkedin.com/in/matthewhoyiwen/">Matthew Ho</a> </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">January 19, 2024</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="overview" class="level2">
<h2 class="anchored" data-anchor-id="overview">1.0 Overview</h2>
<section id="objectives" class="level3">
<h3 class="anchored" data-anchor-id="objectives">1.1 Objectives</h3>
<section id="exercise-requirements" class="level4">
<h4 class="anchored" data-anchor-id="exercise-requirements">Exercise Requirements</h4>
<ol type="1">
<li>Using appropriate function of sf and tidyverse, preparing the following geospatial data layer in sf tibble data.frames:</li>
</ol>
<ul>
<li><p>Grab taxi location points either by origins or destinations.</p></li>
<li><p>Road layer within Singapore excluding outer islands.</p></li>
<li><p>Singapore boundary layer excluding outer islands</p></li>
</ul>
<ol start="2" type="1">
<li>Using the extracted data, derive traditional Kernel Density Estimation layers.</li>
<li>Using the extracted data, derive either Network Kernel Density Estimation (NKDE) or Temporal Network Kernel Density Estimation (TNKDE) Using appropriate tmap functions, display the kernel density layers on OpenStreetMaps of Singapore.</li>
<li>Describe the spatial patterns revealed by the kernel density maps.</li>
</ol>
</section>
</section>
<section id="approach" class="level3">
<h3 class="anchored" data-anchor-id="approach">1.2 Approach</h3>
<p>This exercise seems quite straightforward, but I think that some genuinely useful information can be derived from this data. While removing the outer islands can be done fairly easily, I think that other small issues, like holes in the geometry will need to be fixed.</p>
<p>NKDE may also require very long computation times for large areas, especially given the magnitude of the entire dataset. The GrabPosisi dataset’s journey start and destination locations likely occur along smaller roads where people can walk. These small roads are likely near other small roads, which will greatly increase the number of affect lixels for every NKDE operation. Since these small roads will have the most interesting data, I will have to scale down my analysis to smaller locations determined by the simpler KDE analysis.</p>
</section>
</section>
<section id="setup" class="level2">
<h2 class="anchored" data-anchor-id="setup">2.0 Setup</h2>
<section id="dependencies" class="level3">
<h3 class="anchored" data-anchor-id="dependencies">2.1 Dependencies</h3>
<p>Aside from the tools used in class, I also included some additional tools I found useful.</p>
<section id="taught-in-class" class="level4">
<h4 class="anchored" data-anchor-id="taught-in-class">Taught in class:</h4>
<ul>
<li><p>Tidyverse: An extensive set of tools for geospatial analysis, a staple for most tasks</p></li>
<li><p>sf: I also cannot imagine a geospatial task without simple features</p></li>
<li><p>tmap: Used to generate thematic maps</p></li>
<li><p>maptools: Used to handle spatial objects</p></li>
<li><p>spatstat: Just recently used in the hands-on exercises for this week. Useful for spatial point analysis</p></li>
<li><p>spNetwork: For spatial analysis on networks, we’ll use this for NKDE and TNKDE</p></li>
<li><p>classInt: For choosing univariate class intervals</p></li>
<li><p>viridis: COLORS! These will help us create more interesting and colorful maps to communicate our ideas</p></li>
<li><p>arrow: We need this to work with parquet files and to load the GrabPosisi dataset</p></li>
</ul>
</section>
<section id="exploration" class="level4">
<h4 class="anchored" data-anchor-id="exploration">Exploration</h4>
<ul>
<li><p>stringr: The Description field in kml files is not very convenient for us. It’s an HTML table, meaning we need to parse it to get each variable into a column compatible for our use</p></li>
<li><p>smoothr: The MPSZ2019 polygons have small holes, so I use this library to fix them before they cause issues</p></li>
<li><p>RColorBrewer: Used to create alternative NKDE and TNKDE visualisation which I found to work better than those that only change the color of the lines of the network</p></li>
<li><p>gifski: To animate our TNKDE results</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(tidyverse, sf, tmap, maptools, spatstat, spNetwork, classInt, viridis, smoothr, arrow, stringr, RColorBrewer, gifski)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="datasets" class="level3">
<h3 class="anchored" data-anchor-id="datasets">2.2 Datasets</h3>
<section id="aspatial-data" class="level4">
<h4 class="anchored" data-anchor-id="aspatial-data">Aspatial data</h4>
<ol type="1">
<li>Grab-Posisi Singapore dataset</li>
</ol>
</section>
<section id="geospatial-data" class="level4">
<h4 class="anchored" data-anchor-id="geospatial-data">Geospatial data</h4>
<ol type="1">
<li>Road data set from Geofabrik’s OpenStreetMap.</li>
</ol>
<ul>
<li>Although the dataset includes all of Malaysia, Singapore, and Brunei, only Singapore’s data will required.</li>
</ul>
<ol start="2" type="1">
<li>Master Plan 2019 Subzone Boundary (No Sea) from Data.gov.sg.</li>
</ol>
</section>
</section>
</section>
<section id="data-wrangling" class="level2">
<h2 class="anchored" data-anchor-id="data-wrangling">3.0 Data Wrangling</h2>
<section id="importing-aspatial-data" class="level3">
<h3 class="anchored" data-anchor-id="importing-aspatial-data">3.1 Importing Aspatial Data</h3>
<section id="reading-the-grab-posisi-parquet-files" class="level4">
<h4 class="anchored" data-anchor-id="reading-the-grab-posisi-parquet-files">Reading the Grab-Posisi Parquet Files</h4>
<p>I’m glad this function from the arrow library exists to load every split parquet file instead of having to loop and append each file to a single object.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>grabp <span class="ot">&lt;-</span> <span class="fu">open_dataset</span>(<span class="st">"data/aspatial/GrabPosisi/"</span>) <span class="sc">%&gt;%</span> <span class="fu">as.data.frame</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="importing-spatial-data" class="level3">
<h3 class="anchored" data-anchor-id="importing-spatial-data">3.2 Importing Spatial Data</h3>
<section id="reading-the-master-plan-subzone-dataset" class="level4">
<h4 class="anchored" data-anchor-id="reading-the-master-plan-subzone-dataset">Reading the Master Plan Subzone dataset</h4>
<p>Using st_read is a standard way to import the data in kml files, but there’s a very apparent problem.</p>
<p>The description field, when not rendered, is a monstrous chunk of HTML where none of the fields are easy to use. We’ll need to split this up so that we can scope down our analysis later to interesting areas. There are no public roads in the jungle after all.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>mpsz <span class="ot">=</span> <span class="fu">st_read</span>(<span class="st">"data/geospatial/MasterPlan2019SubzoneBoundaryNoSeaKML.kml"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Reading layer `URA_MP19_SUBZONE_NO_SEA_PL' from data source 
  `/Users/matthewho/Work/Y3S2/IS415/Website/IS415/TakeHomeEx/TakeHomeEx1/data/geospatial/MasterPlan2019SubzoneBoundaryNoSeaKML.kml' 
  using driver `KML'
Simple feature collection with 332 features and 2 fields
Geometry type: MULTIPOLYGON
Dimension:     XY, XYZ
Bounding box:  xmin: 103.6057 ymin: 1.158699 xmax: 104.0885 ymax: 1.470775
z_range:       zmin: 0 zmax: 0
Geodetic CRS:  WGS 84</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>mpsz<span class="sc">$</span>Description[<span class="dv">1</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "&lt;center&gt;&lt;table&gt;&lt;tr&gt;&lt;th colspan='2' align='center'&gt;&lt;em&gt;Attributes&lt;/em&gt;&lt;/th&gt;&lt;/tr&gt;&lt;tr bgcolor=\"#E3E3F3\"&gt; &lt;th&gt;SUBZONE_NO&lt;/th&gt; &lt;td&gt;12&lt;/td&gt; &lt;/tr&gt;&lt;tr bgcolor=\"\"&gt; &lt;th&gt;SUBZONE_N&lt;/th&gt; &lt;td&gt;DEPOT ROAD&lt;/td&gt; &lt;/tr&gt;&lt;tr bgcolor=\"#E3E3F3\"&gt; &lt;th&gt;SUBZONE_C&lt;/th&gt; &lt;td&gt;BMSZ12&lt;/td&gt; &lt;/tr&gt;&lt;tr bgcolor=\"\"&gt; &lt;th&gt;CA_IND&lt;/th&gt; &lt;td&gt;N&lt;/td&gt; &lt;/tr&gt;&lt;tr bgcolor=\"#E3E3F3\"&gt; &lt;th&gt;PLN_AREA_N&lt;/th&gt; &lt;td&gt;BUKIT MERAH&lt;/td&gt; &lt;/tr&gt;&lt;tr bgcolor=\"\"&gt; &lt;th&gt;PLN_AREA_C&lt;/th&gt; &lt;td&gt;BM&lt;/td&gt; &lt;/tr&gt;&lt;tr bgcolor=\"#E3E3F3\"&gt; &lt;th&gt;REGION_N&lt;/th&gt; &lt;td&gt;CENTRAL REGION&lt;/td&gt; &lt;/tr&gt;&lt;tr bgcolor=\"\"&gt; &lt;th&gt;REGION_C&lt;/th&gt; &lt;td&gt;CR&lt;/td&gt; &lt;/tr&gt;&lt;tr bgcolor=\"#E3E3F3\"&gt; &lt;th&gt;INC_CRC&lt;/th&gt; &lt;td&gt;C22DED671DE2A940&lt;/td&gt; &lt;/tr&gt;&lt;tr bgcolor=\"\"&gt; &lt;th&gt;FMEL_UPD_D&lt;/th&gt; &lt;td&gt;20191223152313&lt;/td&gt; &lt;/tr&gt;&lt;/table&gt;&lt;/center&gt;"</code></pre>
</div>
</div>
<p>I found a concise and performant solution here to parse this mess of HTML.</p>
<p>https://www.linkedin.com/pulse/r-using-stringr-extract-information-from-html-tags-kml-melvin-kew/</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>mpsz <span class="ot">&lt;-</span> mpsz <span class="sc">%&gt;%</span> </span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Match=</span><span class="fu">str_match_all</span>(Description,<span class="st">"&lt;td&gt;(.*?)&lt;/td&gt;"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Match=</span><span class="fu">map</span>(Match, <span class="sc">~</span> .[,<span class="dv">2</span>])) <span class="sc">%&gt;%</span> </span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Match=</span><span class="fu">map</span>(Match,setNames,<span class="fu">c</span>(<span class="st">"SUBZONE_NO"</span>,<span class="st">"SUBZONE_N"</span>,<span class="st">"SUBZONE_C"</span>, <span class="st">"CA_IND"</span>, <span class="st">"PLN_AREA_N"</span>, <span class="st">"PLN_AREA_C"</span>, <span class="st">"REGION_N"</span>, <span class="st">"REGION_C"</span>, <span class="st">"INC_CRC"</span>, <span class="st">"FMEL_UPD_D"</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest_wider</span>(Match) <span class="sc">%&gt;%</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_as_sf</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>After splitting the description into columns, I can drop the Description and other fields I will not be using. Although the planning areas should suffice, having region and subzone names available does not consume a lot of memory and may be useful later on.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mpsz)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     Name           Description                  geometry    SUBZONE_NO       
 Length:332         Length:332         MULTIPOLYGON  : 11   Length:332        
 Class :character   Class :character   MULTIPOLYGON Z:321   Class :character  
 Mode  :character   Mode  :character   epsg:4326     :  0   Mode  :character  
                                       +proj=long... :  0                     
  SUBZONE_N          SUBZONE_C            CA_IND           PLN_AREA_N       
 Length:332         Length:332         Length:332         Length:332        
 Class :character   Class :character   Class :character   Class :character  
 Mode  :character   Mode  :character   Mode  :character   Mode  :character  
                                                                            
  PLN_AREA_C          REGION_N           REGION_C           INC_CRC         
 Length:332         Length:332         Length:332         Length:332        
 Class :character   Class :character   Class :character   Class :character  
 Mode  :character   Mode  :character   Mode  :character   Mode  :character  
                                                                            
  FMEL_UPD_D       
 Length:332        
 Class :character  
 Mode  :character  
                   </code></pre>
</div>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>mpsz <span class="ot">&lt;-</span> mpsz <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="st">'Name'</span>, <span class="st">'geometry'</span>, <span class="st">'SUBZONE_NO'</span>, <span class="st">'SUBZONE_N'</span>, <span class="st">'PLN_AREA_N'</span>, <span class="st">'PLN_AREA_C'</span>, <span class="st">'REGION_N'</span>, <span class="st">'REGION_C'</span>)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mpsz)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     Name                     geometry    SUBZONE_NO         SUBZONE_N        
 Length:332         MULTIPOLYGON  : 11   Length:332         Length:332        
 Class :character   MULTIPOLYGON Z:321   Class :character   Class :character  
 Mode  :character   epsg:4326     :  0   Mode  :character   Mode  :character  
                    +proj=long... :  0                                        
  PLN_AREA_N         PLN_AREA_C          REGION_N           REGION_C        
 Length:332         Length:332         Length:332         Length:332        
 Class :character   Class :character   Class :character   Class :character  
 Mode  :character   Mode  :character   Mode  :character   Mode  :character  
                                                                            </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(<span class="fu">which</span>(<span class="fu">st_is_valid</span>(mpsz) <span class="sc">==</span> <span class="cn">FALSE</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 6</code></pre>
</div>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>mpsz[<span class="fu">which</span>(<span class="fu">st_is_valid</span>(mpsz) <span class="sc">==</span> <span class="cn">FALSE</span>), ]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 6 features and 7 fields
Geometry type: MULTIPOLYGON
Dimension:     XY, XYZ
Bounding box:  xmin: 103.7098 ymin: 1.212326 xmax: 104.0885 ymax: 1.440698
z_range:       zmin: 0 zmax: 0
Geodetic CRS:  WGS 84
# A tibble: 6 × 8
  Name                       geometry SUBZONE_NO SUBZONE_N PLN_AREA_N PLN_AREA_C
  &lt;chr&gt;            &lt;MULTIPOLYGON [°]&gt; &lt;chr&gt;      &lt;chr&gt;     &lt;chr&gt;      &lt;chr&gt;     
1 kml_30  (((103.8591 1.22068, 103.8… 2          SOUTHERN… SOUTHERN … SI        
2 kml_31  (((103.8232 1.257481, 103.… 1          SENTOSA   SOUTHERN … SI        
3 kml_35  Z (((103.8236 1.260178 0, … 1          MARITIME… BUKIT MER… BM        
4 kml_59  Z (((103.9321 1.305548 0, … 7          SIGLAP    BEDOK      BD        
5 kml_109 (((103.7119 1.29961, 103.7… 10         JURONG P… JURONG EA… JE        
6 kml_318 (((104.0541 1.432306, 104.… 1          NORTH-EA… NORTH-EAS… NE        
# ℹ 2 more variables: REGION_N &lt;chr&gt;, REGION_C &lt;chr&gt;</code></pre>
</div>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>mpsz <span class="ot">&lt;-</span> <span class="fu">st_make_valid</span>(mpsz)</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>mpsz <span class="ot">&lt;-</span> <span class="fu">st_zm</span>(mpsz)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="importing-the-openstreetmaps-dataset" class="level4">
<h4 class="anchored" data-anchor-id="importing-the-openstreetmaps-dataset">Importing the OpenStreetMaps dataset</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>osm <span class="ot">=</span> <span class="fu">st_read</span>(<span class="st">"data/geospatial/osm.shp.zip"</span>, <span class="at">layer=</span><span class="st">"gis_osm_roads_free_1"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Reading layer `gis_osm_roads_free_1' from data source 
  `/Users/matthewho/Work/Y3S2/IS415/Website/IS415/TakeHomeEx/TakeHomeEx1/data/geospatial/osm.shp.zip' 
  using driver `ESRI Shapefile'
Simple feature collection with 1763129 features and 10 fields
Geometry type: LINESTRING
Dimension:     XY
Bounding box:  xmin: 99.66041 ymin: 0.8021131 xmax: 119.2601 ymax: 7.514393
Geodetic CRS:  WGS 84</code></pre>
</div>
</div>
</section>
</section>
<section id="wrangling" class="level3">
<h3 class="anchored" data-anchor-id="wrangling">3.2 Wrangling</h3>
<section id="grabposisi-conversion-to-spatial-data" class="level4">
<h4 class="anchored" data-anchor-id="grabposisi-conversion-to-spatial-data">GrabPosisi conversion to spatial data</h4>
<p>The GrabPosisi dataset consists of many points for each journey, represented with latitudes and longitudes. There are also many other fields representing speed and direction of the vehicle. We only need to know about the start and end locations.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(grabp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 9
  trj_id driving_mode osname  pingtimestamp rawlat rawlng speed bearing accuracy
  &lt;chr&gt;  &lt;chr&gt;        &lt;chr&gt;           &lt;int&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;   &lt;int&gt;    &lt;dbl&gt;
1 70014  car          android    1554943236   1.34   104.  18.9     248      3.9
2 73573  car          android    1555582623   1.32   104.  17.7      44      4  
3 75567  car          android    1555141026   1.33   104.  14.0      34      3.9
4 1410   car          android    1555731693   1.26   104.  13.0     181      4  
5 4354   car          android    1555584497   1.28   104.  14.8      93      3.9
6 32630  car          android    1555395258   1.30   104.  23.2      73      3.9</code></pre>
</div>
</div>
<p>The easiest thing to fix first is the timestamp. Doing so will allow us to find the first and last points of a journey easily. We also need to make sure that we account for timezones properly here, since the timestamps written as a time since the epoch.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>grabp<span class="sc">$</span>pingtimestamp <span class="ot">&lt;-</span> <span class="fu">as_datetime</span>(grabp<span class="sc">$</span>pingtimestamp, <span class="at">tz =</span> <span class="st">"Asia/Singapore"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now we convert the timestamp into weekdays, hours and days. This will help us temporally constrain our data later on.</p>
<p>We also convert the latitudes and longitudes to the SVY21 CRS system to give our task a standardised projection system.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>origin_df <span class="ot">&lt;-</span> grabp <span class="sc">%&gt;%</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(trj_id) <span class="sc">%&gt;%</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(pingtimestamp) <span class="sc">%&gt;%</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">row_number</span>()<span class="sc">==</span><span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">weekday =</span> <span class="fu">wday</span>(pingtimestamp,</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>                        <span class="at">label=</span><span class="cn">TRUE</span>,</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>                        <span class="at">abbr=</span><span class="cn">TRUE</span>),</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">start_hr =</span> <span class="fu">factor</span>(<span class="fu">hour</span>(pingtimestamp)),</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">day =</span> <span class="fu">factor</span>(<span class="fu">mday</span>(pingtimestamp))) <span class="sc">%&gt;%</span></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_as_sf</span>(<span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"rawlng"</span>, <span class="st">"rawlat"</span>),</span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>                      <span class="at">crs =</span> <span class="dv">4326</span>) <span class="sc">%&gt;%</span></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="at">crs =</span> <span class="dv">3414</span>)</span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a>destination_df <span class="ot">&lt;-</span> grabp <span class="sc">%&gt;%</span></span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(trj_id) <span class="sc">%&gt;%</span></span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(pingtimestamp)) <span class="sc">%&gt;%</span></span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">row_number</span>()<span class="sc">==</span><span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">weekday =</span> <span class="fu">wday</span>(pingtimestamp,</span>
<span id="cb22-19"><a href="#cb22-19" aria-hidden="true" tabindex="-1"></a>                        <span class="at">label=</span><span class="cn">TRUE</span>,</span>
<span id="cb22-20"><a href="#cb22-20" aria-hidden="true" tabindex="-1"></a>                        <span class="at">abbr=</span><span class="cn">TRUE</span>),</span>
<span id="cb22-21"><a href="#cb22-21" aria-hidden="true" tabindex="-1"></a>         <span class="at">end_hr =</span> <span class="fu">factor</span>(<span class="fu">hour</span>(pingtimestamp)),</span>
<span id="cb22-22"><a href="#cb22-22" aria-hidden="true" tabindex="-1"></a>         <span class="at">day =</span> <span class="fu">factor</span>(<span class="fu">mday</span>(pingtimestamp))) <span class="sc">%&gt;%</span></span>
<span id="cb22-23"><a href="#cb22-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_as_sf</span>(<span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"rawlng"</span>, <span class="st">"rawlat"</span>),</span>
<span id="cb22-24"><a href="#cb22-24" aria-hidden="true" tabindex="-1"></a>                      <span class="at">crs =</span> <span class="dv">4326</span>) <span class="sc">%&gt;%</span></span>
<span id="cb22-25"><a href="#cb22-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="at">crs =</span> <span class="dv">3414</span>)</span>
<span id="cb22-26"><a href="#cb22-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-27"><a href="#cb22-27" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(origin_df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 6 features and 10 fields
Geometry type: POINT
Dimension:     XY
Bounding box:  xmin: 17201.85 ymin: 29236.55 xmax: 31518.05 ymax: 47967.97
Projected CRS: SVY21 / Singapore TM
# A tibble: 6 × 11
# Groups:   trj_id [6]
  trj_id driving_mode osname pingtimestamp        speed bearing accuracy weekday
  &lt;chr&gt;  &lt;chr&gt;        &lt;chr&gt;  &lt;dttm&gt;               &lt;dbl&gt;   &lt;int&gt;    &lt;dbl&gt; &lt;ord&gt;  
1 70895  car          andro… 2019-04-08 08:09:26  9.95      111      4   Mon    
2 21926  car          andro… 2019-04-08 08:09:48 11.0        75      4   Mon    
3 47498  car          ios    2019-04-08 08:09:50 18.6       307      8   Mon    
4 18103  car          andro… 2019-04-08 08:09:55  0.404     159      3   Mon    
5 41322  car          andro… 2019-04-08 08:09:57 17.9       232      3.9 Mon    
6 64813  car          ios    2019-04-08 08:10:03 17.1       106     10   Mon    
# ℹ 3 more variables: start_hr &lt;fct&gt;, day &lt;fct&gt;, geometry &lt;POINT [m]&gt;</code></pre>
</div>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(destination_df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 6 features and 10 fields
Geometry type: POINT
Dimension:     XY
Bounding box:  xmin: 14101.2 ymin: 33097.49 xmax: 44192.98 ymax: 46866.96
Projected CRS: SVY21 / Singapore TM
# A tibble: 6 × 11
# Groups:   trj_id [6]
  trj_id driving_mode osname  pingtimestamp       speed bearing accuracy weekday
  &lt;chr&gt;  &lt;chr&gt;        &lt;chr&gt;   &lt;dttm&gt;              &lt;dbl&gt;   &lt;int&gt;    &lt;dbl&gt; &lt;ord&gt;  
1 81574  car          ios     2019-04-22 07:56:49 15.3      103     8    Mon    
2 54687  car          android 2019-04-22 07:56:46  8.15     299     4.55 Mon    
3 17190  car          android 2019-04-22 07:56:36 12.4      202     4    Mon    
4 13793  car          android 2019-04-22 07:56:30  6.47     170     3.9  Mon    
5 39014  car          ios     2019-04-22 07:56:27  3.59     169     4    Mon    
6 41170  car          ios     2019-04-22 07:56:13 13.1       71     5    Mon    
# ℹ 3 more variables: end_hr &lt;fct&gt;, day &lt;fct&gt;, geometry &lt;POINT [m]&gt;</code></pre>
</div>
</div>
<p>After converting some of our data and reducing it to only the trip starts and ends, we can drop the unused columns.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>origin_df <span class="ot">&lt;-</span> origin_df <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="st">'trj_id'</span>, <span class="st">'pingtimestamp'</span>, <span class="st">'geometry'</span>, <span class="st">'weekday'</span>, <span class="st">'start_hr'</span>, <span class="st">'day'</span>, <span class="st">'geometry'</span>)</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>destination_df <span class="ot">&lt;-</span> destination_df <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="st">'trj_id'</span>, <span class="st">'pingtimestamp'</span>, <span class="st">'geometry'</span>, <span class="st">'weekday'</span>, <span class="st">'end_hr'</span>, <span class="st">'day'</span>, <span class="st">'geometry'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This was a massive task in terms of computer memory. To make sure we don’t have to do this again, we can save the objects into .rds files. I would consider this an advantage over using Python.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">write_rds</span>(origin_df, <span class="st">"data/rds/origin.rds"</span>)</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="fu">write_rds</span>(destination_df, <span class="st">"data/rds/destination.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>destination_df <span class="ot">&lt;-</span> <span class="fu">read_rds</span>(<span class="st">"data/rds/destination.rds"</span>)</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>origin_df <span class="ot">&lt;-</span> <span class="fu">read_rds</span>(<span class="st">"data/rds/origin.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="openstreetmaps-reduction" class="level4">
<h4 class="anchored" data-anchor-id="openstreetmaps-reduction">OpenStreetMaps reduction</h4>
<p>There were many of ‘fclass’ values on the OpenStreetMaps documentation and I was not sure all of them existed in our dataset. It turns out that although there were more than expected, I can ‘whitelist’ some those that are definitely roads.</p>
<p>I found out about what each class meant from their documentation. <a href="https://www.geofabrik.de/data/geofabrik-osm-gis-standard-0.3.pdf" class="uri">https://www.geofabrik.de/data/geofabrik-osm-gis-standard-0.3.pdf</a></p>
<p>This was great since I had no idea what a Bridleway was.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(osm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    osm_id               code         fclass              name          
 Length:1763129     Min.   :5111   Length:1763129     Length:1763129    
 Class :character   1st Qu.:5122   Class :character   Class :character  
 Mode  :character   Median :5141   Mode  :character   Mode  :character  
                    Mean   :5132                                        
                    3rd Qu.:5141                                        
                    Max.   :5199                                        
     ref               oneway             maxspeed           layer         
 Length:1763129     Length:1763129     Min.   :  0.000   Min.   :-5.00000  
 Class :character   Class :character   1st Qu.:  0.000   1st Qu.: 0.00000  
 Mode  :character   Mode  :character   Median :  0.000   Median : 0.00000  
                                       Mean   :  3.148   Mean   : 0.02991  
                                       3rd Qu.:  0.000   3rd Qu.: 0.00000  
                                       Max.   :110.000   Max.   : 5.00000  
    bridge             tunnel                   geometry      
 Length:1763129     Length:1763129     LINESTRING   :1763129  
 Class :character   Class :character   epsg:4326    :      0  
 Mode  :character   Mode  :character   +proj=long...:      0  
                                                              
                                                              
                                                              </code></pre>
</div>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(osm<span class="sc">$</span>fclass)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "primary"        "secondary"      "residential"    "service"       
 [5] "track"          "tertiary"       "footway"        "primary_link"  
 [9] "motorway_link"  "tertiary_link"  "motorway"       "unclassified"  
[13] "trunk"          "trunk_link"     "secondary_link" "pedestrian"    
[17] "living_street"  "path"           "steps"          "cycleway"      
[21] "track_grade2"   "track_grade4"   "track_grade1"   "track_grade3"  
[25] "unknown"        "track_grade5"   "bridleway"     </code></pre>
</div>
</div>
<p>Of the above fclasses, these ones are definitely roads. We will keep them in our dataset.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>values_to_keep <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"primary"</span>, <span class="st">"secondary"</span>, <span class="st">"residential"</span>, <span class="st">"service"</span>, <span class="st">"tertiary"</span>, <span class="st">"primary_link"</span>, <span class="st">"motorway"</span>, <span class="st">"motorway_link"</span>, <span class="st">"tertiary_link"</span>, <span class="st">"living_street"</span>, <span class="st">"trunk"</span>, <span class="st">"trunk_link"</span>)</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>osm <span class="ot">&lt;-</span> osm[osm<span class="sc">$</span>fclass <span class="sc">%in%</span> values_to_keep, ]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>From this, we have confirmed that we have dropped the unnecessary fclasses and greatly reduced the size of our data. However, to geographically constrain this dataset to Singapore, we need to process the MasterPlanSubzone data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(osm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    osm_id               code         fclass              name          
 Length:1417871     Min.   :5111   Length:1417871     Length:1417871    
 Class :character   1st Qu.:5122   Class :character   Class :character  
 Mode  :character   Median :5132   Mode  :character   Mode  :character  
                    Mean   :5131                                        
                    3rd Qu.:5141                                        
                    Max.   :5141                                        
     ref               oneway             maxspeed           layer         
 Length:1417871     Length:1417871     Min.   :  0.000   Min.   :-5.00000  
 Class :character   Class :character   1st Qu.:  0.000   1st Qu.: 0.00000  
 Mode  :character   Mode  :character   Median :  0.000   Median : 0.00000  
                                       Mean   :  3.665   Mean   : 0.02351  
                                       3rd Qu.:  0.000   3rd Qu.: 0.00000  
                                       Max.   :110.000   Max.   : 5.00000  
    bridge             tunnel                   geometry      
 Length:1417871     Length:1417871     LINESTRING   :1417871  
 Class :character   Class :character   epsg:4326    :      0  
 Mode  :character   Mode  :character   +proj=long...:      0  
                                                              
                                                              
                                                              </code></pre>
</div>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(osm<span class="sc">$</span>fclass)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "primary"       "secondary"     "residential"   "service"      
 [5] "tertiary"      "primary_link"  "motorway_link" "tertiary_link"
 [9] "motorway"      "trunk"         "trunk_link"    "living_street"</code></pre>
</div>
</div>
<p>For our purposes, the road data will only need to serve as a network, without all of the extra data. However, osm_id fclass may be useful later on and are relatively small. We can keep them.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>osm <span class="ot">&lt;-</span> osm <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="st">'osm_id'</span>, <span class="st">'fclass'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="crs-adjustments-and-verification" class="level3">
<h3 class="anchored" data-anchor-id="crs-adjustments-and-verification">3.3 CRS Adjustments and Verification</h3>
<section id="openstreetmaps-and-masterplansubzone-crs" class="level4">
<h4 class="anchored" data-anchor-id="openstreetmaps-and-masterplansubzone-crs">OpenStreetMaps and MasterPlanSubzone CRS</h4>
<p>It’s now time to go a bit deeper with the data wrangling now that the size of our data has decreased. First thing to do is to check the CRS for the MPSZ and OpenStreetMaps data since we have not already done so.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="fu">st_crs</span>(mpsz)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Coordinate Reference System:
  User input: WGS 84 
  wkt:
GEOGCRS["WGS 84",
    DATUM["World Geodetic System 1984",
        ELLIPSOID["WGS 84",6378137,298.257223563,
            LENGTHUNIT["metre",1]]],
    PRIMEM["Greenwich",0,
        ANGLEUNIT["degree",0.0174532925199433]],
    CS[ellipsoidal,2],
        AXIS["geodetic latitude (Lat)",north,
            ORDER[1],
            ANGLEUNIT["degree",0.0174532925199433]],
        AXIS["geodetic longitude (Lon)",east,
            ORDER[2],
            ANGLEUNIT["degree",0.0174532925199433]],
    ID["EPSG",4326]]</code></pre>
</div>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="fu">st_crs</span>(osm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Coordinate Reference System:
  User input: WGS 84 
  wkt:
GEOGCRS["WGS 84",
    DATUM["World Geodetic System 1984",
        ELLIPSOID["WGS 84",6378137,298.257223563,
            LENGTHUNIT["metre",1]]],
    PRIMEM["Greenwich",0,
        ANGLEUNIT["degree",0.0174532925199433]],
    CS[ellipsoidal,2],
        AXIS["latitude",north,
            ORDER[1],
            ANGLEUNIT["degree",0.0174532925199433]],
        AXIS["longitude",east,
            ORDER[2],
            ANGLEUNIT["degree",0.0174532925199433]],
    ID["EPSG",4326]]</code></pre>
</div>
</div>
<p>Like in the previous exercises, the CRS for these are not SVY21. We will change them since GovTech is yet to do so.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>osm <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(osm, <span class="at">crs =</span> <span class="dv">3414</span>)</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>mpsz <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(mpsz, <span class="at">crs =</span> <span class="dv">3414</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="dealing-with-mpsz-z-coordinates-and-invalid-geometry" class="level4">
<h4 class="anchored" data-anchor-id="dealing-with-mpsz-z-coordinates-and-invalid-geometry">Dealing with MPSZ z-coordinates and invalid geometry</h4>
<p>To prevent issues with invalid geometry causing issues later on, we can apply a quick fix here.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(<span class="fu">which</span>(<span class="fu">st_is_valid</span>(mpsz) <span class="sc">==</span> <span class="cn">FALSE</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0</code></pre>
</div>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>mpsz[<span class="fu">which</span>(<span class="fu">st_is_valid</span>(mpsz) <span class="sc">==</span> <span class="cn">FALSE</span>), ]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 0 features and 7 fields
Bounding box:  xmin: NA ymin: NA xmax: NA ymax: NA
Projected CRS: SVY21 / Singapore TM
# A tibble: 0 × 8
# ℹ 8 variables: Name &lt;chr&gt;, geometry &lt;GEOMETRY [m]&gt;, SUBZONE_NO &lt;chr&gt;,
#   SUBZONE_N &lt;chr&gt;, PLN_AREA_N &lt;chr&gt;, PLN_AREA_C &lt;chr&gt;, REGION_N &lt;chr&gt;,
#   REGION_C &lt;chr&gt;</code></pre>
</div>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>mpsz <span class="ot">&lt;-</span> <span class="fu">st_make_valid</span>(mpsz)</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>mpsz <span class="ot">&lt;-</span> <span class="fu">st_zm</span>(mpsz)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>A quick check confirms that the CRS has been changed successfully to SVY21</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="fu">st_crs</span>(mpsz)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Coordinate Reference System:
  User input: EPSG:3414 
  wkt:
PROJCRS["SVY21 / Singapore TM",
    BASEGEOGCRS["SVY21",
        DATUM["SVY21",
            ELLIPSOID["WGS 84",6378137,298.257223563,
                LENGTHUNIT["metre",1]]],
        PRIMEM["Greenwich",0,
            ANGLEUNIT["degree",0.0174532925199433]],
        ID["EPSG",4757]],
    CONVERSION["Singapore Transverse Mercator",
        METHOD["Transverse Mercator",
            ID["EPSG",9807]],
        PARAMETER["Latitude of natural origin",1.36666666666667,
            ANGLEUNIT["degree",0.0174532925199433],
            ID["EPSG",8801]],
        PARAMETER["Longitude of natural origin",103.833333333333,
            ANGLEUNIT["degree",0.0174532925199433],
            ID["EPSG",8802]],
        PARAMETER["Scale factor at natural origin",1,
            SCALEUNIT["unity",1],
            ID["EPSG",8805]],
        PARAMETER["False easting",28001.642,
            LENGTHUNIT["metre",1],
            ID["EPSG",8806]],
        PARAMETER["False northing",38744.572,
            LENGTHUNIT["metre",1],
            ID["EPSG",8807]]],
    CS[Cartesian,2],
        AXIS["northing (N)",north,
            ORDER[1],
            LENGTHUNIT["metre",1]],
        AXIS["easting (E)",east,
            ORDER[2],
            LENGTHUNIT["metre",1]],
    USAGE[
        SCOPE["Cadastre, engineering survey, topographic mapping."],
        AREA["Singapore - onshore and offshore."],
        BBOX[1.13,103.59,1.47,104.07]],
    ID["EPSG",3414]]</code></pre>
</div>
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="fu">st_crs</span>(osm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Coordinate Reference System:
  User input: EPSG:3414 
  wkt:
PROJCRS["SVY21 / Singapore TM",
    BASEGEOGCRS["SVY21",
        DATUM["SVY21",
            ELLIPSOID["WGS 84",6378137,298.257223563,
                LENGTHUNIT["metre",1]]],
        PRIMEM["Greenwich",0,
            ANGLEUNIT["degree",0.0174532925199433]],
        ID["EPSG",4757]],
    CONVERSION["Singapore Transverse Mercator",
        METHOD["Transverse Mercator",
            ID["EPSG",9807]],
        PARAMETER["Latitude of natural origin",1.36666666666667,
            ANGLEUNIT["degree",0.0174532925199433],
            ID["EPSG",8801]],
        PARAMETER["Longitude of natural origin",103.833333333333,
            ANGLEUNIT["degree",0.0174532925199433],
            ID["EPSG",8802]],
        PARAMETER["Scale factor at natural origin",1,
            SCALEUNIT["unity",1],
            ID["EPSG",8805]],
        PARAMETER["False easting",28001.642,
            LENGTHUNIT["metre",1],
            ID["EPSG",8806]],
        PARAMETER["False northing",38744.572,
            LENGTHUNIT["metre",1],
            ID["EPSG",8807]]],
    CS[Cartesian,2],
        AXIS["northing (N)",north,
            ORDER[1],
            LENGTHUNIT["metre",1]],
        AXIS["easting (E)",east,
            ORDER[2],
            LENGTHUNIT["metre",1]],
    USAGE[
        SCOPE["Cadastre, engineering survey, topographic mapping."],
        AREA["Singapore - onshore and offshore."],
        BBOX[1.13,103.59,1.47,104.07]],
    ID["EPSG",3414]]</code></pre>
</div>
</div>
</section>
</section>
<section id="singapore-boundaries" class="level3">
<h3 class="anchored" data-anchor-id="singapore-boundaries">3.4 Singapore Boundaries</h3>
<p>From this plot, I realised that there were more islands than I thought surrounding Singapore.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(mpsz))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="THE1_files/figure-html/unnamed-chunk-23-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Based on the above plot, it became apparent that I needed to define what an “Outer Island” meant in relation to our task.</p>
<section id="outer-island-definition" class="level4">
<h4 class="anchored" data-anchor-id="outer-island-definition">Outer Island Definition</h4>
<p>An island in Singapore inaccessible by road</p>
<p>Therefore, Coney Island, Jurong Island and Sentosa are not outer islands.</p>
<p>Pulau Ubin and Pulau Tekong are examples of outer islands.</p>
<p>To remove the islands, I discovered a trick. After using st_union, st_cast can be used to split disconnected polygons in the larger multipolygon. I then choose the largest one (the mainland). Fortunately, the bridges to Serangoon island were enough to stick the whole of road-accessible Singapore together while excluding areas like Tekong.</p>
<p>We can also use fill_holes to remove any gaps in geometry.</p>
<p>After this process, we are left with a clean outline of Singapore!</p>
</section>
<section id="outer-island-removal-and-hole-fixing" class="level4">
<h4 class="anchored" data-anchor-id="outer-island-removal-and-hole-fixing">Outer Island Removal and Hole Fixing</h4>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-1-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-1" role="tab" aria-controls="tabset-1-1" aria-selected="true">Original</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-2" role="tab" aria-controls="tabset-1-2" aria-selected="false">Merged</a></li></ul>
<div class="tab-content">
<div id="tabset-1-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-1-1-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>merged_sg <span class="ot">&lt;-</span> <span class="fu">st_union</span>(mpsz) <span class="sc">%&gt;%</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">st_cast</span>(<span class="st">"POLYGON"</span>)</span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a>merged_sg <span class="ot">&lt;-</span> merged_sg[<span class="fu">c</span>(<span class="dv">10</span>)]</span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a>merged_sg <span class="ot">&lt;-</span> <span class="fu">fill_holes</span>(merged_sg, units<span class="sc">::</span><span class="fu">set_units</span>(<span class="dv">1</span>, <span class="st">"km^2"</span>))</span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a>merged_sg <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(merged_sg)</span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>))</span>
<span id="cb54-8"><a href="#cb54-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-9"><a href="#cb54-9" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(mpsz))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="THE1_files/figure-html/unnamed-chunk-24-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-1-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(merged_sg))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="THE1_files/figure-html/unnamed-chunk-25-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="applying-the-outline" class="level4">
<h4 class="anchored" data-anchor-id="applying-the-outline">Applying the outline</h4>
<p>With the outline, we can create an owin object to constrain our ppp objects later for KDE! We will save it to save us processing time later on.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>merged_st <span class="ot">&lt;-</span> <span class="fu">as_Spatial</span>(merged_sg)</span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>merged_sg_sp <span class="ot">&lt;-</span> <span class="fu">as</span>(merged_st, <span class="st">"SpatialPolygons"</span>)</span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>merged_sg_owin <span class="ot">&lt;-</span> <span class="fu">as</span>(merged_sg_sp, <span class="st">"owin"</span>)</span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a><span class="fu">write_rds</span>(merged_sg_owin, <span class="st">"data/rds/merged_sg_owin.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>merged_sg_owin <span class="ot">&lt;-</span> <span class="fu">read_rds</span>(<span class="st">"data/rds/merged_sg_owin.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now we use the outline to remove the massive amount of data on Malaysian and Bruneian roads.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>osm_sg <span class="ot">&lt;-</span> <span class="fu">st_intersection</span>(osm, merged_sg)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>An unexpected complication found here was that some geometry in OpenStreetMaps was saved as MULTILINESTRINGs. While this would be intuitive sometimes, it caused issues with KDE calculation. Here, I split each MULTILNESTRING into several LINESTRINGs.</p>
<p>After this processing, I save the result</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(osm_sg)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    osm_id             fclass                     geometry     
 Length:157777      Length:157777      LINESTRING     :157720  
 Class :character   Class :character   MULTILINESTRING:    57  
 Mode  :character   Mode  :character   epsg:3414      :     0  
                                       +proj=tmer...  :     0  </code></pre>
</div>
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>osm_sg <span class="ot">&lt;-</span> <span class="fu">st_cast</span>(<span class="fu">st_cast</span>(osm_sg, <span class="st">"MULTILINESTRING"</span>),<span class="st">"LINESTRING"</span>)</span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(osm_sg)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    osm_id             fclass                   geometry     
 Length:157836      Length:157836      LINESTRING   :157836  
 Class :character   Class :character   epsg:3414    :     0  
 Mode  :character   Mode  :character   +proj=tmer...:     0  </code></pre>
</div>
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="fu">write_rds</span>(osm_sg, <span class="st">"data/rds/osm_sg.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>osm_sg <span class="ot">&lt;-</span> <span class="fu">read_rds</span>(<span class="st">"data/rds/osm_sg.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="ppp-format" class="level4">
<h4 class="anchored" data-anchor-id="ppp-format">ppp Format</h4>
<p>To prepare our the data on trip starts and ends, we convert them into ppp objects.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>origin <span class="ot">&lt;-</span> <span class="fu">as_Spatial</span>(origin_df)</span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>destination <span class="ot">&lt;-</span> <span class="fu">as_Spatial</span>(destination_df)</span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a>origin_sp <span class="ot">&lt;-</span> <span class="fu">as</span>(origin, <span class="st">"SpatialPoints"</span>)</span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a>destination_sp <span class="ot">&lt;-</span> <span class="fu">as</span>(destination, <span class="st">"SpatialPoints"</span>)</span>
<span id="cb65-6"><a href="#cb65-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-7"><a href="#cb65-7" aria-hidden="true" tabindex="-1"></a>origin_ppp <span class="ot">&lt;-</span> <span class="fu">as</span>(origin_sp, <span class="st">"ppp"</span>)</span>
<span id="cb65-8"><a href="#cb65-8" aria-hidden="true" tabindex="-1"></a>destination_ppp <span class="ot">&lt;-</span> <span class="fu">as</span>(destination_sp, <span class="st">"ppp"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Using our previously prepared owin objects, we can constrain these points to only Singapore, in case any of the data was strangely placed outside of our borders.</p>
<p>This happened for 3 destinations. Regardless of whether these were caused by inaccuracy due to GPS drift near the coast or otherwise, the loss of these 3 points should not influence our downstream analysis by much. As such, it can be deemed an acceptable loss due to erring on the side of caution.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(destination_ppp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Planar point pattern:  28000 points
Average intensity 2.493661e-05 points per square unit

Coordinates are given to 3 decimal places
i.e. rounded to the nearest multiple of 0.001 units

Window: rectangle = [3637.21, 49870.63] x [25221.3, 49507.79] units
                    (46230 x 24290 units)
Window area = 1122850000 square units</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>origin_ppp <span class="ot">&lt;-</span> origin_ppp[merged_sg_owin]</span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>destination_ppp <span class="ot">&lt;-</span> destination_ppp[merged_sg_owin]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(destination_ppp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Planar point pattern:  27997 points
Average intensity 3.99481e-05 points per square unit

Coordinates are given to 3 decimal places
i.e. rounded to the nearest multiple of 0.001 units

Window: polygonal boundary
single connected closed polygon with 15268 vertices
enclosing rectangle: [2667.54, 51404.13] x [21448.48, 50256.33] units
                     (48740 x 28810 units)
Window area = 700834000 square units
Fraction of frame area: 0.499</code></pre>
</div>
</div>
</section>
<section id="checking-for-duplicates" class="level4">
<h4 class="anchored" data-anchor-id="checking-for-duplicates">Checking for duplicates</h4>
<p>Fortunately, no duplicates were detected in our dataset.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="fu">any</span>(<span class="fu">duplicated</span>(origin_ppp))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] FALSE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="fu">any</span>(<span class="fu">duplicated</span>(destination_ppp))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] FALSE</code></pre>
</div>
</div>
</section>
</section>
<section id="simple-visualisations" class="level3">
<h3 class="anchored" data-anchor-id="simple-visualisations">3.5 Simple Visualisations</h3>
<p>From these plots, we can tell that naive methods of checking for patterns in spatial points does not work very well with large datasets. This is when we use KDE.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(origin_ppp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="THE1_files/figure-html/unnamed-chunk-36-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(destination_ppp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="THE1_files/figure-html/unnamed-chunk-36-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="kde" class="level2">
<h2 class="anchored" data-anchor-id="kde">4.0 KDE</h2>
<p>After all the wrangling, we can finally see our Kernel Density Estimates for origin and destinations! I first tried the quartic kernel with an automatically decided bandwidth, but realised that apart from Changi Airport, the rest of Singapore seemed dark.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-2-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-1" role="tab" aria-controls="tabset-2-1" aria-selected="true">Origins</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-2" role="tab" aria-controls="tabset-2-2" aria-selected="false">Destinations</a></li></ul>
<div class="tab-content">
<div id="tabset-2-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-2-1-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a>origin_ppp.km <span class="ot">&lt;-</span> <span class="fu">rescale</span>(origin_ppp, <span class="dv">1000</span>, <span class="st">"km"</span>)</span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a>origin.bw <span class="ot">&lt;-</span> <span class="fu">density</span>(origin_ppp.km,</span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a>                              <span class="at">sigma=</span>bw.diggle,</span>
<span id="cb77-5"><a href="#cb77-5" aria-hidden="true" tabindex="-1"></a>                              <span class="at">edge=</span><span class="cn">TRUE</span>,</span>
<span id="cb77-6"><a href="#cb77-6" aria-hidden="true" tabindex="-1"></a>                            <span class="at">kernel=</span><span class="st">"quartic"</span>) </span>
<span id="cb77-7"><a href="#cb77-7" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(origin.bw)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="THE1_files/figure-html/unnamed-chunk-37-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-2-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a>destination_ppp.km <span class="ot">&lt;-</span> <span class="fu">rescale</span>(destination_ppp, <span class="dv">1000</span>, <span class="st">"km"</span>)</span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a>destination.bw <span class="ot">&lt;-</span> <span class="fu">density</span>(destination_ppp.km,</span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a>                              <span class="at">sigma=</span>bw.diggle,</span>
<span id="cb78-5"><a href="#cb78-5" aria-hidden="true" tabindex="-1"></a>                              <span class="at">edge=</span><span class="cn">TRUE</span>,</span>
<span id="cb78-6"><a href="#cb78-6" aria-hidden="true" tabindex="-1"></a>                            <span class="at">kernel=</span><span class="st">"quartic"</span>) </span>
<span id="cb78-7"><a href="#cb78-7" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(destination.bw)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="THE1_files/figure-html/unnamed-chunk-38-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</div>
<p>I then tried the more gently sloping Gaussian kernel, to little effect.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-3-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-1" role="tab" aria-controls="tabset-3-1" aria-selected="true">Origins</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-3-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-2" role="tab" aria-controls="tabset-3-2" aria-selected="false">Destinations</a></li></ul>
<div class="tab-content">
<div id="tabset-3-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-3-1-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a>origin_ppp.km <span class="ot">&lt;-</span> <span class="fu">rescale</span>(origin_ppp, <span class="dv">1000</span>, <span class="st">"km"</span>)</span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a>origin.bw <span class="ot">&lt;-</span> <span class="fu">density</span>(origin_ppp.km,</span>
<span id="cb79-4"><a href="#cb79-4" aria-hidden="true" tabindex="-1"></a>                              <span class="at">sigma=</span>bw.diggle,</span>
<span id="cb79-5"><a href="#cb79-5" aria-hidden="true" tabindex="-1"></a>                              <span class="at">edge=</span><span class="cn">TRUE</span>,</span>
<span id="cb79-6"><a href="#cb79-6" aria-hidden="true" tabindex="-1"></a>                            <span class="at">kernel=</span><span class="st">"gaussian"</span>) </span>
<span id="cb79-7"><a href="#cb79-7" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(origin.bw)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="THE1_files/figure-html/unnamed-chunk-39-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-3-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-3-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a>destination_ppp.km <span class="ot">&lt;-</span> <span class="fu">rescale</span>(destination_ppp, <span class="dv">1000</span>, <span class="st">"km"</span>)</span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a>destination.bw <span class="ot">&lt;-</span> <span class="fu">density</span>(destination_ppp.km,</span>
<span id="cb80-4"><a href="#cb80-4" aria-hidden="true" tabindex="-1"></a>                              <span class="at">sigma=</span>bw.diggle,</span>
<span id="cb80-5"><a href="#cb80-5" aria-hidden="true" tabindex="-1"></a>                              <span class="at">edge=</span><span class="cn">TRUE</span>,</span>
<span id="cb80-6"><a href="#cb80-6" aria-hidden="true" tabindex="-1"></a>                            <span class="at">kernel=</span><span class="st">"gaussian"</span>) </span>
<span id="cb80-7"><a href="#cb80-7" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(destination.bw)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="THE1_files/figure-html/unnamed-chunk-40-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</div>
<p>I decided to check the bandwidth derived with the Diggle algorithm, which was surprisingly small, at 8m. I strongly suspect this to be caused by Changi airport, where a huge number of Grab trips start and end at the same few small dropoff/pickup points.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a>bw <span class="ot">&lt;-</span> <span class="fu">bw.diggle</span>(destination_ppp.km)</span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a>bw</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      sigma 
0.008286046 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a>bw <span class="ot">&lt;-</span> <span class="fu">bw.ppl</span>(destination_ppp.km)</span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a>bw</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    sigma 
0.1826625 </code></pre>
</div>
</div>
<p>I then tried the PPL algorithm’s bandwidth, which did not have a significant effect either.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-4-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-1" role="tab" aria-controls="tabset-4-1" aria-selected="true">Origins</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-4-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-2" role="tab" aria-controls="tabset-4-2" aria-selected="false">Destinations</a></li></ul>
<div class="tab-content">
<div id="tabset-4-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-4-1-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a>origin_ppp.km <span class="ot">&lt;-</span> <span class="fu">rescale</span>(origin_ppp, <span class="dv">1000</span>, <span class="st">"km"</span>)</span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-3"><a href="#cb85-3" aria-hidden="true" tabindex="-1"></a>origin.bw <span class="ot">&lt;-</span> <span class="fu">density</span>(origin_ppp.km,</span>
<span id="cb85-4"><a href="#cb85-4" aria-hidden="true" tabindex="-1"></a>                              <span class="at">sigma=</span>bw.ppl,</span>
<span id="cb85-5"><a href="#cb85-5" aria-hidden="true" tabindex="-1"></a>                              <span class="at">edge=</span><span class="cn">TRUE</span>,</span>
<span id="cb85-6"><a href="#cb85-6" aria-hidden="true" tabindex="-1"></a>                            <span class="at">kernel=</span><span class="st">"gaussian"</span>) </span>
<span id="cb85-7"><a href="#cb85-7" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(origin.bw)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="THE1_files/figure-html/unnamed-chunk-42-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-4-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-4-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a>destination_ppp.km <span class="ot">&lt;-</span> <span class="fu">rescale</span>(destination_ppp, <span class="dv">1000</span>, <span class="st">"km"</span>)</span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true" tabindex="-1"></a>destination.bw <span class="ot">&lt;-</span> <span class="fu">density</span>(destination_ppp.km,</span>
<span id="cb86-4"><a href="#cb86-4" aria-hidden="true" tabindex="-1"></a>                              <span class="at">sigma=</span>bw.ppl,</span>
<span id="cb86-5"><a href="#cb86-5" aria-hidden="true" tabindex="-1"></a>                              <span class="at">edge=</span><span class="cn">TRUE</span>,</span>
<span id="cb86-6"><a href="#cb86-6" aria-hidden="true" tabindex="-1"></a>                            <span class="at">kernel=</span><span class="st">"gaussian"</span>) </span>
<span id="cb86-7"><a href="#cb86-7" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(destination.bw)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="THE1_files/figure-html/unnamed-chunk-43-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</div>
<p>I then tried to manually set a higher bandwidth in hopes of illuminating the map more.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-5-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-5-1" role="tab" aria-controls="tabset-5-1" aria-selected="true">Origins</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-5-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-5-2" role="tab" aria-controls="tabset-5-2" aria-selected="false">Destinations</a></li></ul>
<div class="tab-content">
<div id="tabset-5-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-5-1-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a>sigm <span class="ot">&lt;-</span> <span class="fl">0.5</span></span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a>origin_ppp.km <span class="ot">&lt;-</span> <span class="fu">rescale</span>(origin_ppp, <span class="dv">1000</span>, <span class="st">"km"</span>)</span>
<span id="cb87-3"><a href="#cb87-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-4"><a href="#cb87-4" aria-hidden="true" tabindex="-1"></a>origin.bw <span class="ot">&lt;-</span> <span class="fu">density</span>(origin_ppp.km,</span>
<span id="cb87-5"><a href="#cb87-5" aria-hidden="true" tabindex="-1"></a>                              <span class="at">sigma=</span>sigm,</span>
<span id="cb87-6"><a href="#cb87-6" aria-hidden="true" tabindex="-1"></a>                              <span class="at">edge=</span><span class="cn">TRUE</span>,</span>
<span id="cb87-7"><a href="#cb87-7" aria-hidden="true" tabindex="-1"></a>                            <span class="at">kernel=</span><span class="st">"gaussian"</span>) </span>
<span id="cb87-8"><a href="#cb87-8" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(origin.bw)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="THE1_files/figure-html/unnamed-chunk-44-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-5-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-5-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a>destination_ppp.km <span class="ot">&lt;-</span> <span class="fu">rescale</span>(destination_ppp, <span class="dv">1000</span>, <span class="st">"km"</span>)</span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-3"><a href="#cb88-3" aria-hidden="true" tabindex="-1"></a>destination.bw <span class="ot">&lt;-</span> <span class="fu">density</span>(destination_ppp.km,</span>
<span id="cb88-4"><a href="#cb88-4" aria-hidden="true" tabindex="-1"></a>                              <span class="at">sigma=</span>sigm,</span>
<span id="cb88-5"><a href="#cb88-5" aria-hidden="true" tabindex="-1"></a>                              <span class="at">edge=</span><span class="cn">TRUE</span>,</span>
<span id="cb88-6"><a href="#cb88-6" aria-hidden="true" tabindex="-1"></a>                            <span class="at">kernel=</span><span class="st">"gaussian"</span>) </span>
<span id="cb88-7"><a href="#cb88-7" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(destination.bw)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="THE1_files/figure-html/unnamed-chunk-45-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</div>
<section id="kde-insights" class="level4">
<h4 class="anchored" data-anchor-id="kde-insights">KDE Insights</h4>
<p>From these KDE maps, I observed</p>
<ul>
<li><p>Changi Airport and the CBD are frequently the origin and destination for Grab trips</p></li>
<li><p>Interestingly, the maps are different. It seems that there are more trips from presumably more residential areas such as the West and North to the CBD than the other way round. Perhaps people use grab when they are in a rush to get to work and take their time on the way home with public transport.</p></li>
<li><p>In both the origin and destination KDEs, there is a hotspot in the north, slightly to the west. That could correspond to the Woodlands checkpoint</p></li>
</ul>
</section>
</section>
<section id="nkde" class="level2">
<h2 class="anchored" data-anchor-id="nkde">5.0 NKDE</h2>
<section id="study-areas" class="level3">
<h3 class="anchored" data-anchor-id="study-areas">Study Areas</h3>
<p>In the MPSZ dataset, some areas are conveniently segmented by PLN_AREA, making it easy to extract areas of interest. From the KDE results above, we ca choose several of the interesting zones below for NKDE.</p>
<ul>
<li>CHANGI: For the airport</li>
<li>WOODLANDS: For the checkpoint and residential areas</li>
<li>DOWNTOWN CORE, ORCHARD: The CBD and “town” area</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sort</span>(<span class="fu">unique</span>(mpsz<span class="sc">$</span>PLN_AREA_N))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "ANG MO KIO"              "BEDOK"                  
 [3] "BISHAN"                  "BOON LAY"               
 [5] "BUKIT BATOK"             "BUKIT MERAH"            
 [7] "BUKIT PANJANG"           "BUKIT TIMAH"            
 [9] "CENTRAL WATER CATCHMENT" "CHANGI"                 
[11] "CHANGI BAY"              "CHOA CHU KANG"          
[13] "CLEMENTI"                "DOWNTOWN CORE"          
[15] "GEYLANG"                 "HOUGANG"                
[17] "JURONG EAST"             "JURONG WEST"            
[19] "KALLANG"                 "LIM CHU KANG"           
[21] "MANDAI"                  "MARINA EAST"            
[23] "MARINA SOUTH"            "MARINE PARADE"          
[25] "MUSEUM"                  "NEWTON"                 
[27] "NORTH-EASTERN ISLANDS"   "NOVENA"                 
[29] "ORCHARD"                 "OUTRAM"                 
[31] "PASIR RIS"               "PAYA LEBAR"             
[33] "PIONEER"                 "PUNGGOL"                
[35] "QUEENSTOWN"              "RIVER VALLEY"           
[37] "ROCHOR"                  "SELETAR"                
[39] "SEMBAWANG"               "SENGKANG"               
[41] "SERANGOON"               "SIMPANG"                
[43] "SINGAPORE RIVER"         "SOUTHERN ISLANDS"       
[45] "STRAITS VIEW"            "SUNGEI KADUT"           
[47] "TAMPINES"                "TANGLIN"                
[49] "TENGAH"                  "TOA PAYOH"              
[51] "TUAS"                    "WESTERN ISLANDS"        
[53] "WESTERN WATER CATCHMENT" "WOODLANDS"              
[55] "YISHUN"                 </code></pre>
</div>
</div>
</section>
<section id="changi-airport" class="level3">
<h3 class="anchored" data-anchor-id="changi-airport">5.1 Changi Airport</h3>
<section id="nkde-data-preparation" class="level4">
<h4 class="anchored" data-anchor-id="nkde-data-preparation">NKDE Data Preparation</h4>
<p>First, we restrict the area of our NKDE to CHANGI. We can also remove the possibility of small rocks or outer islands on the map by taking the intersection with merged_sg (Our outline).</p>
<p>Next, we take only the roads that come into contact with Changi. I did not use st_intersection alone because it cut off some roads into points, and other undesirable geometry. This means that our subset of roads may protrude out of Changi, but that can be solved with the NKDE functions’s study_area parameter and edge correction.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a>mpsz_changi <span class="ot">=</span> mpsz <span class="sc">%&gt;%</span> <span class="fu">filter</span>(PLN_AREA_N<span class="sc">==</span><span class="st">"CHANGI"</span>)</span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a>mpsz_changi <span class="ot">&lt;-</span> <span class="fu">st_intersection</span>(mpsz_changi, merged_sg)</span>
<span id="cb91-3"><a href="#cb91-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-4"><a href="#cb91-4" aria-hidden="true" tabindex="-1"></a>osm_changi_i <span class="ot">&lt;-</span> <span class="fu">st_intersection</span>(osm_sg, mpsz_changi)</span>
<span id="cb91-5"><a href="#cb91-5" aria-hidden="true" tabindex="-1"></a>osm_changi_idxs <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(osm_changi_i<span class="sc">$</span>osm_id)</span>
<span id="cb91-6"><a href="#cb91-6" aria-hidden="true" tabindex="-1"></a>osm_changi <span class="ot">&lt;-</span> osm_sg[osm_sg<span class="sc">$</span>osm_id <span class="sc">%in%</span> osm_changi_idxs, ]</span>
<span id="cb91-7"><a href="#cb91-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-8"><a href="#cb91-8" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(osm_changi)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="THE1_files/figure-html/unnamed-chunk-47-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>We also need to take only the events that happened within Changi. We do this with st_intersection. This is much easier since the events are points.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-6-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-6-1" role="tab" aria-controls="tabset-6-1" aria-selected="true">Destinations w/o Snap</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-6-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-6-2" role="tab" aria-controls="tabset-6-2" aria-selected="false">Origins w/o Snap</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-6-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-6-3" role="tab" aria-controls="tabset-6-3" aria-selected="false">Destinations w/ Snap</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-6-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-6-4" role="tab" aria-controls="tabset-6-4" aria-selected="false">Origins w/ Snap</a></li></ul>
<div class="tab-content">
<div id="tabset-6-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-6-1-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a>destination_df.changi <span class="ot">=</span> <span class="fu">st_intersection</span>(destination_df, mpsz_changi)</span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a>origin_df.changi <span class="ot">=</span> <span class="fu">st_intersection</span>(origin_df, mpsz_changi)</span>
<span id="cb92-3"><a href="#cb92-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-4"><a href="#cb92-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(destination_df.changi)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="THE1_files/figure-html/unnamed-chunk-48-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-6-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-6-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(origin_df.changi)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="THE1_files/figure-html/unnamed-chunk-49-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>As part of NKDE, the events need to have happened on the network. As such, we use snapPointsToLines2 to ensure that the points are on the network. Points off the network may have occurred due to slight GPS drift.</p>
</div>
<div id="tabset-6-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-6-3-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a>origin_df.changi.snapped <span class="ot">=</span> <span class="fu">snapPointsToLines2</span>(origin_df.changi, osm_changi)</span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a>destination_df.changi.snapped <span class="ot">=</span> <span class="fu">snapPointsToLines2</span>(destination_df.changi, osm_changi)</span>
<span id="cb94-3"><a href="#cb94-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-4"><a href="#cb94-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(destination_df.changi.snapped)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="THE1_files/figure-html/unnamed-chunk-50-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-6-4" class="tab-pane" role="tabpanel" aria-labelledby="tabset-6-4-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(origin_df.changi.snapped)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="THE1_files/figure-html/unnamed-chunk-51-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</div>
<p>With our points on the network and study area constrained, we can visualise the events at Changi, especially the airport.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(osm_changi) <span class="sc">+</span> </span>
<span id="cb96-2"><a href="#cb96-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_lines</span>() <span class="sc">+</span></span>
<span id="cb96-3"><a href="#cb96-3" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(destination_df.changi.snapped) <span class="sc">+</span></span>
<span id="cb96-4"><a href="#cb96-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_dots</span>(<span class="at">col =</span> <span class="st">"red"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="THE1_files/figure-html/unnamed-chunk-52-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="nkde-calculation" class="level4">
<h4 class="anchored" data-anchor-id="nkde-calculation">NKDE Calculation</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a>lixels <span class="ot">&lt;-</span> <span class="fu">lixelize_lines</span>(osm_changi, <span class="dv">200</span>, <span class="at">mindist =</span> <span class="dv">100</span>)</span>
<span id="cb97-2"><a href="#cb97-2" aria-hidden="true" tabindex="-1"></a>samples <span class="ot">&lt;-</span> <span class="fu">lines_center</span>(lixels)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a>densities.destination <span class="ot">&lt;-</span> <span class="fu">nkde</span>(osm_changi,</span>
<span id="cb98-2"><a href="#cb98-2" aria-hidden="true" tabindex="-1"></a>                  <span class="at">events=</span>destination_df.changi.snapped,</span>
<span id="cb98-3"><a href="#cb98-3" aria-hidden="true" tabindex="-1"></a>                  <span class="at">w=</span><span class="fu">rep</span>(<span class="dv">1</span>, <span class="fu">nrow</span>(destination_df.changi.snapped)),</span>
<span id="cb98-4"><a href="#cb98-4" aria-hidden="true" tabindex="-1"></a>                  <span class="at">samples=</span>samples,</span>
<span id="cb98-5"><a href="#cb98-5" aria-hidden="true" tabindex="-1"></a>                  <span class="at">kernel_name=</span><span class="st">"quartic"</span>,</span>
<span id="cb98-6"><a href="#cb98-6" aria-hidden="true" tabindex="-1"></a>                  <span class="at">bw=</span><span class="dv">500</span>,</span>
<span id="cb98-7"><a href="#cb98-7" aria-hidden="true" tabindex="-1"></a>                  <span class="at">div=</span><span class="st">"bw"</span>,</span>
<span id="cb98-8"><a href="#cb98-8" aria-hidden="true" tabindex="-1"></a>                  <span class="at">method=</span><span class="st">"simple"</span>,</span>
<span id="cb98-9"><a href="#cb98-9" aria-hidden="true" tabindex="-1"></a>                  <span class="at">digits=</span><span class="dv">1</span>,</span>
<span id="cb98-10"><a href="#cb98-10" aria-hidden="true" tabindex="-1"></a>                  <span class="at">tol=</span><span class="dv">1</span>,</span>
<span id="cb98-11"><a href="#cb98-11" aria-hidden="true" tabindex="-1"></a>                  <span class="at">grid_shape=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>),</span>
<span id="cb98-12"><a href="#cb98-12" aria-hidden="true" tabindex="-1"></a>                  <span class="at">max_depth =</span> <span class="dv">8</span>,</span>
<span id="cb98-13"><a href="#cb98-13" aria-hidden="true" tabindex="-1"></a>                  <span class="at">agg=</span><span class="dv">5</span>,</span>
<span id="cb98-14"><a href="#cb98-14" aria-hidden="true" tabindex="-1"></a>                  <span class="at">sparse=</span><span class="cn">TRUE</span>,</span>
<span id="cb98-15"><a href="#cb98-15" aria-hidden="true" tabindex="-1"></a>                  <span class="at">verbose =</span> <span class="cn">FALSE</span>,</span>
<span id="cb98-16"><a href="#cb98-16" aria-hidden="true" tabindex="-1"></a>                  <span class="at">study_area =</span> mpsz_changi)</span>
<span id="cb98-17"><a href="#cb98-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-18"><a href="#cb98-18" aria-hidden="true" tabindex="-1"></a>densities.origin <span class="ot">&lt;-</span> <span class="fu">nkde</span>(osm_changi,</span>
<span id="cb98-19"><a href="#cb98-19" aria-hidden="true" tabindex="-1"></a>                  <span class="at">events=</span>origin_df.changi.snapped,</span>
<span id="cb98-20"><a href="#cb98-20" aria-hidden="true" tabindex="-1"></a>                  <span class="at">w=</span><span class="fu">rep</span>(<span class="dv">1</span>, <span class="fu">nrow</span>(origin_df.changi.snapped)),</span>
<span id="cb98-21"><a href="#cb98-21" aria-hidden="true" tabindex="-1"></a>                  <span class="at">samples=</span>samples,</span>
<span id="cb98-22"><a href="#cb98-22" aria-hidden="true" tabindex="-1"></a>                  <span class="at">kernel_name=</span><span class="st">"quartic"</span>,</span>
<span id="cb98-23"><a href="#cb98-23" aria-hidden="true" tabindex="-1"></a>                  <span class="at">bw=</span><span class="dv">500</span>,</span>
<span id="cb98-24"><a href="#cb98-24" aria-hidden="true" tabindex="-1"></a>                  <span class="at">div=</span><span class="st">"bw"</span>,</span>
<span id="cb98-25"><a href="#cb98-25" aria-hidden="true" tabindex="-1"></a>                  <span class="at">method=</span><span class="st">"simple"</span>,</span>
<span id="cb98-26"><a href="#cb98-26" aria-hidden="true" tabindex="-1"></a>                  <span class="at">digits=</span><span class="dv">1</span>,</span>
<span id="cb98-27"><a href="#cb98-27" aria-hidden="true" tabindex="-1"></a>                  <span class="at">tol=</span><span class="dv">1</span>,</span>
<span id="cb98-28"><a href="#cb98-28" aria-hidden="true" tabindex="-1"></a>                  <span class="at">grid_shape=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>),</span>
<span id="cb98-29"><a href="#cb98-29" aria-hidden="true" tabindex="-1"></a>                  <span class="at">max_depth =</span> <span class="dv">8</span>,</span>
<span id="cb98-30"><a href="#cb98-30" aria-hidden="true" tabindex="-1"></a>                  <span class="at">agg=</span><span class="dv">5</span>,</span>
<span id="cb98-31"><a href="#cb98-31" aria-hidden="true" tabindex="-1"></a>                  <span class="at">sparse=</span><span class="cn">TRUE</span>,</span>
<span id="cb98-32"><a href="#cb98-32" aria-hidden="true" tabindex="-1"></a>                  <span class="at">verbose =</span> <span class="cn">FALSE</span>,</span>
<span id="cb98-33"><a href="#cb98-33" aria-hidden="true" tabindex="-1"></a>                  <span class="at">study_area =</span> mpsz_changi)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a>samples<span class="sc">$</span>density.destination <span class="ot">&lt;-</span> densities.destination<span class="sc">*</span><span class="dv">1000</span></span>
<span id="cb99-2"><a href="#cb99-2" aria-hidden="true" tabindex="-1"></a>lixels<span class="sc">$</span>density.destination <span class="ot">&lt;-</span> densities.destination<span class="sc">*</span><span class="dv">1000</span></span>
<span id="cb99-3"><a href="#cb99-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-4"><a href="#cb99-4" aria-hidden="true" tabindex="-1"></a>samples<span class="sc">$</span>density.origin <span class="ot">&lt;-</span> densities.origin<span class="sc">*</span><span class="dv">1000</span></span>
<span id="cb99-5"><a href="#cb99-5" aria-hidden="true" tabindex="-1"></a>lixels<span class="sc">$</span>density.origin <span class="ot">&lt;-</span> densities.origin<span class="sc">*</span><span class="dv">1000</span></span>
<span id="cb99-6"><a href="#cb99-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-7"><a href="#cb99-7" aria-hidden="true" tabindex="-1"></a>samples2.origin <span class="ot">&lt;-</span> samples[<span class="fu">order</span>(samples<span class="sc">$</span>density.origin),]</span>
<span id="cb99-8"><a href="#cb99-8" aria-hidden="true" tabindex="-1"></a>samples2.destination <span class="ot">&lt;-</span> samples[<span class="fu">order</span>(samples<span class="sc">$</span>density.destination),]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>I tried a simple method taught in class to visualise the density of events on the road network at Changi. Unfortunately, the huge proportion of events at what is presumedly a dropoff point makes the rest of the area very light in comparison.</p>
<p>However, it can be noted that a good portion of trips are ended along the road leading up to Changi. This is not visible in the origin.</p>
<p>This shows that travellers sometimes preferred to disembark and walk the remaining distance. This likely happens if there is a sufficiently dense traffic jam at the actual dropoff point to cause traffic to completely stop for long enough for passengers to disembark.</p>
<p>On the other hand, origins are typically constrained to the lawful pickup/dropoff area.</p>
<p>I suspect that trips ended along the road before the pickup/dropoff area can be an indicator of bad traffic jams, because the riders would otherwise have no reason to disembark early.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-7-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-7-1" role="tab" aria-controls="tabset-7-1" aria-selected="true">Origins</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-7-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-7-2" role="tab" aria-controls="tabset-7-2" aria-selected="false">Destinations</a></li></ul>
<div class="tab-content">
<div id="tabset-7-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-7-1-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(lixels) <span class="sc">+</span> </span>
<span id="cb100-2"><a href="#cb100-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_lines</span>(<span class="at">col=</span><span class="st">"density.origin"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="THE1_files/figure-html/unnamed-chunk-56-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-7-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-7-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(lixels) <span class="sc">+</span> </span>
<span id="cb101-2"><a href="#cb101-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_lines</span>(<span class="at">col=</span><span class="st">"density.destination"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="THE1_files/figure-html/unnamed-chunk-57-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</div>
<p>In this alternative visualisation of NKDE at Changi, where the density steps are increasingly large, we can begin to see the other hotspots in the vicinity. When looking the magnitude of the lighter colors in the legend, we can see that these areas are nowhere near as dense as the pickup/dropoff area.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-8-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-8-1" role="tab" aria-controls="tabset-8-1" aria-selected="true">NKDE Origins Changi</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-8-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-8-2" role="tab" aria-controls="tabset-8-2" aria-selected="false">NKDE Destinations Changi</a></li></ul>
<div class="tab-content">
<div id="tabset-8-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-8-1-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a>colorRamp <span class="ot">&lt;-</span> <span class="fu">brewer.pal</span>(<span class="at">n =</span> <span class="dv">7</span>, <span class="at">name =</span> <span class="st">"Spectral"</span>)</span>
<span id="cb102-2"><a href="#cb102-2" aria-hidden="true" tabindex="-1"></a>colorRamp <span class="ot">&lt;-</span> <span class="fu">rev</span>(colorRamp)</span>
<span id="cb102-3"><a href="#cb102-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-4"><a href="#cb102-4" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(osm_changi) <span class="sc">+</span> </span>
<span id="cb102-5"><a href="#cb102-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_lines</span>(<span class="st">"black"</span>) <span class="sc">+</span> </span>
<span id="cb102-6"><a href="#cb102-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_shape</span>(samples2.origin) <span class="sc">+</span> </span>
<span id="cb102-7"><a href="#cb102-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_dots</span>(<span class="st">"density.origin"</span>, <span class="at">style =</span> <span class="st">"kmeans"</span>, <span class="at">palette =</span> colorRamp, <span class="at">n =</span> <span class="dv">7</span>, <span class="at">size =</span> <span class="fl">0.1</span>) <span class="sc">+</span> </span>
<span id="cb102-8"><a href="#cb102-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_layout</span>(<span class="at">legend.outside =</span> <span class="cn">TRUE</span>, </span>
<span id="cb102-9"><a href="#cb102-9" aria-hidden="true" tabindex="-1"></a>            <span class="at">main.title =</span> <span class="st">'NKDE of Grab Trip Origins in Changi'</span> , <span class="at">main.title.size =</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="THE1_files/figure-html/unnamed-chunk-58-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-8-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-8-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(osm_changi) <span class="sc">+</span> </span>
<span id="cb103-2"><a href="#cb103-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_lines</span>(<span class="st">"black"</span>) <span class="sc">+</span> </span>
<span id="cb103-3"><a href="#cb103-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_shape</span>(samples2.destination) <span class="sc">+</span> </span>
<span id="cb103-4"><a href="#cb103-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_dots</span>(<span class="st">"density.destination"</span>, <span class="at">style =</span> <span class="st">"kmeans"</span>, <span class="at">palette =</span> colorRamp, <span class="at">n =</span> <span class="dv">7</span>, <span class="at">size =</span> <span class="fl">0.1</span>) <span class="sc">+</span> </span>
<span id="cb103-5"><a href="#cb103-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_layout</span>(<span class="at">legend.outside =</span> <span class="cn">TRUE</span>, </span>
<span id="cb103-6"><a href="#cb103-6" aria-hidden="true" tabindex="-1"></a>            <span class="at">main.title =</span> <span class="st">'NKDE of Grab Trip Destinations in Changi'</span> , <span class="at">main.title.size =</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="THE1_files/figure-html/unnamed-chunk-59-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</div>
</section>
</section>
<section id="woodlands-and-woodlands-checkpoint" class="level3">
<h3 class="anchored" data-anchor-id="woodlands-and-woodlands-checkpoint">5.2 Woodlands and Woodlands Checkpoint</h3>
<p>Based on the KDE calculation, we noticed that the area near the Woodlands checkpoint the general Woodlands area was a hotspot for both trip starts and ends.</p>
<p>From my anecdotal experience, I suspected that Grab rides from the checkpoint may not start very near to it.</p>
<p>I found it difficult to get Grab rides directly outside the checkpoint during peak hours. Usually, commuters will take public buses to nearby areas before booking their rides home.</p>
<p>However, I would like the number and maps to paint a clearer picture of where commuters start and end their grab rides.</p>
<section id="nkde-data-preparation-1" class="level4">
<h4 class="anchored" data-anchor-id="nkde-data-preparation-1">NKDE Data Preparation</h4>
<p>In the map below, the checkpoint is clearly denoted by the cluster of parallel roads in the top left.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a>mpsz_woodlands <span class="ot">=</span> mpsz <span class="sc">%&gt;%</span> <span class="fu">filter</span>(PLN_AREA_N<span class="sc">==</span><span class="st">"WOODLANDS"</span>)</span>
<span id="cb104-2"><a href="#cb104-2" aria-hidden="true" tabindex="-1"></a>mpsz_woodlands <span class="ot">&lt;-</span> <span class="fu">st_intersection</span>(mpsz_woodlands, merged_sg)</span>
<span id="cb104-3"><a href="#cb104-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-4"><a href="#cb104-4" aria-hidden="true" tabindex="-1"></a>osm_woodlands_i <span class="ot">&lt;-</span> <span class="fu">st_intersection</span>(osm_sg, mpsz_woodlands)</span>
<span id="cb104-5"><a href="#cb104-5" aria-hidden="true" tabindex="-1"></a>osm_woodlands_idxs <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(osm_woodlands_i<span class="sc">$</span>osm_id)</span>
<span id="cb104-6"><a href="#cb104-6" aria-hidden="true" tabindex="-1"></a>osm_woodlands <span class="ot">&lt;-</span> osm_sg[osm_sg<span class="sc">$</span>osm_id <span class="sc">%in%</span> osm_woodlands_idxs, ]</span>
<span id="cb104-7"><a href="#cb104-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-8"><a href="#cb104-8" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(osm_woodlands)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="THE1_files/figure-html/unnamed-chunk-60-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>As in the previous example at Changi, we snap the points to the network and constrain the study area.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a>destination_df.woodlands <span class="ot">=</span> <span class="fu">st_intersection</span>(destination_df, mpsz_woodlands)</span>
<span id="cb105-2"><a href="#cb105-2" aria-hidden="true" tabindex="-1"></a>origin_df.woodlands <span class="ot">=</span> <span class="fu">st_intersection</span>(origin_df, mpsz_woodlands)</span>
<span id="cb105-3"><a href="#cb105-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-4"><a href="#cb105-4" aria-hidden="true" tabindex="-1"></a>origin_df.woodlands.snapped <span class="ot">=</span> <span class="fu">snapPointsToLines2</span>(origin_df.woodlands, osm_woodlands)</span>
<span id="cb105-5"><a href="#cb105-5" aria-hidden="true" tabindex="-1"></a>destination_df.woodlands.snapped <span class="ot">=</span> <span class="fu">snapPointsToLines2</span>(destination_df.woodlands, osm_woodlands)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>As expected, few rides occur in the direct vicinity of the checkpoint.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb106"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(osm_woodlands) <span class="sc">+</span> </span>
<span id="cb106-2"><a href="#cb106-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_lines</span>() <span class="sc">+</span></span>
<span id="cb106-3"><a href="#cb106-3" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(destination_df.woodlands.snapped) <span class="sc">+</span></span>
<span id="cb106-4"><a href="#cb106-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_dots</span>(<span class="at">col =</span> <span class="st">"red"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="THE1_files/figure-html/unnamed-chunk-62-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="nkde-calculation-1" class="level4">
<h4 class="anchored" data-anchor-id="nkde-calculation-1">NKDE Calculation</h4>
<p>Since I want a sharper curve to more clearly identify hotspots on the network, I use a quartic kernel. When trying an adaptive bandwidth, only one hotspot was clearly identified. As such, I have set a static bandwidth.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb107"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a>lixels <span class="ot">&lt;-</span> <span class="fu">lixelize_lines</span>(osm_woodlands, <span class="dv">200</span>, <span class="at">mindist =</span> <span class="dv">100</span>)</span>
<span id="cb107-2"><a href="#cb107-2" aria-hidden="true" tabindex="-1"></a>samples <span class="ot">&lt;-</span> <span class="fu">lines_center</span>(lixels)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb108"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a>densities.destination <span class="ot">&lt;-</span> <span class="fu">nkde</span>(osm_woodlands,</span>
<span id="cb108-2"><a href="#cb108-2" aria-hidden="true" tabindex="-1"></a>                  <span class="at">events=</span>destination_df.woodlands.snapped,</span>
<span id="cb108-3"><a href="#cb108-3" aria-hidden="true" tabindex="-1"></a>                  <span class="at">w=</span><span class="fu">rep</span>(<span class="dv">1</span>, <span class="fu">nrow</span>(destination_df.woodlands.snapped)),</span>
<span id="cb108-4"><a href="#cb108-4" aria-hidden="true" tabindex="-1"></a>                  <span class="at">samples=</span>samples,</span>
<span id="cb108-5"><a href="#cb108-5" aria-hidden="true" tabindex="-1"></a>                  <span class="at">kernel_name=</span><span class="st">"quartic"</span>,</span>
<span id="cb108-6"><a href="#cb108-6" aria-hidden="true" tabindex="-1"></a>                  <span class="at">bw=</span><span class="dv">500</span>,</span>
<span id="cb108-7"><a href="#cb108-7" aria-hidden="true" tabindex="-1"></a>                  <span class="at">div=</span><span class="st">"bw"</span>,</span>
<span id="cb108-8"><a href="#cb108-8" aria-hidden="true" tabindex="-1"></a>                  <span class="at">method=</span><span class="st">"simple"</span>,</span>
<span id="cb108-9"><a href="#cb108-9" aria-hidden="true" tabindex="-1"></a>                  <span class="at">digits=</span><span class="dv">1</span>,</span>
<span id="cb108-10"><a href="#cb108-10" aria-hidden="true" tabindex="-1"></a>                  <span class="at">tol=</span><span class="dv">1</span>,</span>
<span id="cb108-11"><a href="#cb108-11" aria-hidden="true" tabindex="-1"></a>                  <span class="at">grid_shape=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>),</span>
<span id="cb108-12"><a href="#cb108-12" aria-hidden="true" tabindex="-1"></a>                  <span class="at">max_depth =</span> <span class="dv">8</span>,</span>
<span id="cb108-13"><a href="#cb108-13" aria-hidden="true" tabindex="-1"></a>                  <span class="at">agg=</span><span class="dv">5</span>,</span>
<span id="cb108-14"><a href="#cb108-14" aria-hidden="true" tabindex="-1"></a>                  <span class="at">sparse=</span><span class="cn">TRUE</span>,</span>
<span id="cb108-15"><a href="#cb108-15" aria-hidden="true" tabindex="-1"></a>                  <span class="at">verbose =</span> <span class="cn">FALSE</span>,</span>
<span id="cb108-16"><a href="#cb108-16" aria-hidden="true" tabindex="-1"></a>                  <span class="at">study_area =</span> mpsz_woodlands)</span>
<span id="cb108-17"><a href="#cb108-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-18"><a href="#cb108-18" aria-hidden="true" tabindex="-1"></a>densities.origin <span class="ot">&lt;-</span> <span class="fu">nkde</span>(osm_woodlands,</span>
<span id="cb108-19"><a href="#cb108-19" aria-hidden="true" tabindex="-1"></a>                  <span class="at">events=</span>origin_df.woodlands.snapped,</span>
<span id="cb108-20"><a href="#cb108-20" aria-hidden="true" tabindex="-1"></a>                  <span class="at">w=</span><span class="fu">rep</span>(<span class="dv">1</span>, <span class="fu">nrow</span>(origin_df.woodlands.snapped)),</span>
<span id="cb108-21"><a href="#cb108-21" aria-hidden="true" tabindex="-1"></a>                  <span class="at">samples=</span>samples,</span>
<span id="cb108-22"><a href="#cb108-22" aria-hidden="true" tabindex="-1"></a>                  <span class="at">kernel_name=</span><span class="st">"quartic"</span>,</span>
<span id="cb108-23"><a href="#cb108-23" aria-hidden="true" tabindex="-1"></a>                  <span class="at">bw=</span><span class="dv">500</span>,</span>
<span id="cb108-24"><a href="#cb108-24" aria-hidden="true" tabindex="-1"></a>                  <span class="at">div=</span><span class="st">"bw"</span>,</span>
<span id="cb108-25"><a href="#cb108-25" aria-hidden="true" tabindex="-1"></a>                  <span class="at">method=</span><span class="st">"simple"</span>,</span>
<span id="cb108-26"><a href="#cb108-26" aria-hidden="true" tabindex="-1"></a>                  <span class="at">digits=</span><span class="dv">1</span>,</span>
<span id="cb108-27"><a href="#cb108-27" aria-hidden="true" tabindex="-1"></a>                  <span class="at">tol=</span><span class="dv">1</span>,</span>
<span id="cb108-28"><a href="#cb108-28" aria-hidden="true" tabindex="-1"></a>                  <span class="at">grid_shape=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>),</span>
<span id="cb108-29"><a href="#cb108-29" aria-hidden="true" tabindex="-1"></a>                  <span class="at">max_depth =</span> <span class="dv">8</span>,</span>
<span id="cb108-30"><a href="#cb108-30" aria-hidden="true" tabindex="-1"></a>                  <span class="at">agg=</span><span class="dv">5</span>,</span>
<span id="cb108-31"><a href="#cb108-31" aria-hidden="true" tabindex="-1"></a>                  <span class="at">sparse=</span><span class="cn">TRUE</span>,</span>
<span id="cb108-32"><a href="#cb108-32" aria-hidden="true" tabindex="-1"></a>                  <span class="at">verbose =</span> <span class="cn">FALSE</span>,</span>
<span id="cb108-33"><a href="#cb108-33" aria-hidden="true" tabindex="-1"></a>                  <span class="at">study_area =</span> mpsz_woodlands)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb109"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a>samples<span class="sc">$</span>density.destination <span class="ot">&lt;-</span> densities.destination<span class="sc">*</span><span class="dv">1000</span></span>
<span id="cb109-2"><a href="#cb109-2" aria-hidden="true" tabindex="-1"></a>lixels<span class="sc">$</span>density.destination <span class="ot">&lt;-</span> densities.destination<span class="sc">*</span><span class="dv">1000</span></span>
<span id="cb109-3"><a href="#cb109-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-4"><a href="#cb109-4" aria-hidden="true" tabindex="-1"></a>samples<span class="sc">$</span>density.origin <span class="ot">&lt;-</span> densities.origin<span class="sc">*</span><span class="dv">1000</span></span>
<span id="cb109-5"><a href="#cb109-5" aria-hidden="true" tabindex="-1"></a>lixels<span class="sc">$</span>density.origin <span class="ot">&lt;-</span> densities.origin<span class="sc">*</span><span class="dv">1000</span></span>
<span id="cb109-6"><a href="#cb109-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-7"><a href="#cb109-7" aria-hidden="true" tabindex="-1"></a>samples2.origin <span class="ot">&lt;-</span> samples[<span class="fu">order</span>(samples<span class="sc">$</span>density.origin),]</span>
<span id="cb109-8"><a href="#cb109-8" aria-hidden="true" tabindex="-1"></a>samples2.destination <span class="ot">&lt;-</span> samples[<span class="fu">order</span>(samples<span class="sc">$</span>density.destination),]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>From this NKDE map, we can already tell that more people use Grab to leave Woodlands than to come in. This applies to the residential areas as well, sufficiently far from the checkpoint.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-9-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-9-1" role="tab" aria-controls="tabset-9-1" aria-selected="true">NKDE Origins Woodlands</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-9-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-9-2" role="tab" aria-controls="tabset-9-2" aria-selected="false">NKDE Destinations Woodlands</a></li></ul>
<div class="tab-content">
<div id="tabset-9-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-9-1-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb110"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(lixels) <span class="sc">+</span> </span>
<span id="cb110-2"><a href="#cb110-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_lines</span>(<span class="at">col=</span><span class="st">"density.origin"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="THE1_files/figure-html/unnamed-chunk-66-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-9-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-9-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb111"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(lixels) <span class="sc">+</span> </span>
<span id="cb111-2"><a href="#cb111-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_lines</span>(<span class="at">col=</span><span class="st">"density.destination"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="THE1_files/figure-html/unnamed-chunk-67-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</div>
<p>In this alternative map, I can tell that my suspicion was wrong. While origins are more distributed than destinations in woodlands, a clear hotspot for origins can be identified right outside the checkpoint. This could mean that grab drivers and passengers are willing to brave the traffic jam for a grab ride.</p>
<p>I was also surprised that there were no clear signs that passengers alighted prematurely from their rides to the checkpoint, as was the case at Changi airport.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-10-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-10-1" role="tab" aria-controls="tabset-10-1" aria-selected="true">NKDE Origins Woodlands</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-10-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-10-2" role="tab" aria-controls="tabset-10-2" aria-selected="false">NKDE Destinations Woodlands</a></li></ul>
<div class="tab-content">
<div id="tabset-10-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-10-1-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb112"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a>colorRamp <span class="ot">&lt;-</span> <span class="fu">brewer.pal</span>(<span class="at">n =</span> <span class="dv">7</span>, <span class="at">name =</span> <span class="st">"Spectral"</span>)</span>
<span id="cb112-2"><a href="#cb112-2" aria-hidden="true" tabindex="-1"></a>colorRamp <span class="ot">&lt;-</span> <span class="fu">rev</span>(colorRamp)</span>
<span id="cb112-3"><a href="#cb112-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb112-4"><a href="#cb112-4" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(osm_woodlands) <span class="sc">+</span> </span>
<span id="cb112-5"><a href="#cb112-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_lines</span>(<span class="st">"black"</span>) <span class="sc">+</span> </span>
<span id="cb112-6"><a href="#cb112-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_shape</span>(samples2.origin) <span class="sc">+</span> </span>
<span id="cb112-7"><a href="#cb112-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_dots</span>(<span class="st">"density.origin"</span>, <span class="at">style =</span> <span class="st">"kmeans"</span>, <span class="at">palette =</span> colorRamp, <span class="at">n =</span> <span class="dv">7</span>, <span class="at">size =</span> <span class="fl">0.1</span>) <span class="sc">+</span> </span>
<span id="cb112-8"><a href="#cb112-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_layout</span>(<span class="at">legend.outside =</span> <span class="cn">TRUE</span>, </span>
<span id="cb112-9"><a href="#cb112-9" aria-hidden="true" tabindex="-1"></a>            <span class="at">main.title =</span> <span class="st">'NKDE of Grab Trip Origins in Woodlands'</span> , <span class="at">main.title.size =</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="THE1_files/figure-html/unnamed-chunk-68-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-10-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-10-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb113"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(osm_woodlands) <span class="sc">+</span> </span>
<span id="cb113-2"><a href="#cb113-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_lines</span>(<span class="st">"black"</span>) <span class="sc">+</span> </span>
<span id="cb113-3"><a href="#cb113-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_shape</span>(samples2.destination) <span class="sc">+</span> </span>
<span id="cb113-4"><a href="#cb113-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_dots</span>(<span class="st">"density.destination"</span>, <span class="at">style =</span> <span class="st">"kmeans"</span>, <span class="at">palette =</span> colorRamp, <span class="at">n =</span> <span class="dv">7</span>, <span class="at">size =</span> <span class="fl">0.1</span>) <span class="sc">+</span> </span>
<span id="cb113-5"><a href="#cb113-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_layout</span>(<span class="at">legend.outside =</span> <span class="cn">TRUE</span>, </span>
<span id="cb113-6"><a href="#cb113-6" aria-hidden="true" tabindex="-1"></a>            <span class="at">main.title =</span> <span class="st">'NKDE of Grab Trip Destinations in Woodlands'</span> , <span class="at">main.title.size =</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="THE1_files/figure-html/unnamed-chunk-69-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</div>
</section>
</section>
<section id="downtown" class="level3">
<h3 class="anchored" data-anchor-id="downtown">5.3 Downtown</h3>
<p>The downtown area is intuitively a slow, congested area during rush hours. In the KDE maps, the downtown area was consistently bright, indicating that many Grab rides started and ended there. In this segment I wanted to see if there were particular areas within the downtown core area that many commuters head to.</p>
<section id="nkde-data-preparation-2" class="level4">
<h4 class="anchored" data-anchor-id="nkde-data-preparation-2">NKDE Data Preparation</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb114"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a>mpsz_town <span class="ot">=</span> mpsz <span class="sc">%&gt;%</span> <span class="fu">filter</span>(PLN_AREA_N<span class="sc">==</span><span class="st">"DOWNTOWN CORE"</span>)</span>
<span id="cb114-2"><a href="#cb114-2" aria-hidden="true" tabindex="-1"></a>mpsz_town <span class="ot">&lt;-</span> <span class="fu">st_intersection</span>(mpsz_town, merged_sg)</span>
<span id="cb114-3"><a href="#cb114-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-4"><a href="#cb114-4" aria-hidden="true" tabindex="-1"></a>osm_town_i <span class="ot">&lt;-</span> <span class="fu">st_intersection</span>(osm_sg, mpsz_town)</span>
<span id="cb114-5"><a href="#cb114-5" aria-hidden="true" tabindex="-1"></a>osm_town_idxs <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(osm_town_i<span class="sc">$</span>osm_id)</span>
<span id="cb114-6"><a href="#cb114-6" aria-hidden="true" tabindex="-1"></a>osm_town <span class="ot">&lt;-</span> osm_sg[osm_sg<span class="sc">$</span>osm_id <span class="sc">%in%</span> osm_town_idxs, ]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb115"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a>destination_df.town <span class="ot">=</span> <span class="fu">st_intersection</span>(destination_df, mpsz_town)</span>
<span id="cb115-2"><a href="#cb115-2" aria-hidden="true" tabindex="-1"></a>origin_df.town <span class="ot">=</span> <span class="fu">st_intersection</span>(origin_df, mpsz_town)</span>
<span id="cb115-3"><a href="#cb115-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-4"><a href="#cb115-4" aria-hidden="true" tabindex="-1"></a>origin_df.town.snapped <span class="ot">=</span> <span class="fu">snapPointsToLines2</span>(origin_df.town, osm_town)</span>
<span id="cb115-5"><a href="#cb115-5" aria-hidden="true" tabindex="-1"></a>destination_df.town.snapped <span class="ot">=</span> <span class="fu">snapPointsToLines2</span>(destination_df.town, osm_town)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb116"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb116-1"><a href="#cb116-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(osm_town) <span class="sc">+</span> </span>
<span id="cb116-2"><a href="#cb116-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_lines</span>() <span class="sc">+</span></span>
<span id="cb116-3"><a href="#cb116-3" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(destination_df.town.snapped) <span class="sc">+</span></span>
<span id="cb116-4"><a href="#cb116-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_dots</span>(<span class="at">col =</span> <span class="st">"red"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="THE1_files/figure-html/unnamed-chunk-72-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="nkde-calculation-2" class="level4">
<h4 class="anchored" data-anchor-id="nkde-calculation-2">NKDE Calculation</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb117"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a>lixels <span class="ot">&lt;-</span> <span class="fu">lixelize_lines</span>(osm_town, <span class="dv">200</span>, <span class="at">mindist =</span> <span class="dv">100</span>)</span>
<span id="cb117-2"><a href="#cb117-2" aria-hidden="true" tabindex="-1"></a>samples <span class="ot">&lt;-</span> <span class="fu">lines_center</span>(lixels)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb118"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb118-1"><a href="#cb118-1" aria-hidden="true" tabindex="-1"></a>densities.destination <span class="ot">&lt;-</span> <span class="fu">nkde</span>(osm_town,</span>
<span id="cb118-2"><a href="#cb118-2" aria-hidden="true" tabindex="-1"></a>                  <span class="at">events=</span>destination_df.town.snapped,</span>
<span id="cb118-3"><a href="#cb118-3" aria-hidden="true" tabindex="-1"></a>                  <span class="at">w=</span><span class="fu">rep</span>(<span class="dv">1</span>, <span class="fu">nrow</span>(destination_df.town.snapped)),</span>
<span id="cb118-4"><a href="#cb118-4" aria-hidden="true" tabindex="-1"></a>                  <span class="at">samples=</span>samples,</span>
<span id="cb118-5"><a href="#cb118-5" aria-hidden="true" tabindex="-1"></a>                  <span class="at">kernel_name=</span><span class="st">"quartic"</span>,</span>
<span id="cb118-6"><a href="#cb118-6" aria-hidden="true" tabindex="-1"></a>                  <span class="at">bw=</span><span class="dv">500</span>,</span>
<span id="cb118-7"><a href="#cb118-7" aria-hidden="true" tabindex="-1"></a>                  <span class="at">div=</span><span class="st">"bw"</span>,</span>
<span id="cb118-8"><a href="#cb118-8" aria-hidden="true" tabindex="-1"></a>                  <span class="at">method=</span><span class="st">"simple"</span>,</span>
<span id="cb118-9"><a href="#cb118-9" aria-hidden="true" tabindex="-1"></a>                  <span class="at">digits=</span><span class="dv">1</span>,</span>
<span id="cb118-10"><a href="#cb118-10" aria-hidden="true" tabindex="-1"></a>                  <span class="at">tol=</span><span class="dv">1</span>,</span>
<span id="cb118-11"><a href="#cb118-11" aria-hidden="true" tabindex="-1"></a>                  <span class="at">grid_shape=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>),</span>
<span id="cb118-12"><a href="#cb118-12" aria-hidden="true" tabindex="-1"></a>                  <span class="at">max_depth =</span> <span class="dv">8</span>,</span>
<span id="cb118-13"><a href="#cb118-13" aria-hidden="true" tabindex="-1"></a>                  <span class="at">agg=</span><span class="dv">5</span>,</span>
<span id="cb118-14"><a href="#cb118-14" aria-hidden="true" tabindex="-1"></a>                  <span class="at">sparse=</span><span class="cn">TRUE</span>,</span>
<span id="cb118-15"><a href="#cb118-15" aria-hidden="true" tabindex="-1"></a>                  <span class="at">verbose =</span> <span class="cn">FALSE</span>,</span>
<span id="cb118-16"><a href="#cb118-16" aria-hidden="true" tabindex="-1"></a>                  <span class="at">study_area =</span> mpsz_town)</span>
<span id="cb118-17"><a href="#cb118-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-18"><a href="#cb118-18" aria-hidden="true" tabindex="-1"></a>densities.origin <span class="ot">&lt;-</span> <span class="fu">nkde</span>(osm_town,</span>
<span id="cb118-19"><a href="#cb118-19" aria-hidden="true" tabindex="-1"></a>                  <span class="at">events=</span>origin_df.town.snapped,</span>
<span id="cb118-20"><a href="#cb118-20" aria-hidden="true" tabindex="-1"></a>                  <span class="at">w=</span><span class="fu">rep</span>(<span class="dv">1</span>, <span class="fu">nrow</span>(origin_df.town.snapped)),</span>
<span id="cb118-21"><a href="#cb118-21" aria-hidden="true" tabindex="-1"></a>                  <span class="at">samples=</span>samples,</span>
<span id="cb118-22"><a href="#cb118-22" aria-hidden="true" tabindex="-1"></a>                  <span class="at">kernel_name=</span><span class="st">"quartic"</span>,</span>
<span id="cb118-23"><a href="#cb118-23" aria-hidden="true" tabindex="-1"></a>                  <span class="at">bw=</span><span class="dv">500</span>,</span>
<span id="cb118-24"><a href="#cb118-24" aria-hidden="true" tabindex="-1"></a>                  <span class="at">div=</span><span class="st">"bw"</span>,</span>
<span id="cb118-25"><a href="#cb118-25" aria-hidden="true" tabindex="-1"></a>                  <span class="at">method=</span><span class="st">"simple"</span>,</span>
<span id="cb118-26"><a href="#cb118-26" aria-hidden="true" tabindex="-1"></a>                  <span class="at">digits=</span><span class="dv">1</span>,</span>
<span id="cb118-27"><a href="#cb118-27" aria-hidden="true" tabindex="-1"></a>                  <span class="at">tol=</span><span class="dv">1</span>,</span>
<span id="cb118-28"><a href="#cb118-28" aria-hidden="true" tabindex="-1"></a>                  <span class="at">grid_shape=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>),</span>
<span id="cb118-29"><a href="#cb118-29" aria-hidden="true" tabindex="-1"></a>                  <span class="at">max_depth =</span> <span class="dv">8</span>,</span>
<span id="cb118-30"><a href="#cb118-30" aria-hidden="true" tabindex="-1"></a>                  <span class="at">agg=</span><span class="dv">5</span>,</span>
<span id="cb118-31"><a href="#cb118-31" aria-hidden="true" tabindex="-1"></a>                  <span class="at">sparse=</span><span class="cn">TRUE</span>,</span>
<span id="cb118-32"><a href="#cb118-32" aria-hidden="true" tabindex="-1"></a>                  <span class="at">verbose =</span> <span class="cn">FALSE</span>,</span>
<span id="cb118-33"><a href="#cb118-33" aria-hidden="true" tabindex="-1"></a>                  <span class="at">study_area =</span> mpsz_town)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb119"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb119-1"><a href="#cb119-1" aria-hidden="true" tabindex="-1"></a>samples<span class="sc">$</span>density.destination <span class="ot">&lt;-</span> densities.destination<span class="sc">*</span><span class="dv">1000</span></span>
<span id="cb119-2"><a href="#cb119-2" aria-hidden="true" tabindex="-1"></a>lixels<span class="sc">$</span>density.destination <span class="ot">&lt;-</span> densities.destination<span class="sc">*</span><span class="dv">1000</span></span>
<span id="cb119-3"><a href="#cb119-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-4"><a href="#cb119-4" aria-hidden="true" tabindex="-1"></a>samples<span class="sc">$</span>density.origin <span class="ot">&lt;-</span> densities.origin<span class="sc">*</span><span class="dv">1000</span></span>
<span id="cb119-5"><a href="#cb119-5" aria-hidden="true" tabindex="-1"></a>lixels<span class="sc">$</span>density.origin <span class="ot">&lt;-</span> densities.origin<span class="sc">*</span><span class="dv">1000</span></span>
<span id="cb119-6"><a href="#cb119-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-7"><a href="#cb119-7" aria-hidden="true" tabindex="-1"></a>samples2.origin <span class="ot">&lt;-</span> samples[<span class="fu">order</span>(samples<span class="sc">$</span>density.origin),]</span>
<span id="cb119-8"><a href="#cb119-8" aria-hidden="true" tabindex="-1"></a>samples2.destination <span class="ot">&lt;-</span> samples[<span class="fu">order</span>(samples<span class="sc">$</span>density.destination),]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-11-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-11-1" role="tab" aria-controls="tabset-11-1" aria-selected="true">NKDE Origins Town</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-11-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-11-2" role="tab" aria-controls="tabset-11-2" aria-selected="false">NKDE Destinations Town</a></li></ul>
<div class="tab-content">
<div id="tabset-11-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-11-1-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb120"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb120-1"><a href="#cb120-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(lixels) <span class="sc">+</span> </span>
<span id="cb120-2"><a href="#cb120-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_lines</span>(<span class="at">col=</span><span class="st">"density.origin"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="THE1_files/figure-html/unnamed-chunk-76-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-11-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-11-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb121"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(lixels) <span class="sc">+</span> </span>
<span id="cb121-2"><a href="#cb121-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_lines</span>(<span class="at">col=</span><span class="st">"density.destination"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="THE1_files/figure-html/unnamed-chunk-77-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</div>
<p>When observing the destinations map, it becomes clear that many intersections in the upper area, near Raffle’s city, become extremely packed with people on their way there. On the southern part of the map, roads near Marina Bay Financial centre also see a lot fo traffic from private hire vehicles.</p>
<p>However, most interesting about these maps is that the origins in this map are primarily clustered around an area with high end office building and attractions, but nothing out of the ordinary relative to the surrounding area.</p>
<p>It might be possible that the area above Lau Pa Sat is used as an area to get a Grab ride after a meal, where smaller roads make it easier for cars to stop to pick up passengers.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-12-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-12-1" role="tab" aria-controls="tabset-12-1" aria-selected="true">NKDE Origins Town</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-12-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-12-2" role="tab" aria-controls="tabset-12-2" aria-selected="false">NKDE Destinations Town</a></li></ul>
<div class="tab-content">
<div id="tabset-12-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-12-1-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb122"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb122-1"><a href="#cb122-1" aria-hidden="true" tabindex="-1"></a>colorRamp <span class="ot">&lt;-</span> <span class="fu">brewer.pal</span>(<span class="at">n =</span> <span class="dv">7</span>, <span class="at">name =</span> <span class="st">"Spectral"</span>)</span>
<span id="cb122-2"><a href="#cb122-2" aria-hidden="true" tabindex="-1"></a>colorRamp <span class="ot">&lt;-</span> <span class="fu">rev</span>(colorRamp)</span>
<span id="cb122-3"><a href="#cb122-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb122-4"><a href="#cb122-4" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>))</span>
<span id="cb122-5"><a href="#cb122-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb122-6"><a href="#cb122-6" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(osm_town) <span class="sc">+</span> </span>
<span id="cb122-7"><a href="#cb122-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_lines</span>(<span class="st">"black"</span>) <span class="sc">+</span> </span>
<span id="cb122-8"><a href="#cb122-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_shape</span>(samples2.origin) <span class="sc">+</span> </span>
<span id="cb122-9"><a href="#cb122-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_dots</span>(<span class="st">"density.origin"</span>, <span class="at">style =</span> <span class="st">"kmeans"</span>, <span class="at">palette =</span> colorRamp, <span class="at">n =</span> <span class="dv">7</span>, <span class="at">size =</span> <span class="fl">0.1</span>) <span class="sc">+</span> </span>
<span id="cb122-10"><a href="#cb122-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_layout</span>(<span class="at">legend.outside =</span> <span class="cn">TRUE</span>, </span>
<span id="cb122-11"><a href="#cb122-11" aria-hidden="true" tabindex="-1"></a>            <span class="at">main.title =</span> <span class="st">'NKDE of Grab Trip Origins in Downtown Core'</span> , <span class="at">main.title.size =</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="THE1_files/figure-html/unnamed-chunk-78-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-12-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-12-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb123"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb123-1"><a href="#cb123-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(osm_town) <span class="sc">+</span> </span>
<span id="cb123-2"><a href="#cb123-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_lines</span>(<span class="st">"black"</span>) <span class="sc">+</span> </span>
<span id="cb123-3"><a href="#cb123-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_shape</span>(samples2.destination) <span class="sc">+</span> </span>
<span id="cb123-4"><a href="#cb123-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_dots</span>(<span class="st">"density.destination"</span>, <span class="at">style =</span> <span class="st">"kmeans"</span>, <span class="at">palette =</span> colorRamp, <span class="at">n =</span> <span class="dv">7</span>, <span class="at">size =</span> <span class="fl">0.1</span>) <span class="sc">+</span> </span>
<span id="cb123-5"><a href="#cb123-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_layout</span>(<span class="at">legend.outside =</span> <span class="cn">TRUE</span>, </span>
<span id="cb123-6"><a href="#cb123-6" aria-hidden="true" tabindex="-1"></a>            <span class="at">main.title =</span> <span class="st">'NKDE of Grab Trip Destinations in Downtown Core'</span> , <span class="at">main.title.size =</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="THE1_files/figure-html/unnamed-chunk-79-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</div>
</section>
</section>
<section id="nkde-general-insights" class="level3">
<h3 class="anchored" data-anchor-id="nkde-general-insights">5.4 NKDE General Insights</h3>
<p>The NKDE is very useful to visualise the impact of events on a network. In the case of traffic, more events likely correlates with more traffic, giving us insights on potentially impacted roads during peak hours. However, NKDE maps are limited by their ambiguous time frame. I would like to visualise smaller subsets of events corresponding to daily patterns, including meal times, commuting times, and perhaps post-nightlife rides back home.</p>
<p>That’s what I hope to learn from the TNKDE!</p>
</section>
</section>
<section id="tnkde" class="level2">
<h2 class="anchored" data-anchor-id="tnkde">6.0 TNKDE</h2>
<p>To extend the NKDE, we can use the TNKDE to visualise patterns in the network over time. In this section, I will be creating visualisation split over the 24 hours of the day to visualise daily patterns. This should show more variations than a split by the days of the week, where patterns may only correspond to the weekday/weekend differences.</p>
<p>I have kept the bandwidth the same for consistency.</p>
<section id="changi-airport-1" class="level3">
<h3 class="anchored" data-anchor-id="changi-airport-1">6.1 Changi Airport</h3>
<p>From the NKDE in Changi, we were able to see that the airport road had enough legally questionable dropoffs along the road to the airport during periods of congestion. It is possible that not every jam in Changi airport will cause this phenomenon.</p>
<p>From the TNKDE, we can see that drivers need to be careful around the clock, but less so in the evenings, since there will be travelers alighting where they may not be allowed to.</p>
<p>However, this could also be an illusion caused by grab drivers pressing the button to end their trip slightly earlier to prepare to help travelers get their bags out the car.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb124"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb124-1"><a href="#cb124-1" aria-hidden="true" tabindex="-1"></a>destination_df.changi.snapped<span class="sc">$</span>end_hr <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(destination_df.changi.snapped<span class="sc">$</span>end_hr)</span>
<span id="cb124-2"><a href="#cb124-2" aria-hidden="true" tabindex="-1"></a>origin_df.changi.snapped<span class="sc">$</span>start_hr <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(origin_df.changi.snapped<span class="sc">$</span>start_hr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb125"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb125-1"><a href="#cb125-1" aria-hidden="true" tabindex="-1"></a>lixels <span class="ot">&lt;-</span> <span class="fu">lixelize_lines</span>(osm_changi, <span class="dv">200</span>, <span class="at">mindist =</span> <span class="dv">100</span>)</span>
<span id="cb125-2"><a href="#cb125-2" aria-hidden="true" tabindex="-1"></a>sample_points <span class="ot">&lt;-</span> <span class="fu">lines_center</span>(lixels)</span>
<span id="cb125-3"><a href="#cb125-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb125-4"><a href="#cb125-4" aria-hidden="true" tabindex="-1"></a>sample_time.destination <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="fu">min</span>(destination_df.changi.snapped<span class="sc">$</span>end_hr), <span class="fu">max</span>(destination_df.changi.snapped<span class="sc">$</span>end_hr), <span class="dv">1</span>)</span>
<span id="cb125-5"><a href="#cb125-5" aria-hidden="true" tabindex="-1"></a>sample_time.origin <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="fu">min</span>(origin_df.changi.snapped<span class="sc">$</span>start_hr), <span class="fu">max</span>(origin_df.changi.snapped<span class="sc">$</span>start_hr), <span class="dv">1</span>)</span>
<span id="cb125-6"><a href="#cb125-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb125-7"><a href="#cb125-7" aria-hidden="true" tabindex="-1"></a>tnkde_densities.destination <span class="ot">&lt;-</span> <span class="fu">tnkde</span>(<span class="at">lines =</span> osm_changi,</span>
<span id="cb125-8"><a href="#cb125-8" aria-hidden="true" tabindex="-1"></a>                   <span class="at">events =</span> destination_df.changi.snapped,</span>
<span id="cb125-9"><a href="#cb125-9" aria-hidden="true" tabindex="-1"></a>                   <span class="at">time_field =</span> <span class="st">"end_hr"</span>,</span>
<span id="cb125-10"><a href="#cb125-10" aria-hidden="true" tabindex="-1"></a>                   <span class="at">w =</span> <span class="fu">rep</span>(<span class="dv">1</span>, <span class="fu">nrow</span>(destination_df.changi.snapped)), </span>
<span id="cb125-11"><a href="#cb125-11" aria-hidden="true" tabindex="-1"></a>                   <span class="at">samples_loc =</span> sample_points,</span>
<span id="cb125-12"><a href="#cb125-12" aria-hidden="true" tabindex="-1"></a>                   <span class="at">samples_time =</span> sample_time.destination, </span>
<span id="cb125-13"><a href="#cb125-13" aria-hidden="true" tabindex="-1"></a>                   <span class="at">kernel_name =</span> <span class="st">"quartic"</span>,</span>
<span id="cb125-14"><a href="#cb125-14" aria-hidden="true" tabindex="-1"></a>                   <span class="at">bw_net =</span> <span class="dv">300</span>, <span class="at">bw_time =</span> <span class="dv">1</span>,</span>
<span id="cb125-15"><a href="#cb125-15" aria-hidden="true" tabindex="-1"></a>                   <span class="at">adaptive =</span> <span class="cn">TRUE</span>,</span>
<span id="cb125-16"><a href="#cb125-16" aria-hidden="true" tabindex="-1"></a>                   <span class="at">trim_bw_net =</span> <span class="dv">900</span>,</span>
<span id="cb125-17"><a href="#cb125-17" aria-hidden="true" tabindex="-1"></a>                   <span class="at">trim_bw_time =</span> <span class="dv">80</span>,</span>
<span id="cb125-18"><a href="#cb125-18" aria-hidden="true" tabindex="-1"></a>                   <span class="at">method =</span> <span class="st">"discontinuous"</span>,</span>
<span id="cb125-19"><a href="#cb125-19" aria-hidden="true" tabindex="-1"></a>                   <span class="at">div =</span> <span class="st">"bw"</span>, <span class="at">max_depth =</span> <span class="dv">10</span>,</span>
<span id="cb125-20"><a href="#cb125-20" aria-hidden="true" tabindex="-1"></a>                   <span class="at">digits =</span> <span class="dv">2</span>, <span class="at">tol =</span> <span class="fl">0.01</span>,</span>
<span id="cb125-21"><a href="#cb125-21" aria-hidden="true" tabindex="-1"></a>                   <span class="at">agg =</span> <span class="dv">15</span>, <span class="at">grid_shape =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>), </span>
<span id="cb125-22"><a href="#cb125-22" aria-hidden="true" tabindex="-1"></a>                   <span class="at">verbose  =</span> <span class="cn">FALSE</span>)</span>
<span id="cb125-23"><a href="#cb125-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb125-24"><a href="#cb125-24" aria-hidden="true" tabindex="-1"></a>tnkde_densities.origin <span class="ot">&lt;-</span> <span class="fu">tnkde</span>(<span class="at">lines =</span> osm_changi,</span>
<span id="cb125-25"><a href="#cb125-25" aria-hidden="true" tabindex="-1"></a>                   <span class="at">events =</span> origin_df.changi.snapped,</span>
<span id="cb125-26"><a href="#cb125-26" aria-hidden="true" tabindex="-1"></a>                   <span class="at">time_field =</span> <span class="st">"start_hr"</span>,</span>
<span id="cb125-27"><a href="#cb125-27" aria-hidden="true" tabindex="-1"></a>                   <span class="at">w =</span> <span class="fu">rep</span>(<span class="dv">1</span>, <span class="fu">nrow</span>(origin_df.changi.snapped)), </span>
<span id="cb125-28"><a href="#cb125-28" aria-hidden="true" tabindex="-1"></a>                   <span class="at">samples_loc =</span> sample_points,</span>
<span id="cb125-29"><a href="#cb125-29" aria-hidden="true" tabindex="-1"></a>                   <span class="at">samples_time =</span> sample_time.origin, </span>
<span id="cb125-30"><a href="#cb125-30" aria-hidden="true" tabindex="-1"></a>                   <span class="at">kernel_name =</span> <span class="st">"quartic"</span>,</span>
<span id="cb125-31"><a href="#cb125-31" aria-hidden="true" tabindex="-1"></a>                   <span class="at">bw_net =</span> <span class="dv">300</span>, <span class="at">bw_time =</span> <span class="dv">1</span>,</span>
<span id="cb125-32"><a href="#cb125-32" aria-hidden="true" tabindex="-1"></a>                   <span class="at">adaptive =</span> <span class="cn">TRUE</span>,</span>
<span id="cb125-33"><a href="#cb125-33" aria-hidden="true" tabindex="-1"></a>                   <span class="at">trim_bw_net =</span> <span class="dv">900</span>,</span>
<span id="cb125-34"><a href="#cb125-34" aria-hidden="true" tabindex="-1"></a>                   <span class="at">trim_bw_time =</span> <span class="dv">80</span>,</span>
<span id="cb125-35"><a href="#cb125-35" aria-hidden="true" tabindex="-1"></a>                   <span class="at">method =</span> <span class="st">"discontinuous"</span>,</span>
<span id="cb125-36"><a href="#cb125-36" aria-hidden="true" tabindex="-1"></a>                   <span class="at">div =</span> <span class="st">"bw"</span>, <span class="at">max_depth =</span> <span class="dv">10</span>,</span>
<span id="cb125-37"><a href="#cb125-37" aria-hidden="true" tabindex="-1"></a>                   <span class="at">digits =</span> <span class="dv">2</span>, <span class="at">tol =</span> <span class="fl">0.01</span>,</span>
<span id="cb125-38"><a href="#cb125-38" aria-hidden="true" tabindex="-1"></a>                   <span class="at">agg =</span> <span class="dv">15</span>, <span class="at">grid_shape =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>), </span>
<span id="cb125-39"><a href="#cb125-39" aria-hidden="true" tabindex="-1"></a>                   <span class="at">verbose  =</span> <span class="cn">FALSE</span>)</span>
<span id="cb125-40"><a href="#cb125-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb125-41"><a href="#cb125-41" aria-hidden="true" tabindex="-1"></a>all_densities.destination <span class="ot">&lt;-</span> <span class="fu">c</span>(tnkde_densities.destination<span class="sc">$</span>k)</span>
<span id="cb125-42"><a href="#cb125-42" aria-hidden="true" tabindex="-1"></a>color_breaks.destination <span class="ot">&lt;-</span> <span class="fu">classIntervals</span>(all_densities.destination, <span class="at">n =</span> <span class="dv">10</span>, <span class="at">style =</span> <span class="st">"kmeans"</span>)</span>
<span id="cb125-43"><a href="#cb125-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb125-44"><a href="#cb125-44" aria-hidden="true" tabindex="-1"></a>all_maps.destination <span class="ot">&lt;-</span> <span class="fu">lapply</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">ncol</span>(tnkde_densities.destination<span class="sc">$</span>k), <span class="cf">function</span>(i){</span>
<span id="cb125-45"><a href="#cb125-45" aria-hidden="true" tabindex="-1"></a>  time <span class="ot">&lt;-</span> sample_time.destination[[i]]</span>
<span id="cb125-46"><a href="#cb125-46" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb125-47"><a href="#cb125-47" aria-hidden="true" tabindex="-1"></a>  sample_points<span class="sc">$</span>density <span class="ot">&lt;-</span> tnkde_densities.destination<span class="sc">$</span>k[,i]</span>
<span id="cb125-48"><a href="#cb125-48" aria-hidden="true" tabindex="-1"></a>  map1 <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(osm_changi) <span class="sc">+</span> </span>
<span id="cb125-49"><a href="#cb125-49" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tm_lines</span>(<span class="at">lwd=</span><span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb125-50"><a href="#cb125-50" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tm_shape</span>(sample_points) <span class="sc">+</span></span>
<span id="cb125-51"><a href="#cb125-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_dots</span>(<span class="at">col =</span> <span class="st">"density"</span>, <span class="at">size =</span> <span class="fl">0.005</span>,</span>
<span id="cb125-52"><a href="#cb125-52" aria-hidden="true" tabindex="-1"></a>          <span class="at">breaks =</span> color_breaks.destination<span class="sc">$</span>brks, <span class="at">palette =</span> <span class="fu">plasma</span>(<span class="dv">10</span>, <span class="at">direction =</span> <span class="sc">-</span><span class="dv">1</span>)) <span class="sc">+</span>  </span>
<span id="cb125-53"><a href="#cb125-53" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tm_layout</span>(<span class="at">legend.show=</span><span class="cn">FALSE</span>, <span class="at">main.title =</span> <span class="fu">paste</span>(<span class="st">"TNKDE OF GRAB TRIP DESTINATIONS @ CHANGI"</span>, time, <span class="st">":00"</span>), <span class="at">main.title.size =</span> <span class="fl">0.5</span>)</span>
<span id="cb125-54"><a href="#cb125-54" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(map1)</span>
<span id="cb125-55"><a href="#cb125-55" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb125-56"><a href="#cb125-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb125-57"><a href="#cb125-57" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_animation</span>(all_maps.destination, <span class="at">filename =</span> <span class="st">"images/tnkde_destination_changi.gif"</span>, </span>
<span id="cb125-58"><a href="#cb125-58" aria-hidden="true" tabindex="-1"></a>               <span class="at">width =</span> <span class="dv">1000</span>, <span class="at">height =</span> <span class="dv">1000</span>, <span class="at">dpi =</span> <span class="dv">300</span>, <span class="at">delay =</span> <span class="dv">50</span>)</span>
<span id="cb125-59"><a href="#cb125-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb125-60"><a href="#cb125-60" aria-hidden="true" tabindex="-1"></a>all_densities.origin <span class="ot">&lt;-</span> <span class="fu">c</span>(tnkde_densities.origin<span class="sc">$</span>k)</span>
<span id="cb125-61"><a href="#cb125-61" aria-hidden="true" tabindex="-1"></a>color_breaks.origin <span class="ot">&lt;-</span> <span class="fu">classIntervals</span>(all_densities.origin, <span class="at">n =</span> <span class="dv">10</span>, <span class="at">style =</span> <span class="st">"kmeans"</span>)</span>
<span id="cb125-62"><a href="#cb125-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb125-63"><a href="#cb125-63" aria-hidden="true" tabindex="-1"></a>all_maps.origin<span class="ot">&lt;-</span> <span class="fu">lapply</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">ncol</span>(tnkde_densities.origin<span class="sc">$</span>k), <span class="cf">function</span>(i){</span>
<span id="cb125-64"><a href="#cb125-64" aria-hidden="true" tabindex="-1"></a>  time <span class="ot">&lt;-</span> sample_time.origin[[i]]</span>
<span id="cb125-65"><a href="#cb125-65" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb125-66"><a href="#cb125-66" aria-hidden="true" tabindex="-1"></a>  sample_points<span class="sc">$</span>density <span class="ot">&lt;-</span> tnkde_densities.origin<span class="sc">$</span>k[,i]</span>
<span id="cb125-67"><a href="#cb125-67" aria-hidden="true" tabindex="-1"></a>  map1 <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(osm_changi) <span class="sc">+</span> </span>
<span id="cb125-68"><a href="#cb125-68" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tm_lines</span>(<span class="at">lwd=</span><span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb125-69"><a href="#cb125-69" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tm_shape</span>(sample_points) <span class="sc">+</span></span>
<span id="cb125-70"><a href="#cb125-70" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_dots</span>(<span class="at">col =</span> <span class="st">"density"</span>, <span class="at">size =</span> <span class="fl">0.005</span>,</span>
<span id="cb125-71"><a href="#cb125-71" aria-hidden="true" tabindex="-1"></a>          <span class="at">breaks =</span> color_breaks.origin<span class="sc">$</span>brks, <span class="at">palette =</span> <span class="fu">plasma</span>(<span class="dv">10</span>, <span class="at">direction =</span> <span class="sc">-</span><span class="dv">1</span>)) <span class="sc">+</span>   </span>
<span id="cb125-72"><a href="#cb125-72" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tm_layout</span>(<span class="at">legend.show=</span><span class="cn">FALSE</span>, <span class="at">main.title =</span> <span class="fu">paste</span>(<span class="st">"TNKDE OF GRAB TRIP ORIGINS @ CHANGI"</span>, time, <span class="st">":00"</span>), <span class="at">main.title.size =</span> <span class="fl">0.5</span>)</span>
<span id="cb125-73"><a href="#cb125-73" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(map1)</span>
<span id="cb125-74"><a href="#cb125-74" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb125-75"><a href="#cb125-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb125-76"><a href="#cb125-76" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_animation</span>(all_maps.origin, <span class="at">filename =</span> <span class="st">"images/tnkde_origin_changi.gif"</span>, </span>
<span id="cb125-77"><a href="#cb125-77" aria-hidden="true" tabindex="-1"></a>               <span class="at">width =</span> <span class="dv">1000</span>, <span class="at">height =</span> <span class="dv">1000</span>, <span class="at">dpi =</span> <span class="dv">300</span>, <span class="at">delay =</span> <span class="dv">50</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><img src="images/tnkde_origin_changi.gif" class="img-fluid" alt="TNKDEOriginChangi"> <img src="images/tnkde_destination_changi.gif" class="img-fluid" alt="TNKDEOriginChangi"></p>
</section>
<section id="woodlands" class="level3">
<h3 class="anchored" data-anchor-id="woodlands">6.2 Woodlands</h3>
<p>In this TNKDE, we can observe people leaving the woodlands checkpoint in the early morning and evening. We can also observe some other small hotspots in the lower centre of the map.</p>
<p>While this could be where a bus from the checkpoint may stop, it is difficult to say for sure. However, this map shows that there are many private hire vehicles in the lower middle of this study area throughout the day, perhaps indicating a congestion issue as a result of suboptimally designed roads.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb126"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb126-1"><a href="#cb126-1" aria-hidden="true" tabindex="-1"></a>destination_df.woodlands.snapped<span class="sc">$</span>end_hr <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(destination_df.woodlands.snapped<span class="sc">$</span>end_hr)</span>
<span id="cb126-2"><a href="#cb126-2" aria-hidden="true" tabindex="-1"></a>origin_df.woodlands.snapped<span class="sc">$</span>start_hr <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(origin_df.woodlands.snapped<span class="sc">$</span>start_hr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb127"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb127-1"><a href="#cb127-1" aria-hidden="true" tabindex="-1"></a>lixels <span class="ot">&lt;-</span> <span class="fu">lixelize_lines</span>(osm_woodlands, <span class="dv">200</span>, <span class="at">mindist =</span> <span class="dv">100</span>)</span>
<span id="cb127-2"><a href="#cb127-2" aria-hidden="true" tabindex="-1"></a>sample_points <span class="ot">&lt;-</span> <span class="fu">lines_center</span>(lixels)</span>
<span id="cb127-3"><a href="#cb127-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-4"><a href="#cb127-4" aria-hidden="true" tabindex="-1"></a>sample_time.destination <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="fu">min</span>(destination_df.woodlands.snapped<span class="sc">$</span>end_hr), <span class="fu">max</span>(destination_df.woodlands.snapped<span class="sc">$</span>end_hr), <span class="dv">1</span>)</span>
<span id="cb127-5"><a href="#cb127-5" aria-hidden="true" tabindex="-1"></a>sample_time.origin <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="fu">min</span>(origin_df.woodlands.snapped<span class="sc">$</span>start_hr), <span class="fu">max</span>(origin_df.woodlands.snapped<span class="sc">$</span>start_hr), <span class="dv">1</span>)</span>
<span id="cb127-6"><a href="#cb127-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-7"><a href="#cb127-7" aria-hidden="true" tabindex="-1"></a>tnkde_densities.destination <span class="ot">&lt;-</span> <span class="fu">tnkde</span>(<span class="at">lines =</span> osm_woodlands,</span>
<span id="cb127-8"><a href="#cb127-8" aria-hidden="true" tabindex="-1"></a>                   <span class="at">events =</span> destination_df.woodlands.snapped,</span>
<span id="cb127-9"><a href="#cb127-9" aria-hidden="true" tabindex="-1"></a>                   <span class="at">time_field =</span> <span class="st">"end_hr"</span>,</span>
<span id="cb127-10"><a href="#cb127-10" aria-hidden="true" tabindex="-1"></a>                   <span class="at">w =</span> <span class="fu">rep</span>(<span class="dv">1</span>, <span class="fu">nrow</span>(destination_df.woodlands.snapped)), </span>
<span id="cb127-11"><a href="#cb127-11" aria-hidden="true" tabindex="-1"></a>                   <span class="at">samples_loc =</span> sample_points,</span>
<span id="cb127-12"><a href="#cb127-12" aria-hidden="true" tabindex="-1"></a>                   <span class="at">samples_time =</span> sample_time.destination, </span>
<span id="cb127-13"><a href="#cb127-13" aria-hidden="true" tabindex="-1"></a>                   <span class="at">kernel_name =</span> <span class="st">"quartic"</span>,</span>
<span id="cb127-14"><a href="#cb127-14" aria-hidden="true" tabindex="-1"></a>                   <span class="at">bw_net =</span> <span class="dv">300</span>, <span class="at">bw_time =</span> <span class="dv">1</span>,</span>
<span id="cb127-15"><a href="#cb127-15" aria-hidden="true" tabindex="-1"></a>                   <span class="at">adaptive =</span> <span class="cn">TRUE</span>,</span>
<span id="cb127-16"><a href="#cb127-16" aria-hidden="true" tabindex="-1"></a>                   <span class="at">trim_bw_net =</span> <span class="dv">900</span>,</span>
<span id="cb127-17"><a href="#cb127-17" aria-hidden="true" tabindex="-1"></a>                   <span class="at">trim_bw_time =</span> <span class="dv">80</span>,</span>
<span id="cb127-18"><a href="#cb127-18" aria-hidden="true" tabindex="-1"></a>                   <span class="at">method =</span> <span class="st">"discontinuous"</span>,</span>
<span id="cb127-19"><a href="#cb127-19" aria-hidden="true" tabindex="-1"></a>                   <span class="at">div =</span> <span class="st">"bw"</span>, <span class="at">max_depth =</span> <span class="dv">10</span>,</span>
<span id="cb127-20"><a href="#cb127-20" aria-hidden="true" tabindex="-1"></a>                   <span class="at">digits =</span> <span class="dv">2</span>, <span class="at">tol =</span> <span class="fl">0.01</span>,</span>
<span id="cb127-21"><a href="#cb127-21" aria-hidden="true" tabindex="-1"></a>                   <span class="at">agg =</span> <span class="dv">15</span>, <span class="at">grid_shape =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>), </span>
<span id="cb127-22"><a href="#cb127-22" aria-hidden="true" tabindex="-1"></a>                   <span class="at">verbose  =</span> <span class="cn">FALSE</span>)</span>
<span id="cb127-23"><a href="#cb127-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-24"><a href="#cb127-24" aria-hidden="true" tabindex="-1"></a>tnkde_densities.origin <span class="ot">&lt;-</span> <span class="fu">tnkde</span>(<span class="at">lines =</span> osm_woodlands,</span>
<span id="cb127-25"><a href="#cb127-25" aria-hidden="true" tabindex="-1"></a>                   <span class="at">events =</span> origin_df.woodlands.snapped,</span>
<span id="cb127-26"><a href="#cb127-26" aria-hidden="true" tabindex="-1"></a>                   <span class="at">time_field =</span> <span class="st">"start_hr"</span>,</span>
<span id="cb127-27"><a href="#cb127-27" aria-hidden="true" tabindex="-1"></a>                   <span class="at">w =</span> <span class="fu">rep</span>(<span class="dv">1</span>, <span class="fu">nrow</span>(origin_df.woodlands.snapped)), </span>
<span id="cb127-28"><a href="#cb127-28" aria-hidden="true" tabindex="-1"></a>                   <span class="at">samples_loc =</span> sample_points,</span>
<span id="cb127-29"><a href="#cb127-29" aria-hidden="true" tabindex="-1"></a>                   <span class="at">samples_time =</span> sample_time.origin, </span>
<span id="cb127-30"><a href="#cb127-30" aria-hidden="true" tabindex="-1"></a>                   <span class="at">kernel_name =</span> <span class="st">"quartic"</span>,</span>
<span id="cb127-31"><a href="#cb127-31" aria-hidden="true" tabindex="-1"></a>                   <span class="at">bw_net =</span> <span class="dv">300</span>, <span class="at">bw_time =</span> <span class="dv">1</span>,</span>
<span id="cb127-32"><a href="#cb127-32" aria-hidden="true" tabindex="-1"></a>                   <span class="at">adaptive =</span> <span class="cn">TRUE</span>,</span>
<span id="cb127-33"><a href="#cb127-33" aria-hidden="true" tabindex="-1"></a>                   <span class="at">trim_bw_net =</span> <span class="dv">900</span>,</span>
<span id="cb127-34"><a href="#cb127-34" aria-hidden="true" tabindex="-1"></a>                   <span class="at">trim_bw_time =</span> <span class="dv">80</span>,</span>
<span id="cb127-35"><a href="#cb127-35" aria-hidden="true" tabindex="-1"></a>                   <span class="at">method =</span> <span class="st">"discontinuous"</span>,</span>
<span id="cb127-36"><a href="#cb127-36" aria-hidden="true" tabindex="-1"></a>                   <span class="at">div =</span> <span class="st">"bw"</span>, <span class="at">max_depth =</span> <span class="dv">10</span>,</span>
<span id="cb127-37"><a href="#cb127-37" aria-hidden="true" tabindex="-1"></a>                   <span class="at">digits =</span> <span class="dv">2</span>, <span class="at">tol =</span> <span class="fl">0.01</span>,</span>
<span id="cb127-38"><a href="#cb127-38" aria-hidden="true" tabindex="-1"></a>                   <span class="at">agg =</span> <span class="dv">15</span>, <span class="at">grid_shape =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>), </span>
<span id="cb127-39"><a href="#cb127-39" aria-hidden="true" tabindex="-1"></a>                   <span class="at">verbose  =</span> <span class="cn">FALSE</span>)</span>
<span id="cb127-40"><a href="#cb127-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-41"><a href="#cb127-41" aria-hidden="true" tabindex="-1"></a>all_densities.origin <span class="ot">&lt;-</span> <span class="fu">c</span>(tnkde_densities.origin<span class="sc">$</span>k)</span>
<span id="cb127-42"><a href="#cb127-42" aria-hidden="true" tabindex="-1"></a>color_breaks.origin <span class="ot">&lt;-</span> <span class="fu">classIntervals</span>(all_densities.origin, <span class="at">n =</span> <span class="dv">10</span>, <span class="at">style =</span> <span class="st">"kmeans"</span>)</span>
<span id="cb127-43"><a href="#cb127-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-44"><a href="#cb127-44" aria-hidden="true" tabindex="-1"></a>all_maps.origin <span class="ot">&lt;-</span> <span class="fu">lapply</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">ncol</span>(tnkde_densities.origin<span class="sc">$</span>k), <span class="cf">function</span>(i){</span>
<span id="cb127-45"><a href="#cb127-45" aria-hidden="true" tabindex="-1"></a>  time <span class="ot">&lt;-</span> sample_time.origin[[i]]</span>
<span id="cb127-46"><a href="#cb127-46" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb127-47"><a href="#cb127-47" aria-hidden="true" tabindex="-1"></a>  sample_points<span class="sc">$</span>density <span class="ot">&lt;-</span> tnkde_densities.origin<span class="sc">$</span>k[,i]</span>
<span id="cb127-48"><a href="#cb127-48" aria-hidden="true" tabindex="-1"></a>  map1 <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(osm_woodlands) <span class="sc">+</span> </span>
<span id="cb127-49"><a href="#cb127-49" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tm_lines</span>(<span class="at">lwd=</span><span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb127-50"><a href="#cb127-50" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tm_shape</span>(sample_points) <span class="sc">+</span></span>
<span id="cb127-51"><a href="#cb127-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_dots</span>(<span class="at">col =</span> <span class="st">"density"</span>, <span class="at">size =</span> <span class="fl">0.005</span>,</span>
<span id="cb127-52"><a href="#cb127-52" aria-hidden="true" tabindex="-1"></a>          <span class="at">breaks =</span> color_breaks.origin<span class="sc">$</span>brks, <span class="at">palette =</span> <span class="fu">plasma</span>(<span class="dv">10</span>, <span class="at">direction =</span> <span class="sc">-</span><span class="dv">1</span>)) <span class="sc">+</span>  </span>
<span id="cb127-53"><a href="#cb127-53" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tm_layout</span>(<span class="at">legend.show=</span><span class="cn">FALSE</span>, <span class="at">main.title =</span> <span class="fu">paste</span>(<span class="st">"TNKDE OF GRAB TRIP ORIGINS @ WOODLANDS"</span>, time, <span class="st">":00"</span>), <span class="at">main.title.size =</span> <span class="fl">0.5</span>)</span>
<span id="cb127-54"><a href="#cb127-54" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(map1)</span>
<span id="cb127-55"><a href="#cb127-55" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb127-56"><a href="#cb127-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-57"><a href="#cb127-57" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_animation</span>(all_maps.origin, <span class="at">filename =</span> <span class="st">"images/tnkde_origin_woodlands.gif"</span>, </span>
<span id="cb127-58"><a href="#cb127-58" aria-hidden="true" tabindex="-1"></a>               <span class="at">width =</span> <span class="dv">1000</span>, <span class="at">height =</span> <span class="dv">1000</span>, <span class="at">dpi =</span> <span class="dv">300</span>, <span class="at">delay =</span> <span class="dv">50</span>)</span>
<span id="cb127-59"><a href="#cb127-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-60"><a href="#cb127-60" aria-hidden="true" tabindex="-1"></a>all_densities.destination <span class="ot">&lt;-</span> <span class="fu">c</span>(tnkde_densities.destination<span class="sc">$</span>k)</span>
<span id="cb127-61"><a href="#cb127-61" aria-hidden="true" tabindex="-1"></a>color_breaks.destination <span class="ot">&lt;-</span> <span class="fu">classIntervals</span>(all_densities.destination, <span class="at">n =</span> <span class="dv">10</span>, <span class="at">style =</span> <span class="st">"kmeans"</span>)</span>
<span id="cb127-62"><a href="#cb127-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-63"><a href="#cb127-63" aria-hidden="true" tabindex="-1"></a>all_maps.destination<span class="ot">&lt;-</span> <span class="fu">lapply</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">ncol</span>(tnkde_densities.destination<span class="sc">$</span>k), <span class="cf">function</span>(i){</span>
<span id="cb127-64"><a href="#cb127-64" aria-hidden="true" tabindex="-1"></a>  time <span class="ot">&lt;-</span> sample_time.destination[[i]]</span>
<span id="cb127-65"><a href="#cb127-65" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb127-66"><a href="#cb127-66" aria-hidden="true" tabindex="-1"></a>  sample_points<span class="sc">$</span>density <span class="ot">&lt;-</span> tnkde_densities.destination<span class="sc">$</span>k[,i]</span>
<span id="cb127-67"><a href="#cb127-67" aria-hidden="true" tabindex="-1"></a>  map1 <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(osm_woodlands) <span class="sc">+</span> </span>
<span id="cb127-68"><a href="#cb127-68" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tm_lines</span>(<span class="at">lwd=</span><span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb127-69"><a href="#cb127-69" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tm_shape</span>(sample_points) <span class="sc">+</span></span>
<span id="cb127-70"><a href="#cb127-70" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_dots</span>(<span class="at">col =</span> <span class="st">"density"</span>, <span class="at">size =</span> <span class="fl">0.005</span>,</span>
<span id="cb127-71"><a href="#cb127-71" aria-hidden="true" tabindex="-1"></a>          <span class="at">breaks =</span> color_breaks.destination<span class="sc">$</span>brks, <span class="at">palette =</span> <span class="fu">plasma</span>(<span class="dv">10</span>, <span class="at">direction =</span> <span class="sc">-</span><span class="dv">1</span>)) <span class="sc">+</span>  </span>
<span id="cb127-72"><a href="#cb127-72" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tm_layout</span>(<span class="at">legend.show=</span><span class="cn">FALSE</span>, <span class="at">main.title =</span> <span class="fu">paste</span>(<span class="st">"TNKDE OF GRAB TRIP DESTINATIONS @ WOODLANDS "</span>, time, <span class="st">":00"</span>), <span class="at">main.title.size =</span> <span class="fl">0.5</span>)</span>
<span id="cb127-73"><a href="#cb127-73" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(map1)</span>
<span id="cb127-74"><a href="#cb127-74" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb127-75"><a href="#cb127-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-76"><a href="#cb127-76" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_animation</span>(all_maps.destination, <span class="at">filename =</span> <span class="st">"images/tnkde_destination_woodlands.gif"</span>, </span>
<span id="cb127-77"><a href="#cb127-77" aria-hidden="true" tabindex="-1"></a>               <span class="at">width =</span> <span class="dv">1000</span>, <span class="at">height =</span> <span class="dv">1000</span>, <span class="at">dpi =</span> <span class="dv">300</span>, <span class="at">delay =</span> <span class="dv">50</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><img src="images/tnkde_origin_woodlands.gif" class="img-fluid" alt="TNKDEOriginWoodlands"> <img src="images/tnkde_destination_woodlands.gif" class="img-fluid" alt="TNKDEDestinationWoodlands"></p>
</section>
<section id="downtown-core" class="level3">
<h3 class="anchored" data-anchor-id="downtown-core">6.3 Downtown Core</h3>
<p>From the TNKDE, we can see the southern part of the map light up after midnight! This might indicate that the area, especially around Lau Pa Sat, contributes to Grab ride origins as a place to relax in the evenings. The area also becomes busy around lunch hour, as expected.</p>
<p>In contrast, the destinations map does not light up as much. Although the NKDE may indicate heavy congestion due to private hire vehicles, the TNKDE shows that this may not be as persistent a problem as expected.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb128"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb128-1"><a href="#cb128-1" aria-hidden="true" tabindex="-1"></a>destination_df.town.snapped<span class="sc">$</span>end_hr <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(destination_df.town.snapped<span class="sc">$</span>end_hr)</span>
<span id="cb128-2"><a href="#cb128-2" aria-hidden="true" tabindex="-1"></a>origin_df.town.snapped<span class="sc">$</span>start_hr <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(origin_df.town.snapped<span class="sc">$</span>start_hr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb129"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb129-1"><a href="#cb129-1" aria-hidden="true" tabindex="-1"></a>lixels <span class="ot">&lt;-</span> <span class="fu">lixelize_lines</span>(osm_town, <span class="dv">200</span>, <span class="at">mindist =</span> <span class="dv">100</span>)</span>
<span id="cb129-2"><a href="#cb129-2" aria-hidden="true" tabindex="-1"></a>sample_points <span class="ot">&lt;-</span> <span class="fu">lines_center</span>(lixels)</span>
<span id="cb129-3"><a href="#cb129-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-4"><a href="#cb129-4" aria-hidden="true" tabindex="-1"></a>sample_time.destination <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="fu">min</span>(destination_df.town.snapped<span class="sc">$</span>end_hr), <span class="fu">max</span>(destination_df.town.snapped<span class="sc">$</span>end_hr), <span class="dv">1</span>)</span>
<span id="cb129-5"><a href="#cb129-5" aria-hidden="true" tabindex="-1"></a>sample_time.origin <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="fu">min</span>(origin_df.town.snapped<span class="sc">$</span>start_hr), <span class="fu">max</span>(origin_df.town.snapped<span class="sc">$</span>start_hr), <span class="dv">1</span>)</span>
<span id="cb129-6"><a href="#cb129-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-7"><a href="#cb129-7" aria-hidden="true" tabindex="-1"></a>tnkde_densities.destination <span class="ot">&lt;-</span> <span class="fu">tnkde</span>(<span class="at">lines =</span> osm_town,</span>
<span id="cb129-8"><a href="#cb129-8" aria-hidden="true" tabindex="-1"></a>                   <span class="at">events =</span> destination_df.town.snapped,</span>
<span id="cb129-9"><a href="#cb129-9" aria-hidden="true" tabindex="-1"></a>                   <span class="at">time_field =</span> <span class="st">"end_hr"</span>,</span>
<span id="cb129-10"><a href="#cb129-10" aria-hidden="true" tabindex="-1"></a>                   <span class="at">w =</span> <span class="fu">rep</span>(<span class="dv">1</span>, <span class="fu">nrow</span>(destination_df.town.snapped)), </span>
<span id="cb129-11"><a href="#cb129-11" aria-hidden="true" tabindex="-1"></a>                   <span class="at">samples_loc =</span> sample_points,</span>
<span id="cb129-12"><a href="#cb129-12" aria-hidden="true" tabindex="-1"></a>                   <span class="at">samples_time =</span> sample_time.destination, </span>
<span id="cb129-13"><a href="#cb129-13" aria-hidden="true" tabindex="-1"></a>                   <span class="at">kernel_name =</span> <span class="st">"quartic"</span>,</span>
<span id="cb129-14"><a href="#cb129-14" aria-hidden="true" tabindex="-1"></a>                   <span class="at">bw_net =</span> <span class="dv">300</span>, <span class="at">bw_time =</span> <span class="dv">1</span>,</span>
<span id="cb129-15"><a href="#cb129-15" aria-hidden="true" tabindex="-1"></a>                   <span class="at">adaptive =</span> <span class="cn">TRUE</span>,</span>
<span id="cb129-16"><a href="#cb129-16" aria-hidden="true" tabindex="-1"></a>                   <span class="at">trim_bw_net =</span> <span class="dv">900</span>,</span>
<span id="cb129-17"><a href="#cb129-17" aria-hidden="true" tabindex="-1"></a>                   <span class="at">trim_bw_time =</span> <span class="dv">80</span>,</span>
<span id="cb129-18"><a href="#cb129-18" aria-hidden="true" tabindex="-1"></a>                   <span class="at">method =</span> <span class="st">"discontinuous"</span>,</span>
<span id="cb129-19"><a href="#cb129-19" aria-hidden="true" tabindex="-1"></a>                   <span class="at">div =</span> <span class="st">"bw"</span>, <span class="at">max_depth =</span> <span class="dv">10</span>,</span>
<span id="cb129-20"><a href="#cb129-20" aria-hidden="true" tabindex="-1"></a>                   <span class="at">digits =</span> <span class="dv">2</span>, <span class="at">tol =</span> <span class="fl">0.01</span>,</span>
<span id="cb129-21"><a href="#cb129-21" aria-hidden="true" tabindex="-1"></a>                   <span class="at">agg =</span> <span class="dv">15</span>, <span class="at">grid_shape =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>), </span>
<span id="cb129-22"><a href="#cb129-22" aria-hidden="true" tabindex="-1"></a>                   <span class="at">verbose  =</span> <span class="cn">FALSE</span>)</span>
<span id="cb129-23"><a href="#cb129-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-24"><a href="#cb129-24" aria-hidden="true" tabindex="-1"></a>tnkde_densities.origin <span class="ot">&lt;-</span> <span class="fu">tnkde</span>(<span class="at">lines =</span> osm_town,</span>
<span id="cb129-25"><a href="#cb129-25" aria-hidden="true" tabindex="-1"></a>                   <span class="at">events =</span> origin_df.town.snapped,</span>
<span id="cb129-26"><a href="#cb129-26" aria-hidden="true" tabindex="-1"></a>                   <span class="at">time_field =</span> <span class="st">"start_hr"</span>,</span>
<span id="cb129-27"><a href="#cb129-27" aria-hidden="true" tabindex="-1"></a>                   <span class="at">w =</span> <span class="fu">rep</span>(<span class="dv">1</span>, <span class="fu">nrow</span>(origin_df.town.snapped)), </span>
<span id="cb129-28"><a href="#cb129-28" aria-hidden="true" tabindex="-1"></a>                   <span class="at">samples_loc =</span> sample_points,</span>
<span id="cb129-29"><a href="#cb129-29" aria-hidden="true" tabindex="-1"></a>                   <span class="at">samples_time =</span> sample_time.origin, </span>
<span id="cb129-30"><a href="#cb129-30" aria-hidden="true" tabindex="-1"></a>                   <span class="at">kernel_name =</span> <span class="st">"quartic"</span>,</span>
<span id="cb129-31"><a href="#cb129-31" aria-hidden="true" tabindex="-1"></a>                   <span class="at">bw_net =</span> <span class="dv">300</span>, <span class="at">bw_time =</span> <span class="dv">1</span>,</span>
<span id="cb129-32"><a href="#cb129-32" aria-hidden="true" tabindex="-1"></a>                   <span class="at">adaptive =</span> <span class="cn">TRUE</span>,</span>
<span id="cb129-33"><a href="#cb129-33" aria-hidden="true" tabindex="-1"></a>                   <span class="at">trim_bw_net =</span> <span class="dv">900</span>,</span>
<span id="cb129-34"><a href="#cb129-34" aria-hidden="true" tabindex="-1"></a>                   <span class="at">trim_bw_time =</span> <span class="dv">80</span>,</span>
<span id="cb129-35"><a href="#cb129-35" aria-hidden="true" tabindex="-1"></a>                   <span class="at">method =</span> <span class="st">"discontinuous"</span>,</span>
<span id="cb129-36"><a href="#cb129-36" aria-hidden="true" tabindex="-1"></a>                   <span class="at">div =</span> <span class="st">"bw"</span>, <span class="at">max_depth =</span> <span class="dv">10</span>,</span>
<span id="cb129-37"><a href="#cb129-37" aria-hidden="true" tabindex="-1"></a>                   <span class="at">digits =</span> <span class="dv">2</span>, <span class="at">tol =</span> <span class="fl">0.01</span>,</span>
<span id="cb129-38"><a href="#cb129-38" aria-hidden="true" tabindex="-1"></a>                   <span class="at">agg =</span> <span class="dv">15</span>, <span class="at">grid_shape =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>), </span>
<span id="cb129-39"><a href="#cb129-39" aria-hidden="true" tabindex="-1"></a>                   <span class="at">verbose  =</span> <span class="cn">FALSE</span>)</span>
<span id="cb129-40"><a href="#cb129-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-41"><a href="#cb129-41" aria-hidden="true" tabindex="-1"></a>all_densities.origin <span class="ot">&lt;-</span> <span class="fu">c</span>(tnkde_densities.origin<span class="sc">$</span>k)</span>
<span id="cb129-42"><a href="#cb129-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-43"><a href="#cb129-43" aria-hidden="true" tabindex="-1"></a>color_breaks.origin <span class="ot">&lt;-</span> <span class="fu">classIntervals</span>(all_densities.origin, <span class="at">n =</span> <span class="dv">10</span>, <span class="at">style =</span> <span class="st">"kmeans"</span>)</span>
<span id="cb129-44"><a href="#cb129-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-45"><a href="#cb129-45" aria-hidden="true" tabindex="-1"></a>all_maps.origin <span class="ot">&lt;-</span> <span class="fu">lapply</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">ncol</span>(tnkde_densities.origin<span class="sc">$</span>k), <span class="cf">function</span>(i){</span>
<span id="cb129-46"><a href="#cb129-46" aria-hidden="true" tabindex="-1"></a>  time <span class="ot">&lt;-</span> sample_time.origin[[i]]</span>
<span id="cb129-47"><a href="#cb129-47" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb129-48"><a href="#cb129-48" aria-hidden="true" tabindex="-1"></a>  sample_points<span class="sc">$</span>density <span class="ot">&lt;-</span> tnkde_densities.origin<span class="sc">$</span>k[,i]</span>
<span id="cb129-49"><a href="#cb129-49" aria-hidden="true" tabindex="-1"></a>  map1 <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(osm_town) <span class="sc">+</span> </span>
<span id="cb129-50"><a href="#cb129-50" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tm_lines</span>(<span class="at">lwd=</span><span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb129-51"><a href="#cb129-51" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tm_shape</span>(sample_points) <span class="sc">+</span></span>
<span id="cb129-52"><a href="#cb129-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_dots</span>(<span class="at">col =</span> <span class="st">"density"</span>, <span class="at">size =</span> <span class="fl">0.005</span>,</span>
<span id="cb129-53"><a href="#cb129-53" aria-hidden="true" tabindex="-1"></a>          <span class="at">breaks =</span> color_breaks.origin<span class="sc">$</span>brks, <span class="at">palette =</span> <span class="fu">plasma</span>(<span class="dv">10</span>, <span class="at">direction =</span> <span class="sc">-</span><span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb129-54"><a href="#cb129-54" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tm_layout</span>(<span class="at">legend.show=</span><span class="cn">FALSE</span>, <span class="at">main.title =</span> <span class="fu">paste</span>(<span class="st">"TNKDE OF GRAB TRIP ORIGINS @ DOWNTOWN CORE"</span>, time, <span class="st">":00"</span>), <span class="at">main.title.size =</span> <span class="fl">0.5</span>)</span>
<span id="cb129-55"><a href="#cb129-55" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(map1)</span>
<span id="cb129-56"><a href="#cb129-56" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb129-57"><a href="#cb129-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-58"><a href="#cb129-58" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_animation</span>(all_maps.origin, <span class="at">filename =</span> <span class="st">"images/tnkde_origin_town.gif"</span>, </span>
<span id="cb129-59"><a href="#cb129-59" aria-hidden="true" tabindex="-1"></a>               <span class="at">width =</span> <span class="dv">1000</span>, <span class="at">height =</span> <span class="dv">1000</span>, <span class="at">dpi =</span> <span class="dv">300</span>, <span class="at">delay =</span> <span class="dv">50</span>)</span>
<span id="cb129-60"><a href="#cb129-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-61"><a href="#cb129-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-62"><a href="#cb129-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-63"><a href="#cb129-63" aria-hidden="true" tabindex="-1"></a>all_densities.destination <span class="ot">&lt;-</span> <span class="fu">c</span>(tnkde_densities.destination<span class="sc">$</span>k)</span>
<span id="cb129-64"><a href="#cb129-64" aria-hidden="true" tabindex="-1"></a>color_breaks.destination <span class="ot">&lt;-</span> <span class="fu">classIntervals</span>(all_densities.destination, <span class="at">n =</span> <span class="dv">10</span>, <span class="at">style =</span> <span class="st">"kmeans"</span>)</span>
<span id="cb129-65"><a href="#cb129-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-66"><a href="#cb129-66" aria-hidden="true" tabindex="-1"></a>all_maps.destination<span class="ot">&lt;-</span> <span class="fu">lapply</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">ncol</span>(tnkde_densities.destination<span class="sc">$</span>k), <span class="cf">function</span>(i){</span>
<span id="cb129-67"><a href="#cb129-67" aria-hidden="true" tabindex="-1"></a>  time <span class="ot">&lt;-</span> sample_time.destination[[i]]</span>
<span id="cb129-68"><a href="#cb129-68" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb129-69"><a href="#cb129-69" aria-hidden="true" tabindex="-1"></a>  sample_points<span class="sc">$</span>density <span class="ot">&lt;-</span> tnkde_densities.destination<span class="sc">$</span>k[,i]</span>
<span id="cb129-70"><a href="#cb129-70" aria-hidden="true" tabindex="-1"></a>  map1 <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(osm_town) <span class="sc">+</span> </span>
<span id="cb129-71"><a href="#cb129-71" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tm_lines</span>(<span class="at">lwd=</span><span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb129-72"><a href="#cb129-72" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tm_shape</span>(sample_points) <span class="sc">+</span></span>
<span id="cb129-73"><a href="#cb129-73" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_dots</span>(<span class="at">col =</span> <span class="st">"density"</span>, <span class="at">size =</span> <span class="fl">0.005</span>,</span>
<span id="cb129-74"><a href="#cb129-74" aria-hidden="true" tabindex="-1"></a>          <span class="at">breaks =</span> color_breaks.destination<span class="sc">$</span>brks, <span class="at">palette =</span> <span class="fu">plasma</span>(<span class="dv">10</span>, <span class="at">direction =</span> <span class="sc">-</span><span class="dv">1</span>)) <span class="sc">+</span> </span>
<span id="cb129-75"><a href="#cb129-75" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tm_layout</span>(<span class="at">legend.show=</span><span class="cn">FALSE</span>, <span class="at">main.title =</span> <span class="fu">paste</span>(<span class="st">"TNKDE OF GRAB TRIP DESTINATIONS @ DOWNTOWN CORE "</span>, time, <span class="st">":00"</span>), <span class="at">main.title.size =</span> <span class="fl">0.5</span>)</span>
<span id="cb129-76"><a href="#cb129-76" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(map1)</span>
<span id="cb129-77"><a href="#cb129-77" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb129-78"><a href="#cb129-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-79"><a href="#cb129-79" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_animation</span>(all_maps.destination, <span class="at">filename =</span> <span class="st">"images/tnkde_destination_town.gif"</span>, </span>
<span id="cb129-80"><a href="#cb129-80" aria-hidden="true" tabindex="-1"></a>               <span class="at">width =</span> <span class="dv">1000</span>, <span class="at">height =</span> <span class="dv">1000</span>, <span class="at">dpi =</span> <span class="dv">300</span>, <span class="at">delay =</span> <span class="dv">50</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><img src="images/tnkde_origin_town.gif" class="img-fluid" alt="TNKDEOriginTown"> <img src="images/tnkde_destination_town.gif" class="img-fluid" alt="TNKDEDestinationTown"></p>
</section>
</section>
<section id="conclusions" class="level2">
<h2 class="anchored" data-anchor-id="conclusions">7.0 Conclusions</h2>
<p>The Grab Posisi dataset has yielded many interesting insights with Spatial Point Analysis. From commuter behaviour and safety in Changi airport, investigating private hire vehicle use around the Woodlands checkpoint to visualising the daily patterns of the downtown core, spatial point analysis has proven itself to be a powerful tool.</p>
<p>In terms of policy making, anecdotal evidence is not sufficient. Reported patterns through interviews may not truly reflect the patterns in crowded areas. Spatial Point Analysis can contribute heavily to the public good by identifying dangerous patterns, inefficiencies, and ways to facilitate life in a society that just wants to have dinner after work at Lau Pa Sat. Although the public may never know the full extent of the planning and analysis that goes on behind the scenes and drives decision making, NKDE and TNKDE maps help paint simple yet effective messages to build understanding and cohesion.</p>
</section>
<section id="personal-learnings" class="level2">
<h2 class="anchored" data-anchor-id="personal-learnings">8.0 Personal Learnings</h2>
<p>This exercise has been a rigorous and challenging introduction to r programming. Dealing with many issues related to data types, formats and other complexities associated with geospatial data.</p>
<p>Although this exercise became very time consuming and frustrating at times, I believe that the next exercises will be much faster, having gone through extensive documentation and numerous roadblocks.</p>
<p>Ultimately, this has been a fun and interesting experience about finding patterns otherwise invisible to the naked eye.</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      return note.innerHTML;
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>