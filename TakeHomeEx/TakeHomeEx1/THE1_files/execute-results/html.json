{
  "hash": "ab03dea8c10284a04c7512e78231c4fc",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Take-Home Exercise 1\"\nauthor:\n  - name: Matthew Ho\n    url: https://www.linkedin.com/in/matthewhoyiwen/\ndate: 01-19-2024\ndescription: |\n  Take-Home Exercise 1\ncategories:\n  - Take-Home Exercise\nformat:\n  html:\n    toc: true\nexecute: \n  eval: true\n  echo: true\n  warning: false\n---\n\n\n## 1.0 Overview\n\n### 1.1 Objectives\n\n#### Exercise Requirements\n\n1.  Using appropriate function of sf and tidyverse, preparing the following geospatial data layer in sf tibble data.frames:\n\n-   Grab taxi location points either by origins or destinations.\n\n-   Road layer within Singapore excluding outer islands.\n\n-   Singapore boundary layer excluding outer islands\n\n2.  Using the extracted data, derive traditional Kernel Density Estimation layers.\n3.  Using the extracted data, derive either Network Kernel Density Estimation (NKDE) or Temporal Network Kernel Density Estimation (TNKDE) Using appropriate tmap functions, display the kernel density layers on openstreetmap of Singapore.\n4.  Describe the spatial patterns revealed by the kernel density maps.\n\n### 1.2 Approach\n\nThis exercise seems quite straightforward, but I think that some genuinely useful information can be derived from this data. While removing the outer islands can be done fairly easily, I think that other small issues, like holes in the geometry will need to be fixed. \n\nNKDE may also require very long computation times for large areas, especially given the magnitude of the entire dataset. The GrabPosisi dataset's journey start and destination locations likely occur along smaller roads where people can walk. These small roads are likely near other small roads, which will greatly increase the number of affect lixels for every NKDE operation. Since these small roads will have the most interesting data, I will have to scale down my analysis to smaller locations determined by the simpler KDE analysis.\n\n## 2.0 Setup\n\n### 2.1 Dependencies\n\nAside from the tools used in class, I also included some additional tools I found useful.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\npacman::p_load(tidyverse, sf, tmap, maptools, spatstat, spNetwork, tmap, classInt, viridis, smoothr, arrow, stringr, purrr)\n```\n:::\n\n\n### 2.2 Datasets\n\n#### Aspatial data\n\nGrab-Posisi Singapore dataset\n\n#### Geospatial data\n\n1.  Road data set from Geofabrik's OpenStreetMap.\n\n-   Although the dataset includes all of Malaysia, Singapore, and Brunei, only Singapore's data will required.\n\n2.  Master Plan 2019 Subzone Boundary (No Sea) from Data.gov.sg.\n\n## 3.0 Data Wrangling\n\n### 3.1 Importing Data\n\n#### Reading the Grab-Posisi Parquet Files\n\n\n::: {.cell}\n\n```{.r .cell-code}\ngrabp <- open_dataset(\"data/aspatial/GrabPosisi/\") %>% as.data.frame()\n```\n:::\n\n\n#### Opening the geospatial data\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmpsz = st_read(\"data/geospatial/MasterPlan2019SubzoneBoundaryNoSeaKML.kml\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nReading layer `URA_MP19_SUBZONE_NO_SEA_PL' from data source \n  `/Users/matthewho/Work/Y3S2/IS415/Website/IS415/TakeHomeEx/TakeHomeEx1/data/geospatial/MasterPlan2019SubzoneBoundaryNoSeaKML.kml' \n  using driver `KML'\nSimple feature collection with 332 features and 2 fields\nGeometry type: MULTIPOLYGON\nDimension:     XY, XYZ\nBounding box:  xmin: 103.6057 ymin: 1.158699 xmax: 104.0885 ymax: 1.470775\nz_range:       zmin: 0 zmax: 0\nGeodetic CRS:  WGS 84\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nmpsz$Description[1]\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"<center><table><tr><th colspan='2' align='center'><em>Attributes</em></th></tr><tr bgcolor=\\\"#E3E3F3\\\"> <th>SUBZONE_NO</th> <td>12</td> </tr><tr bgcolor=\\\"\\\"> <th>SUBZONE_N</th> <td>DEPOT ROAD</td> </tr><tr bgcolor=\\\"#E3E3F3\\\"> <th>SUBZONE_C</th> <td>BMSZ12</td> </tr><tr bgcolor=\\\"\\\"> <th>CA_IND</th> <td>N</td> </tr><tr bgcolor=\\\"#E3E3F3\\\"> <th>PLN_AREA_N</th> <td>BUKIT MERAH</td> </tr><tr bgcolor=\\\"\\\"> <th>PLN_AREA_C</th> <td>BM</td> </tr><tr bgcolor=\\\"#E3E3F3\\\"> <th>REGION_N</th> <td>CENTRAL REGION</td> </tr><tr bgcolor=\\\"\\\"> <th>REGION_C</th> <td>CR</td> </tr><tr bgcolor=\\\"#E3E3F3\\\"> <th>INC_CRC</th> <td>C22DED671DE2A940</td> </tr><tr bgcolor=\\\"\\\"> <th>FMEL_UPD_D</th> <td>20191223152313</td> </tr></table></center>\"\n```\n\n\n:::\n:::\n\nhttps://www.linkedin.com/pulse/r-using-stringr-extract-information-from-html-tags-kml-melvin-kew/\n\n::: {.cell}\n\n```{.r .cell-code}\nmpsz <- mpsz %>% \n  mutate(Match=str_match_all(Description,\"<td>(.*?)</td>\")) %>% \n  mutate(Match=map(Match, ~ .[,2])) %>% \n  mutate(Match=map(Match,setNames,c(\"SUBZONE_NO\",\"SUBZONE_N\",\"SUBZONE_C\", \"CA_IND\", \"PLN_AREA_N\", \"PLN_AREA_C\", \"REGION_N\", \"REGION_C\", \"INC_CRC\", \"FMEL_UPD_D\"))) %>% \n  unnest_wider(Match) %>%\n  st_as_sf()\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nsummary(mpsz)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n     Name           Description                  geometry    SUBZONE_NO       \n Length:332         Length:332         MULTIPOLYGON  : 11   Length:332        \n Class :character   Class :character   MULTIPOLYGON Z:321   Class :character  \n Mode  :character   Mode  :character   epsg:4326     :  0   Mode  :character  \n                                       +proj=long... :  0                     \n  SUBZONE_N          SUBZONE_C            CA_IND           PLN_AREA_N       \n Length:332         Length:332         Length:332         Length:332        \n Class :character   Class :character   Class :character   Class :character  \n Mode  :character   Mode  :character   Mode  :character   Mode  :character  \n                                                                            \n  PLN_AREA_C          REGION_N           REGION_C           INC_CRC         \n Length:332         Length:332         Length:332         Length:332        \n Class :character   Class :character   Class :character   Class :character  \n Mode  :character   Mode  :character   Mode  :character   Mode  :character  \n                                                                            \n  FMEL_UPD_D       \n Length:332        \n Class :character  \n Mode  :character  \n                   \n```\n\n\n:::\n\n```{.r .cell-code}\nmpsz <- mpsz %>% dplyr::select('Name', 'Description', 'geometry', 'SUBZONE_NO', 'SUBZONE_N', 'PLN_AREA_N', 'PLN_AREA_C', 'REGION_N', 'REGION_C')\nsummary(mpsz)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n     Name           Description                  geometry    SUBZONE_NO       \n Length:332         Length:332         MULTIPOLYGON  : 11   Length:332        \n Class :character   Class :character   MULTIPOLYGON Z:321   Class :character  \n Mode  :character   Mode  :character   epsg:4326     :  0   Mode  :character  \n                                       +proj=long... :  0                     \n  SUBZONE_N          PLN_AREA_N         PLN_AREA_C          REGION_N        \n Length:332         Length:332         Length:332         Length:332        \n Class :character   Class :character   Class :character   Class :character  \n Mode  :character   Mode  :character   Mode  :character   Mode  :character  \n                                                                            \n   REGION_C        \n Length:332        \n Class :character  \n Mode  :character  \n                   \n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nosm = st_read(\"data/geospatial/osm.shp.zip\", layer=\"gis_osm_roads_free_1\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nReading layer `gis_osm_roads_free_1' from data source \n  `/Users/matthewho/Work/Y3S2/IS415/Website/IS415/TakeHomeEx/TakeHomeEx1/data/geospatial/osm.shp.zip' \n  using driver `ESRI Shapefile'\nSimple feature collection with 1763129 features and 10 fields\nGeometry type: LINESTRING\nDimension:     XY\nBounding box:  xmin: 99.66041 ymin: 0.8021131 xmax: 119.2601 ymax: 7.514393\nGeodetic CRS:  WGS 84\n```\n\n\n:::\n:::\n\n\n### 3.2 Basic preprocessing\n\n\n::: {.cell}\n\n```{.r .cell-code}\nhead(grabp)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 6 Ã— 9\n  trj_id driving_mode osname  pingtimestamp rawlat rawlng speed bearing accuracy\n  <chr>  <chr>        <chr>           <int>  <dbl>  <dbl> <dbl>   <int>    <dbl>\n1 70014  car          android    1554943236   1.34   104.  18.9     248      3.9\n2 73573  car          android    1555582623   1.32   104.  17.7      44      4  \n3 75567  car          android    1555141026   1.33   104.  14.0      34      3.9\n4 1410   car          android    1555731693   1.26   104.  13.0     181      4  \n5 4354   car          android    1555584497   1.28   104.  14.8      93      3.9\n6 32630  car          android    1555395258   1.30   104.  23.2      73      3.9\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ngrabp$pingtimestamp <- as_datetime(grabp$pingtimestamp)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\norigin_df <- grabp %>%\n  group_by(trj_id) %>%\n  arrange(pingtimestamp) %>%\n  filter(row_number()==1) %>%\n  mutate(weekday = wday(pingtimestamp,\n                        label=TRUE,\n                        abbr=TRUE),\n         start_hr = factor(hour(pingtimestamp)),\n         day = factor(mday(pingtimestamp))) %>%\n  st_as_sf(coords = c(\"rawlng\", \"rawlat\"),\n                      crs = 4326) %>%\n  st_transform(crs = 3414)\n\ndestination_df <- grabp %>%\n  group_by(trj_id) %>%\n  arrange(desc(pingtimestamp)) %>%\n  filter(row_number()==1) %>%\n  mutate(weekday = wday(pingtimestamp,\n                        label=TRUE,\n                        abbr=TRUE),\n         end_hr = factor(hour(pingtimestamp)),\n         day = factor(mday(pingtimestamp))) %>%\n  st_as_sf(coords = c(\"rawlng\", \"rawlat\"),\n                      crs = 4326) %>%\n  st_transform(crs = 3414)\n\nhead(origin_df)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nSimple feature collection with 6 features and 10 fields\nGeometry type: POINT\nDimension:     XY\nBounding box:  xmin: 17201.85 ymin: 29236.55 xmax: 31518.05 ymax: 47967.97\nProjected CRS: SVY21 / Singapore TM\n# A tibble: 6 Ã— 11\n# Groups:   trj_id [6]\n  trj_id driving_mode osname pingtimestamp        speed bearing accuracy weekday\n  <chr>  <chr>        <chr>  <dttm>               <dbl>   <int>    <dbl> <ord>  \n1 70895  car          androâ€¦ 2019-04-08 00:09:26  9.95      111      4   Mon    \n2 21926  car          androâ€¦ 2019-04-08 00:09:48 11.0        75      4   Mon    \n3 47498  car          ios    2019-04-08 00:09:50 18.6       307      8   Mon    \n4 18103  car          androâ€¦ 2019-04-08 00:09:55  0.404     159      3   Mon    \n5 41322  car          androâ€¦ 2019-04-08 00:09:57 17.9       232      3.9 Mon    \n6 64813  car          ios    2019-04-08 00:10:03 17.1       106     10   Mon    \n# â„¹ 3 more variables: start_hr <fct>, day <fct>, geometry <POINT [m]>\n```\n\n\n:::\n\n```{.r .cell-code}\nhead(destination_df)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nSimple feature collection with 6 features and 10 fields\nGeometry type: POINT\nDimension:     XY\nBounding box:  xmin: 14101.2 ymin: 33097.49 xmax: 44192.98 ymax: 46866.96\nProjected CRS: SVY21 / Singapore TM\n# A tibble: 6 Ã— 11\n# Groups:   trj_id [6]\n  trj_id driving_mode osname  pingtimestamp       speed bearing accuracy weekday\n  <chr>  <chr>        <chr>   <dttm>              <dbl>   <int>    <dbl> <ord>  \n1 81574  car          ios     2019-04-21 23:56:49 15.3      103     8    Sun    \n2 54687  car          android 2019-04-21 23:56:46  8.15     299     4.55 Sun    \n3 17190  car          android 2019-04-21 23:56:36 12.4      202     4    Sun    \n4 13793  car          android 2019-04-21 23:56:30  6.47     170     3.9  Sun    \n5 39014  car          ios     2019-04-21 23:56:27  3.59     169     4    Sun    \n6 41170  car          ios     2019-04-21 23:56:13 13.1       71     5    Sun    \n# â„¹ 3 more variables: end_hr <fct>, day <fct>, geometry <POINT [m]>\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\norigin_df <- origin_df %>% dplyr::select('trj_id', 'pingtimestamp', 'geometry', 'weekday', 'start_hr', 'day', 'geometry')\ndestination_df <- destination_df %>% dplyr::select('trj_id', 'pingtimestamp', 'geometry', 'weekday', 'end_hr', 'day', 'geometry')\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nwrite_rds(origin_df, \"data/rds/origin.rds\")\nwrite_rds(destination_df, \"data/rds/destination.rds\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ndestination_df <- read_rds(\"data/rds/destination.rds\")\norigin_df <- read_rds(\"data/rds/origin.rds\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nhead(osm)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nSimple feature collection with 6 features and 10 fields\nGeometry type: LINESTRING\nDimension:     XY\nBounding box:  xmin: 101.7033 ymin: 1.305992 xmax: 103.8301 ymax: 3.147986\nGeodetic CRS:  WGS 84\n   osm_id code      fclass                   name  ref oneway maxspeed layer\n1 4386520 5113     primary           Orchard Road <NA>      F       50     0\n2 4578273 5114   secondary    Jalan Bukit Bintang <NA>      F        0     0\n3 4579495 5122 residential         Jalan Nagasari <NA>      B        0     0\n4 4579533 5122 residential  Persiaran Raja Chulan <NA>      B        0     0\n5 4579534 5122 residential           Jalan Ceylon <NA>      B        0     0\n6 4579536 5122 residential Changkat Bukit Bintang <NA>      F        0     0\n  bridge tunnel                       geometry\n1      F      F LINESTRING (103.8301 1.3060...\n2      F      F LINESTRING (101.7226 3.1478...\n3      F      F LINESTRING (101.7084 3.1473...\n4      F      F LINESTRING (101.7043 3.1468...\n5      F      F LINESTRING (101.7033 3.1476...\n6      F      F LINESTRING (101.7088 3.1470...\n```\n\n\n:::\n\n```{.r .cell-code}\nunique(osm$fclass)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n [1] \"primary\"        \"secondary\"      \"residential\"    \"service\"       \n [5] \"track\"          \"tertiary\"       \"footway\"        \"primary_link\"  \n [9] \"motorway_link\"  \"tertiary_link\"  \"motorway\"       \"unclassified\"  \n[13] \"trunk\"          \"trunk_link\"     \"secondary_link\" \"pedestrian\"    \n[17] \"living_street\"  \"path\"           \"steps\"          \"cycleway\"      \n[21] \"track_grade2\"   \"track_grade4\"   \"track_grade1\"   \"track_grade3\"  \n[25] \"unknown\"        \"track_grade5\"   \"bridleway\"     \n```\n\n\n:::\n:::\n\nhttps://www.geofabrik.de/data/geofabrik-osm-gis-standard-0.3.pdf\n\n::: {.cell}\n\n```{.r .cell-code}\nvalues_to_keep <- c(\"primary\", \"secondary\", \"residential\", \"service\", \"tertiary\", \"primary_link\", \"motorway\", \"motorway_link\", \"tertiary_link\", \"living_street\", \"trunk\", \"trunk_link\")\n\nosm <- osm[osm$fclass %in% values_to_keep, ]\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nsummary(osm)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n    osm_id               code         fclass              name          \n Length:1417871     Min.   :5111   Length:1417871     Length:1417871    \n Class :character   1st Qu.:5122   Class :character   Class :character  \n Mode  :character   Median :5132   Mode  :character   Mode  :character  \n                    Mean   :5131                                        \n                    3rd Qu.:5141                                        \n                    Max.   :5141                                        \n     ref               oneway             maxspeed           layer         \n Length:1417871     Length:1417871     Min.   :  0.000   Min.   :-5.00000  \n Class :character   Class :character   1st Qu.:  0.000   1st Qu.: 0.00000  \n Mode  :character   Mode  :character   Median :  0.000   Median : 0.00000  \n                                       Mean   :  3.665   Mean   : 0.02351  \n                                       3rd Qu.:  0.000   3rd Qu.: 0.00000  \n                                       Max.   :110.000   Max.   : 5.00000  \n    bridge             tunnel                   geometry      \n Length:1417871     Length:1417871     LINESTRING   :1417871  \n Class :character   Class :character   epsg:4326    :      0  \n Mode  :character   Mode  :character   +proj=long...:      0  \n                                                              \n                                                              \n                                                              \n```\n\n\n:::\n\n```{.r .cell-code}\nunique(osm$fclass)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n [1] \"primary\"       \"secondary\"     \"residential\"   \"service\"      \n [5] \"tertiary\"      \"primary_link\"  \"motorway_link\" \"tertiary_link\"\n [9] \"motorway\"      \"trunk\"         \"trunk_link\"    \"living_street\"\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nlength(which(st_is_valid(mpsz) == FALSE))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 6\n```\n\n\n:::\n\n```{.r .cell-code}\nmpsz[which(st_is_valid(mpsz) == FALSE), ]\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nSimple feature collection with 6 features and 8 fields\nGeometry type: MULTIPOLYGON\nDimension:     XY, XYZ\nBounding box:  xmin: 103.7098 ymin: 1.212326 xmax: 104.0885 ymax: 1.440698\nz_range:       zmin: 0 zmax: 0\nGeodetic CRS:  WGS 84\n# A tibble: 6 Ã— 9\n  Name    Description                   geometry SUBZONE_NO SUBZONE_N PLN_AREA_N\n  <chr>   <chr>               <MULTIPOLYGON [Â°]> <chr>      <chr>     <chr>     \n1 kml_30  \"<center><tâ€¦ (((103.8591 1.22068, 103â€¦ 2          SOUTHERNâ€¦ SOUTHERN â€¦\n2 kml_31  \"<center><tâ€¦ (((103.8232 1.257481, 10â€¦ 1          SENTOSA   SOUTHERN â€¦\n3 kml_35  \"<center><tâ€¦ Z (((103.8236 1.260178 0â€¦ 1          MARITIMEâ€¦ BUKIT MERâ€¦\n4 kml_59  \"<center><tâ€¦ Z (((103.9321 1.305548 0â€¦ 7          SIGLAP    BEDOK     \n5 kml_109 \"<center><tâ€¦ (((103.7119 1.29961, 103â€¦ 10         JURONG Pâ€¦ JURONG EAâ€¦\n6 kml_318 \"<center><tâ€¦ (((104.0541 1.432306, 10â€¦ 1          NORTH-EAâ€¦ NORTH-EASâ€¦\n# â„¹ 3 more variables: PLN_AREA_C <chr>, REGION_N <chr>, REGION_C <chr>\n```\n\n\n:::\n\n```{.r .cell-code}\nmpsz <- st_make_valid(mpsz)\nmpsz <- st_zm(mpsz)\n```\n:::\n\n\n### 3.3 CRS Adjustments and Verification\n\n\n::: {.cell}\n\n```{.r .cell-code}\nst_crs(mpsz)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nCoordinate Reference System:\n  User input: WGS 84 \n  wkt:\nGEOGCRS[\"WGS 84\",\n    DATUM[\"World Geodetic System 1984\",\n        ELLIPSOID[\"WGS 84\",6378137,298.257223563,\n            LENGTHUNIT[\"metre\",1]]],\n    PRIMEM[\"Greenwich\",0,\n        ANGLEUNIT[\"degree\",0.0174532925199433]],\n    CS[ellipsoidal,2],\n        AXIS[\"geodetic latitude (Lat)\",north,\n            ORDER[1],\n            ANGLEUNIT[\"degree\",0.0174532925199433]],\n        AXIS[\"geodetic longitude (Lon)\",east,\n            ORDER[2],\n            ANGLEUNIT[\"degree\",0.0174532925199433]],\n    ID[\"EPSG\",4326]]\n```\n\n\n:::\n\n```{.r .cell-code}\nst_crs(osm)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nCoordinate Reference System:\n  User input: WGS 84 \n  wkt:\nGEOGCRS[\"WGS 84\",\n    DATUM[\"World Geodetic System 1984\",\n        ELLIPSOID[\"WGS 84\",6378137,298.257223563,\n            LENGTHUNIT[\"metre\",1]]],\n    PRIMEM[\"Greenwich\",0,\n        ANGLEUNIT[\"degree\",0.0174532925199433]],\n    CS[ellipsoidal,2],\n        AXIS[\"latitude\",north,\n            ORDER[1],\n            ANGLEUNIT[\"degree\",0.0174532925199433]],\n        AXIS[\"longitude\",east,\n            ORDER[2],\n            ANGLEUNIT[\"degree\",0.0174532925199433]],\n    ID[\"EPSG\",4326]]\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nosm <- st_transform(osm, crs = 3414)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nmpsz <- st_transform(mpsz, crs = 3414)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nst_crs(mpsz)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nCoordinate Reference System:\n  User input: EPSG:3414 \n  wkt:\nPROJCRS[\"SVY21 / Singapore TM\",\n    BASEGEOGCRS[\"SVY21\",\n        DATUM[\"SVY21\",\n            ELLIPSOID[\"WGS 84\",6378137,298.257223563,\n                LENGTHUNIT[\"metre\",1]]],\n        PRIMEM[\"Greenwich\",0,\n            ANGLEUNIT[\"degree\",0.0174532925199433]],\n        ID[\"EPSG\",4757]],\n    CONVERSION[\"Singapore Transverse Mercator\",\n        METHOD[\"Transverse Mercator\",\n            ID[\"EPSG\",9807]],\n        PARAMETER[\"Latitude of natural origin\",1.36666666666667,\n            ANGLEUNIT[\"degree\",0.0174532925199433],\n            ID[\"EPSG\",8801]],\n        PARAMETER[\"Longitude of natural origin\",103.833333333333,\n            ANGLEUNIT[\"degree\",0.0174532925199433],\n            ID[\"EPSG\",8802]],\n        PARAMETER[\"Scale factor at natural origin\",1,\n            SCALEUNIT[\"unity\",1],\n            ID[\"EPSG\",8805]],\n        PARAMETER[\"False easting\",28001.642,\n            LENGTHUNIT[\"metre\",1],\n            ID[\"EPSG\",8806]],\n        PARAMETER[\"False northing\",38744.572,\n            LENGTHUNIT[\"metre\",1],\n            ID[\"EPSG\",8807]]],\n    CS[Cartesian,2],\n        AXIS[\"northing (N)\",north,\n            ORDER[1],\n            LENGTHUNIT[\"metre\",1]],\n        AXIS[\"easting (E)\",east,\n            ORDER[2],\n            LENGTHUNIT[\"metre\",1]],\n    USAGE[\n        SCOPE[\"Cadastre, engineering survey, topographic mapping.\"],\n        AREA[\"Singapore - onshore and offshore.\"],\n        BBOX[1.13,103.59,1.47,104.07]],\n    ID[\"EPSG\",3414]]\n```\n\n\n:::\n\n```{.r .cell-code}\nst_crs(osm)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nCoordinate Reference System:\n  User input: EPSG:3414 \n  wkt:\nPROJCRS[\"SVY21 / Singapore TM\",\n    BASEGEOGCRS[\"SVY21\",\n        DATUM[\"SVY21\",\n            ELLIPSOID[\"WGS 84\",6378137,298.257223563,\n                LENGTHUNIT[\"metre\",1]]],\n        PRIMEM[\"Greenwich\",0,\n            ANGLEUNIT[\"degree\",0.0174532925199433]],\n        ID[\"EPSG\",4757]],\n    CONVERSION[\"Singapore Transverse Mercator\",\n        METHOD[\"Transverse Mercator\",\n            ID[\"EPSG\",9807]],\n        PARAMETER[\"Latitude of natural origin\",1.36666666666667,\n            ANGLEUNIT[\"degree\",0.0174532925199433],\n            ID[\"EPSG\",8801]],\n        PARAMETER[\"Longitude of natural origin\",103.833333333333,\n            ANGLEUNIT[\"degree\",0.0174532925199433],\n            ID[\"EPSG\",8802]],\n        PARAMETER[\"Scale factor at natural origin\",1,\n            SCALEUNIT[\"unity\",1],\n            ID[\"EPSG\",8805]],\n        PARAMETER[\"False easting\",28001.642,\n            LENGTHUNIT[\"metre\",1],\n            ID[\"EPSG\",8806]],\n        PARAMETER[\"False northing\",38744.572,\n            LENGTHUNIT[\"metre\",1],\n            ID[\"EPSG\",8807]]],\n    CS[Cartesian,2],\n        AXIS[\"northing (N)\",north,\n            ORDER[1],\n            LENGTHUNIT[\"metre\",1]],\n        AXIS[\"easting (E)\",east,\n            ORDER[2],\n            LENGTHUNIT[\"metre\",1]],\n    USAGE[\n        SCOPE[\"Cadastre, engineering survey, topographic mapping.\"],\n        AREA[\"Singapore - onshore and offshore.\"],\n        BBOX[1.13,103.59,1.47,104.07]],\n    ID[\"EPSG\",3414]]\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nosm <- osm %>% dplyr::select('osm_id', 'fclass')\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nplot(st_geometry(mpsz))\n```\n\n::: {.cell-output-display}\n![](THE1_files/figure-html/unnamed-chunk-23-1.png){width=672}\n:::\n:::\n\n\n#### Outer Island:\n\nAn island in Singapore inaccessible by road\n\nTherefore, Coney Island, Jurong Island and Sentosa are not outer islands.\n\nPulau Ubin and Pulau Tekong are examples of outer islands.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmerged_sg <- st_union(mpsz) %>%\n    st_cast(\"POLYGON\")\n\nmerged_sg <- merged_sg[c(10)]\nmerged_sg <- fill_holes(merged_sg, units::set_units(1, \"km^2\"))\nmerged_sg <- st_as_sf(merged_sg)\npar(1,2)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[[1]]\nNULL\n\n[[2]]\nNULL\n```\n\n\n:::\n\n```{.r .cell-code}\nplot(st_geometry(mpsz))\n```\n\n::: {.cell-output-display}\n![](THE1_files/figure-html/unnamed-chunk-24-1.png){width=672}\n:::\n\n```{.r .cell-code}\nplot(st_geometry(merged_sg))\n```\n\n::: {.cell-output-display}\n![](THE1_files/figure-html/unnamed-chunk-24-2.png){width=672}\n:::\n\n```{.r .cell-code}\nwrite_rds(merged_sg, \"data/rds/merged_sg.rds\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nmerged_sg <- read_rds(\"data/rds/merged_sg.rds\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nmerged_st <- as_Spatial(merged_sg)\nmerged_sg_sp <- as(merged_st, \"SpatialPolygons\")\nmerged_sg_owin <- as(merged_sg_sp, \"owin\")\n\nwrite_rds(merged_sg_owin, \"data/rds/merged_sg_owin.rds\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# merged_sg_owin <- read_rds(\"data/rds/merged_sg_owin.rds\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nosm_sg <- st_intersection(osm, merged_sg)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nosm_sg <- st_cast(st_cast(osm_sg, \"MULTILINESTRING\"),\"LINESTRING\")\nsummary(osm_sg)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n    osm_id             fclass                   geometry     \n Length:157836      Length:157836      LINESTRING   :157836  \n Class :character   Class :character   epsg:3414    :     0  \n Mode  :character   Mode  :character   +proj=tmer...:     0  \n```\n\n\n:::\n\n```{.r .cell-code}\nwrite_rds(osm_sg, \"data/rds/osm_sg.rds\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nosm_sg <- read_rds(\"data/rds/osm_sg.rds\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nplot(osm_sg)\n```\n\n::: {.cell-output-display}\n![](THE1_files/figure-html/unnamed-chunk-31-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\norigin <- as_Spatial(origin_df)\ndestination <- as_Spatial(destination_df)\n\norigin_sp <- as(origin, \"SpatialPoints\")\ndestination_sp <- as(destination, \"SpatialPoints\")\n\norigin_ppp <- as(origin_sp, \"ppp\")\ndestination_ppp <- as(destination_sp, \"ppp\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\norigin_ppp <- origin_ppp[merged_sg_owin]\ndestination_ppp <- destination_ppp[merged_sg_owin]\n```\n:::\n\n\n### 3.4 Simple Visualisations\n\n\n::: {.cell}\n\n```{.r .cell-code}\nplot(origin_ppp)\n```\n\n::: {.cell-output-display}\n![](THE1_files/figure-html/unnamed-chunk-34-1.png){width=672}\n:::\n\n```{.r .cell-code}\nplot(destination_ppp)\n```\n\n::: {.cell-output-display}\n![](THE1_files/figure-html/unnamed-chunk-34-2.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nany(duplicated(origin_ppp))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] FALSE\n```\n\n\n:::\n\n```{.r .cell-code}\nany(duplicated(destination_ppp))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] FALSE\n```\n\n\n:::\n:::\n\n\n#### 4.0 KDE\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsapply(origin_ppp, class)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n     window           n           x           y  markformat \n     \"owin\"   \"integer\"   \"numeric\"   \"numeric\" \"character\" \n```\n\n\n:::\n\n```{.r .cell-code}\nsapply(origin_ppp, typeof)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n     window           n           x           y  markformat \n     \"list\"   \"integer\"    \"double\"    \"double\" \"character\" \n```\n\n\n:::\n\n```{.r .cell-code}\nclass(origin_ppp)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"ppp\"\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\norigin_ppp$x <- as.numeric(origin_ppp$x)\nsummary(origin_ppp)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nPlanar point pattern:  28000 points\nAverage intensity 3.995238e-05 points per square unit\n\nCoordinates are given to 3 decimal places\ni.e. rounded to the nearest multiple of 0.001 units\n\nWindow: polygonal boundary\nsingle connected closed polygon with 15268 vertices\nenclosing rectangle: [2667.54, 51404.13] x [21448.48, 50256.33] units\n                     (48740 x 28810 units)\nWindow area = 700834000 square units\nFraction of frame area: 0.499\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\npar(1,2)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[[1]]\nNULL\n\n[[2]]\nNULL\n```\n\n\n:::\n\n```{.r .cell-code}\norigin.bw <- density(origin_ppp,\n                             sigma=bw.diggle,\n                              edge=TRUE,\n                            kernel=\"quartic\") \nplot(origin.bw)\n```\n\n::: {.cell-output-display}\n![](THE1_files/figure-html/unnamed-chunk-38-1.png){width=672}\n:::\n\n```{.r .cell-code}\norigin_ppp.km <- rescale(origin_ppp, 1000, \"km\")\n\norigin.bw <- density(origin_ppp.km,\n                              sigma=bw.diggle,\n                              edge=TRUE,\n                            kernel=\"quartic\") \nplot(origin.bw)\n```\n\n::: {.cell-output-display}\n![](THE1_files/figure-html/unnamed-chunk-38-2.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\npar(1,2)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[[1]]\nNULL\n\n[[2]]\nNULL\n```\n\n\n:::\n\n```{.r .cell-code}\ndestination.bw <- density(destination_ppp,\n                             sigma=bw.diggle,\n                              edge=TRUE,\n                            kernel=\"quartic\") \nplot(destination.bw)\n```\n\n::: {.cell-output-display}\n![](THE1_files/figure-html/unnamed-chunk-39-1.png){width=672}\n:::\n\n```{.r .cell-code}\ndestination_ppp.km <- rescale(destination_ppp, 1000, \"km\")\n\ndestination.bw <- density(destination_ppp.km,\n                              sigma=bw.diggle,\n                              edge=TRUE,\n                            kernel=\"quartic\") \nplot(destination.bw)\n```\n\n::: {.cell-output-display}\n![](THE1_files/figure-html/unnamed-chunk-39-2.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nsort(mpsz$SUBZONE_N)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n  [1] \"ADMIRALTY\"                     \"AIRPORT ROAD\"                 \n  [3] \"ALEXANDRA HILL\"                \"ALEXANDRA NORTH\"              \n  [5] \"ALJUNIED\"                      \"ANAK BUKIT\"                   \n  [7] \"ANCHORVALE\"                    \"ANG MO KIO TOWN CENTRE\"       \n  [9] \"ANSON\"                         \"BAHAR\"                        \n [11] \"BALESTIER\"                     \"BANGKIT\"                      \n [13] \"BAYFRONT SUBZONE\"              \"BAYSHORE\"                     \n [15] \"BEDOK NORTH\"                   \"BEDOK RESERVOIR\"              \n [17] \"BEDOK SOUTH\"                   \"BENCOOLEN\"                    \n [19] \"BENDEMEER\"                     \"BENOI SECTOR\"                 \n [21] \"BIDADARI\"                      \"BISHAN EAST\"                  \n [23] \"BOAT QUAY\"                     \"BOON KENG\"                    \n [25] \"BOON LAY PLACE\"                \"BOON TECK\"                    \n [27] \"BOULEVARD\"                     \"BRADDELL\"                     \n [29] \"BRAS BASAH\"                    \"BRICKLAND\"                    \n [31] \"BRICKWORKS\"                    \"BUGIS\"                        \n [33] \"BUKIT BATOK CENTRAL\"           \"BUKIT BATOK EAST\"             \n [35] \"BUKIT BATOK SOUTH\"             \"BUKIT BATOK WEST\"             \n [37] \"BUKIT HO SWEE\"                 \"BUKIT MERAH\"                  \n [39] \"CAIRNHILL\"                     \"CECIL\"                        \n [41] \"CENTRAL SUBZONE\"               \"CENTRAL WATER CATCHMENT\"      \n [43] \"CHANGI AIRPORT\"                \"CHANGI BAY\"                   \n [45] \"CHANGI POINT\"                  \"CHANGI WEST\"                  \n [47] \"CHATSWORTH\"                    \"CHENG SAN\"                    \n [49] \"CHIN BEE\"                      \"CHINA SQUARE\"                 \n [51] \"CHINATOWN\"                     \"CHOA CHU KANG CENTRAL\"        \n [53] \"CHOA CHU KANG NORTH\"           \"CHONG BOON\"                   \n [55] \"CITY HALL\"                     \"CITY TERMINALS\"               \n [57] \"CLARKE QUAY\"                   \"CLEANTECH\"                    \n [59] \"CLEMENTI CENTRAL\"              \"CLEMENTI NORTH\"               \n [61] \"CLEMENTI WEST\"                 \"CLEMENTI WOODS\"               \n [63] \"CLIFFORD PIER\"                 \"COMMONWEALTH\"                 \n [65] \"COMPASSVALE\"                   \"CONEY ISLAND\"                 \n [67] \"CORONATION ROAD\"               \"CRAWFORD\"                     \n [69] \"DAIRY FARM\"                    \"DEFU INDUSTRIAL PARK\"         \n [71] \"DEPOT ROAD\"                    \"DHOBY GHAUT\"                  \n [73] \"DOVER\"                         \"DUNEARN\"                      \n [75] \"EAST COAST\"                    \"EVERTON PARK\"                 \n [77] \"FABER\"                         \"FAJAR\"                        \n [79] \"FARRER COURT\"                  \"FARRER PARK\"                  \n [81] \"FERNVALE\"                      \"FLORA DRIVE\"                  \n [83] \"FOREST HILL\"                   \"FORT CANNING\"                 \n [85] \"FRANKEL\"                       \"GALI BATU\"                    \n [87] \"GARDEN\"                        \"GEYLANG BAHRU\"                \n [89] \"GEYLANG EAST\"                  \"GHIM MOH\"                     \n [91] \"GOMBAK\"                        \"GOODWOOD PARK\"                \n [93] \"GREENWOOD PARK\"                \"GUILIN\"                       \n [95] \"GUL BASIN\"                     \"GUL CIRCLE\"                   \n [97] \"HENDERSON HILL\"                \"HILLCREST\"                    \n [99] \"HILLVIEW\"                      \"HOLLAND DRIVE\"                \n[101] \"HOLLAND ROAD\"                  \"HONG KAH\"                     \n[103] \"HONG KAH NORTH\"                \"HOUGANG CENTRAL\"              \n[105] \"HOUGANG EAST\"                  \"HOUGANG WEST\"                 \n[107] \"INSTITUTION HILL\"              \"INTERNATIONAL BUSINESS PARK\"  \n[109] \"ISTANA NEGARA\"                 \"JELEBU\"                       \n[111] \"JOO KOON\"                      \"JOO SENG\"                     \n[113] \"JURONG GATEWAY\"                \"JURONG ISLAND AND BUKOM\"      \n[115] \"JURONG PORT\"                   \"JURONG RIVER\"                 \n[117] \"JURONG WEST CENTRAL\"           \"KAKI BUKIT\"                   \n[119] \"KALLANG BAHRU\"                 \"KALLANG WAY\"                  \n[121] \"KAMPONG BUGIS\"                 \"KAMPONG GLAM\"                 \n[123] \"KAMPONG JAVA\"                  \"KAMPONG TIONG BAHRU\"          \n[125] \"KAMPONG UBI\"                   \"KANGKAR\"                      \n[127] \"KATONG\"                        \"KEAT HONG\"                    \n[129] \"KEBUN BAHRU\"                   \"KEMBANGAN\"                    \n[131] \"KENT RIDGE\"                    \"KHATIB\"                       \n[133] \"KIAN TECK\"                     \"KIM KEAT\"                     \n[135] \"KOVAN\"                         \"KRANJI\"                       \n[137] \"LAKESIDE (BUSINESS)\"           \"LAKESIDE (LEISURE)\"           \n[139] \"LAVENDER\"                      \"LEEDON PARK\"                  \n[141] \"LEONIE HILL\"                   \"LIM CHU KANG\"                 \n[143] \"LITTLE INDIA\"                  \"LIU FANG\"                     \n[145] \"LORONG 8 TOA PAYOH\"            \"LORONG AH SOO\"                \n[147] \"LORONG CHUAN\"                  \"LORONG HALUS\"                 \n[149] \"LORONG HALUS NORTH\"            \"LOWER SELETAR\"                \n[151] \"LOYANG EAST\"                   \"LOYANG WEST\"                  \n[153] \"MACKENZIE\"                     \"MACPHERSON\"                   \n[155] \"MALCOLM\"                       \"MANDAI EAST\"                  \n[157] \"MANDAI ESTATE\"                 \"MANDAI WEST\"                  \n[159] \"MARGARET DRIVE\"                \"MARINA CENTRE\"                \n[161] \"MARINA EAST\"                   \"MARINA EAST (MP)\"             \n[163] \"MARINA SOUTH\"                  \"MARINE PARADE\"                \n[165] \"MARITIME SQUARE\"               \"MARYMOUNT\"                    \n[167] \"MATILDA\"                       \"MAXWELL\"                      \n[169] \"MEI CHIN\"                      \"MIDVIEW\"                      \n[171] \"MONK'S HILL\"                   \"MOULMEIN\"                     \n[173] \"MOUNT EMILY\"                   \"MOUNT PLEASANT\"               \n[175] \"MOUNTBATTEN\"                   \"MURAI\"                        \n[177] \"NASSIM\"                        \"NATIONAL UNIVERSITY OF S'PORE\"\n[179] \"NATURE RESERVE\"                \"NEE SOON\"                     \n[181] \"NEWTON CIRCUS\"                 \"NICOLL\"                       \n[183] \"NORTH COAST\"                   \"NORTH-EASTERN ISLANDS\"        \n[185] \"NORTHLAND\"                     \"NORTHSHORE\"                   \n[187] \"ONE NORTH\"                     \"ONE TREE HILL\"                \n[189] \"ORANGE GROVE\"                  \"OXLEY\"                        \n[191] \"PANDAN\"                        \"PANG SUA\"                     \n[193] \"PARK\"                          \"PASIR PANJANG 1\"              \n[195] \"PASIR PANJANG 2\"               \"PASIR RIS CENTRAL\"            \n[197] \"PASIR RIS DRIVE\"               \"PASIR RIS PARK\"               \n[199] \"PASIR RIS WAFER FAB PARK\"      \"PASIR RIS WEST\"               \n[201] \"PATERSON\"                      \"PAYA LEBAR EAST\"              \n[203] \"PAYA LEBAR NORTH\"              \"PAYA LEBAR WEST\"              \n[205] \"PEARL'S HILL\"                  \"PEI CHUN\"                     \n[207] \"PENG SIANG\"                    \"PENJURU CRESCENT\"             \n[209] \"PEOPLE'S PARK\"                 \"PHILLIP\"                      \n[211] \"PIONEER SECTOR\"                \"PLAB\"                         \n[213] \"PLANTATION\"                    \"PORT\"                         \n[215] \"POTONG PASIR\"                  \"PULAU PUNGGOL BARAT\"          \n[217] \"PULAU PUNGGOL TIMOR\"           \"PULAU SELETAR\"                \n[219] \"PUNGGOL CANAL\"                 \"PUNGGOL FIELD\"                \n[221] \"PUNGGOL TOWN CENTRE\"           \"QUEENSWAY\"                    \n[223] \"RAFFLES PLACE\"                 \"REDHILL\"                      \n[225] \"RESERVOIR VIEW\"                \"RIDOUT\"                       \n[227] \"RIVERVALE\"                     \"ROBERTSON QUAY\"               \n[229] \"ROCHOR CANAL\"                  \"SAFTI\"                        \n[231] \"SAMULUN\"                       \"SAUJANA\"                      \n[233] \"SELEGIE\"                       \"SELETAR\"                      \n[235] \"SELETAR AEROSPACE PARK\"        \"SELETAR HILLS\"                \n[237] \"SEMAKAU\"                       \"SEMBAWANG CENTRAL\"            \n[239] \"SEMBAWANG EAST\"                \"SEMBAWANG HILLS\"              \n[241] \"SEMBAWANG NORTH\"               \"SEMBAWANG SPRINGS\"            \n[243] \"SEMBAWANG STRAITS\"             \"SENGKANG TOWN CENTRE\"         \n[245] \"SENGKANG WEST\"                 \"SENJA\"                        \n[247] \"SENNETT\"                       \"SENOKO NORTH\"                 \n[249] \"SENOKO SOUTH\"                  \"SENOKO WEST\"                  \n[251] \"SENTOSA\"                       \"SERANGOON CENTRAL\"            \n[253] \"SERANGOON GARDEN\"              \"SERANGOON NORTH\"              \n[255] \"SERANGOON NORTH IND ESTATE\"    \"SHANGRI-LA\"                   \n[257] \"SHIPYARD\"                      \"SIGLAP\"                       \n[259] \"SIMEI\"                         \"SIMPANG NORTH\"                \n[261] \"SIMPANG SOUTH\"                 \"SINGAPORE GENERAL HOSPITAL\"   \n[263] \"SINGAPORE POLYTECHNIC\"         \"SOMERSET\"                     \n[265] \"SOUTHERN GROUP\"                \"SPRINGLEAF\"                   \n[267] \"STRAITS VIEW\"                  \"SUDONG\"                       \n[269] \"SUNGEI ROAD\"                   \"SUNSET WAY\"                   \n[271] \"SWISS CLUB\"                    \"TAGORE\"                       \n[273] \"TAI SENG\"                      \"TAMAN JURONG\"                 \n[275] \"TAMPINES EAST\"                 \"TAMPINES NORTH\"               \n[277] \"TAMPINES WEST\"                 \"TANGLIN\"                      \n[279] \"TANGLIN HALT\"                  \"TANJONG IRAU\"                 \n[281] \"TANJONG PAGAR\"                 \"TANJONG RHU\"                  \n[283] \"TEBAN GARDENS\"                 \"TECK WHYE\"                    \n[285] \"TELOK BLANGAH DRIVE\"           \"TELOK BLANGAH RISE\"           \n[287] \"TELOK BLANGAH WAY\"             \"TENGAH INDUSTRIAL ESTATE\"     \n[289] \"TENGEH\"                        \"THE WHARVES\"                  \n[291] \"TIONG BAHRU\"                   \"TIONG BAHRU STATION\"          \n[293] \"TOA PAYOH CENTRAL\"             \"TOA PAYOH WEST\"               \n[295] \"TOH GUAN\"                      \"TOH TUCK\"                     \n[297] \"TOWNSVILLE\"                    \"TRAFALGAR\"                    \n[299] \"TUAS BAY\"                      \"TUAS NORTH\"                   \n[301] \"TUAS PROMENADE\"                \"TUAS VIEW\"                    \n[303] \"TUAS VIEW EXTENSION\"           \"TUKANG\"                       \n[305] \"TURF CLUB\"                     \"TYERSALL\"                     \n[307] \"ULU PANDAN\"                    \"UPPER PAYA LEBAR\"             \n[309] \"UPPER THOMSON\"                 \"VICTORIA\"                     \n[311] \"WATERWAY EAST\"                 \"WENYA\"                        \n[313] \"WEST COAST\"                    \"WOODGROVE\"                    \n[315] \"WOODLANDS EAST\"                \"WOODLANDS REGIONAL CENTRE\"    \n[317] \"WOODLANDS SOUTH\"               \"WOODLANDS WEST\"               \n[319] \"WOODLEIGH\"                     \"XILIN\"                        \n[321] \"YEW TEE\"                       \"YIO CHU KANG\"                 \n[323] \"YIO CHU KANG EAST\"             \"YIO CHU KANG NORTH\"           \n[325] \"YIO CHU KANG WEST\"             \"YISHUN CENTRAL\"               \n[327] \"YISHUN EAST\"                   \"YISHUN SOUTH\"                 \n[329] \"YISHUN WEST\"                   \"YUHUA EAST\"                   \n[331] \"YUHUA WEST\"                    \"YUNNAN\"                       \n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nsort(unique(mpsz$PLN_AREA_N))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n [1] \"ANG MO KIO\"              \"BEDOK\"                  \n [3] \"BISHAN\"                  \"BOON LAY\"               \n [5] \"BUKIT BATOK\"             \"BUKIT MERAH\"            \n [7] \"BUKIT PANJANG\"           \"BUKIT TIMAH\"            \n [9] \"CENTRAL WATER CATCHMENT\" \"CHANGI\"                 \n[11] \"CHANGI BAY\"              \"CHOA CHU KANG\"          \n[13] \"CLEMENTI\"                \"DOWNTOWN CORE\"          \n[15] \"GEYLANG\"                 \"HOUGANG\"                \n[17] \"JURONG EAST\"             \"JURONG WEST\"            \n[19] \"KALLANG\"                 \"LIM CHU KANG\"           \n[21] \"MANDAI\"                  \"MARINA EAST\"            \n[23] \"MARINA SOUTH\"            \"MARINE PARADE\"          \n[25] \"MUSEUM\"                  \"NEWTON\"                 \n[27] \"NORTH-EASTERN ISLANDS\"   \"NOVENA\"                 \n[29] \"ORCHARD\"                 \"OUTRAM\"                 \n[31] \"PASIR RIS\"               \"PAYA LEBAR\"             \n[33] \"PIONEER\"                 \"PUNGGOL\"                \n[35] \"QUEENSTOWN\"              \"RIVER VALLEY\"           \n[37] \"ROCHOR\"                  \"SELETAR\"                \n[39] \"SEMBAWANG\"               \"SENGKANG\"               \n[41] \"SERANGOON\"               \"SIMPANG\"                \n[43] \"SINGAPORE RIVER\"         \"SOUTHERN ISLANDS\"       \n[45] \"STRAITS VIEW\"            \"SUNGEI KADUT\"           \n[47] \"TAMPINES\"                \"TANGLIN\"                \n[49] \"TENGAH\"                  \"TOA PAYOH\"              \n[51] \"TUAS\"                    \"WESTERN ISLANDS\"        \n[53] \"WESTERN WATER CATCHMENT\" \"WOODLANDS\"              \n[55] \"YISHUN\"                 \n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nmpsz_changi = mpsz %>% filter(PLN_AREA_N==\"CHANGI\")\nchangi_owin <- as.owin(mpsz_changi, \"owin\")\n\nplot(mpsz_changi)\n```\n\n::: {.cell-output-display}\n![](THE1_files/figure-html/unnamed-chunk-42-1.png){width=672}\n:::\n\n```{.r .cell-code}\nplot(changi_owin)\n```\n\n::: {.cell-output-display}\n![](THE1_files/figure-html/unnamed-chunk-42-2.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nosm_changi_i <- st_intersection(osm_sg, mpsz_changi)\nosm_changi_idxs <- as.numeric(osm_changi_i$osm_id)\nosm_changi<- osm_sg[osm_sg$osm_id %in% osm_changi_idxs, ]\n\nplot(osm_changi)\n```\n\n::: {.cell-output-display}\n![](THE1_files/figure-html/unnamed-chunk-43-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ndestination_df.changi = st_intersection(destination_df, mpsz_changi)\nplot(destination_df.changi)\n```\n\n::: {.cell-output-display}\n![](THE1_files/figure-html/unnamed-chunk-44-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nlixels <- lixelize_lines(osm_changi, 200, mindist = 100)\nsamples <- lines_center(lixels)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ndensities <- nkde(osm_changi,\n                  events=destination_df.changi,\n                  w=rep(1, nrow(destination_df.changi)),\n                  samples=samples,\n                  kernel_name=\"quartic\",\n                  bw=500,\n                  div=\"bw\",\n                  method=\"simple\",\n                  digits=1,\n                  tol=1,\n                  grid_shape=c(1,1),\n                  max_depth = 8,\n                  agg=5,\n                  sparse=TRUE,\n                  verbose = FALSE)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nsamples$density <- densities\nlixels$density <- densities\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nsamples$density <- samples$density*1000\nlixels$density <- lixels$density*1000\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# write_rds(samples,  \"data/rds/samples.rds\")\n# write_rds(lixels,  \"data/rds/lixels.rds\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ntm_shape(lixels) + \n  tm_lines(col=\"density\")\n```\n\n::: {.cell-output-display}\n![](THE1_files/figure-html/unnamed-chunk-50-1.png){width=672}\n:::\n\n```{.r .cell-code}\n# tm_shape(destination_df.changi) + \n#  tm_dots()\n```\n:::",
    "supporting": [
      "THE1_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}